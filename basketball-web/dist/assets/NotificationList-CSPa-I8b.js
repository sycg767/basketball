import{_ as Z,r as E,$ as ee,t as te,E as d,d as _,e as n,a as o,f as r,m as ae,a4 as oe,o as i,b as s,a3 as ne,g as C,i as l,c as R,F as se,x as ie,z as le,ak as re,A as ce,B as g,V as L,C as A,D as U,s as T,G as de,M as D}from"./index-Oskx-env.js";import{b as _e,c as ue,a as Ee,d as Ce,m as pe}from"./notification-HJyXG3tP.js";const Se={class:"notification-list-container"},fe={class:"card-header"},Re={class:"header-actions"},ge={class:"filter-bar"},ve={class:"notification-content"},Ne=["onClick"],Oe={class:"notification-left"},ye={class:"notification-main"},Fe={class:"notification-header-row"},me={class:"notification-title"},Me={class:"notification-time"},Ae={class:"notification-body"},Ue={key:0,class:"notification-meta"},Te={key:0,class:"related-id"},ke={class:"notification-actions"},Be={key:0,class:"pagination-container"},Ie={__name:"NotificationList",setup(Le){const k=ae(),p=E([]),v=E(!1),u=E(1),N=E(10),y=E(0),O=E(""),h=ee(()=>p.value.some(t=>t.isRead===0));te(()=>{S()});const S=async()=>{v.value=!0;try{let t;O.value==="unread"?t=await _e({page:u.value,size:N.value}):t=await ue({page:u.value,size:N.value,type:O.value||void 0}),t.code===200&&(p.value=t.data.records||[],y.value=t.data.total||0)}catch(t){console.error("获取通知列表失败:",t),d.error("获取通知列表失败")}finally{v.value=!1}},z=()=>{u.value=1,S()},w=()=>{S()},x=()=>{u.value=1,S()},G=()=>{k.back()},P=t=>{k.push(`/notification/${t.id}`)},b=async t=>{try{await Ee(t.id),t.isRead=1,d.success("已标记为已读")}catch(e){console.error("标记已读失败:",e),d.error("操作失败")}},K=async()=>{try{await D.confirm("确定要将所有未读消息标记为已读吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe(),p.value.forEach(t=>{t.isRead=1}),d.success("已全部标记为已读")}catch(t){t!=="cancel"&&(console.error("全部已读失败:",t),d.error("操作失败"))}},$=async t=>{try{await D.confirm("确定要删除这条通知吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ce(t.id),d.success("删除成功"),S()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),d.error("删除失败"))}},V=t=>({BOOKING_SUCCESS:T,BOOKING_CANCEL:U,COURSE_ENROLL_SUCCESS:T,COURSE_ENROLL_CANCEL:U,PAYMENT_SUCCESS:T,REFUND_SUCCESS:A,MEMBER_CARD_EXPIRE_SOON:U,COURSE_START_REMINDER:A,BOOKING_START_REMINDER:A})[t]||de,Y=t=>({BOOKING_SUCCESS:"#67C23A",BOOKING_CANCEL:"#E6A23C",COURSE_ENROLL_SUCCESS:"#67C23A",COURSE_ENROLL_CANCEL:"#E6A23C",PAYMENT_SUCCESS:"#67C23A",REFUND_SUCCESS:"#409EFF",MEMBER_CARD_EXPIRE_SOON:"#E6A23C",COURSE_START_REMINDER:"#409EFF",BOOKING_START_REMINDER:"#409EFF"})[t]||"#909399",X=t=>({BOOKING_SUCCESS:"#F0F9FF",BOOKING_CANCEL:"#FEF6EC",COURSE_ENROLL_SUCCESS:"#F0F9FF",COURSE_ENROLL_CANCEL:"#FEF6EC",PAYMENT_SUCCESS:"#F0F9FF",REFUND_SUCCESS:"#EFF6FF",MEMBER_CARD_EXPIRE_SOON:"#FEF6EC",COURSE_START_REMINDER:"#EFF6FF",BOOKING_START_REMINDER:"#EFF6FF"})[t]||"#F5F7FA",j=t=>({BOOKING:"预订",COURSE:"课程",PAYMENT:"支付",MEMBER_CARD:"会员卡"})[t]||t,H=t=>{if(!t)return"";const e=new Date(t),F=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0"),m=String(e.getHours()).padStart(2,"0"),M=String(e.getMinutes()).padStart(2,"0");return`${F}-${f}-${c} ${m}:${M}`};return(t,e)=>{const F=r("el-page-header"),f=r("el-button"),c=r("el-radio-button"),m=r("el-radio-group"),M=r("el-empty"),q=r("el-icon"),B=r("el-tag"),J=r("el-pagination"),Q=r("el-card"),W=oe("loading");return i(),_("div",Se,[n(F,{onBack:G,title:"返回"},{content:o(()=>[...e[3]||(e[3]=[s("span",{class:"page-title"},"通知中心",-1)])]),_:1}),n(Q,{class:"notification-card"},{header:o(()=>[s("div",fe,[e[5]||(e[5]=s("h3",null,"通知中心",-1)),s("div",Re,[h.value?(i(),R(f,{key:0,type:"primary",size:"small",onClick:K},{default:o(()=>[...e[4]||(e[4]=[l(" 全部已读 ",-1)])]),_:1})):C("",!0)])])]),default:o(()=>[s("div",ge,[n(m,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=a=>O.value=a),onChange:z},{default:o(()=>[n(c,{value:""},{default:o(()=>[...e[6]||(e[6]=[l("全部",-1)])]),_:1}),n(c,{value:"unread"},{default:o(()=>[...e[7]||(e[7]=[l("未读",-1)])]),_:1}),n(c,{value:"BOOKING_SUCCESS"},{default:o(()=>[...e[8]||(e[8]=[l("预订通知",-1)])]),_:1}),n(c,{value:"COURSE_ENROLL_SUCCESS"},{default:o(()=>[...e[9]||(e[9]=[l("课程通知",-1)])]),_:1}),n(c,{value:"PAYMENT_SUCCESS"},{default:o(()=>[...e[10]||(e[10]=[l("支付通知",-1)])]),_:1}),n(c,{value:"MEMBER_CARD_EXPIRE_SOON"},{default:o(()=>[...e[11]||(e[11]=[l("会员提醒",-1)])]),_:1})]),_:1},8,["modelValue"])]),ne((i(),_("div",ve,[p.value.length===0&&!v.value?(i(),R(M,{key:0,description:"暂无通知"})):(i(!0),_(se,{key:1},ie(p.value,a=>(i(),_("div",{key:a.id,class:le(["notification-card",{"is-unread":a.isRead===0}]),onClick:I=>P(a)},[s("div",Oe,[s("div",{class:"notification-icon",style:re({backgroundColor:X(a.type)})},[n(q,{size:24,color:Y(a.type)},{default:o(()=>[(i(),R(ce(V(a.type))))]),_:2},1032,["color"])],4)]),s("div",ye,[s("div",Fe,[s("div",me,[l(g(a.title)+" ",1),a.isRead===0?(i(),R(B,{key:0,type:"danger",size:"small",effect:"dark"},{default:o(()=>[...e[12]||(e[12]=[l(" 未读 ",-1)])]),_:1})):C("",!0)]),s("div",Me,g(H(a.sendTime)),1)]),s("div",Ae,g(a.content),1),a.relatedType?(i(),_("div",Ue,[n(B,{size:"small",type:"info"},{default:o(()=>[l(g(j(a.relatedType)),1)]),_:2},1024),a.relatedId?(i(),_("span",Te,"ID: "+g(a.relatedId),1)):C("",!0)])):C("",!0)]),s("div",ke,[a.isRead===0?(i(),R(f,{key:0,type:"text",size:"small",onClick:L(I=>b(a),["stop"])},{default:o(()=>[...e[13]||(e[13]=[l(" 标记已读 ",-1)])]),_:1},8,["onClick"])):C("",!0),n(f,{type:"text",size:"small",onClick:L(I=>$(a),["stop"])},{default:o(()=>[...e[14]||(e[14]=[l(" 删除 ",-1)])]),_:1},8,["onClick"])])],10,Ne))),128))])),[[W,v.value]]),y.value>0?(i(),_("div",Be,[n(J,{"current-page":u.value,"onUpdate:currentPage":e[1]||(e[1]=a=>u.value=a),"page-size":N.value,"onUpdate:pageSize":e[2]||(e[2]=a=>N.value=a),total:y.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x,onCurrentChange:w},null,8,["current-page","page-size","total"])])):C("",!0)]),_:1})])}}},ze=Z(Ie,[["__scopeId","data-v-d15f0905"]]);export{ze as default};
