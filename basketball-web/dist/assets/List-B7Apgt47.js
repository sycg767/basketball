import{_ as xe,r as c,k as K,t as Te,S as be,d as g,b as t,e as a,a3 as Ve,c as h,g as r,a as l,f as y,a4 as Pe,F as Se,x as Be,E as p,m as qe,o as i,i as d,B as v,u as f,a1 as Fe,K as Re,T as $e,a7 as Ne,z as I,s as R,a8 as Ue,R as De,h as Le}from"./index-Oskx-env.js";import{g as Ie,c as Ee,p as Z,a as Oe}from"./booking-CfxXTS4b.js";const Qe={class:"booking-list-container"},je={class:"booking-list"},He={class:"booking-header"},Ke={class:"order-info"},We={class:"order-no"},Ae={class:"order-time"},Ge={class:"booking-content"},Je={class:"venue-info"},Xe={class:"location"},Ye={class:"booking-details"},Ze={class:"detail-item"},et={class:"detail-item"},tt={class:"detail-item"},at={class:"price-info"},st={class:"price-value"},lt={class:"booking-actions"},ot={class:"payment-amount-section"},nt={class:"amount-value"},it={class:"payment-methods-section"},dt={class:"method-check"},ut={class:"method-check"},ct={class:"method-icon balance-icon"},rt={class:"method-check"},pt={class:"method-icon onsite-icon"},vt={class:"method-check"},mt={key:0,class:"qr-code-container"},yt={class:"qr-code-header"},ft={class:"qr-code-content"},_t=["src"],gt={key:1,class:"qr-code-placeholder"},ht={class:"qr-code-status"},kt={key:0,class:"expire-time"},Ct={class:"mock-scan-area"},Mt={class:"mock-scan-buttons"},wt={key:1,class:"payment-status"},zt={key:0,class:"status-paying"},xt={key:1,class:"status-success"},Tt={key:2,class:"status-failed"},bt={class:"dialog-footer"},Vt={__name:"List",setup(Pt){const ee=qe(),$=c(!1),N=c(""),E=c([]),k=K({page:1,pageSize:10,total:0}),C=c(!1),O=c(!1),M=c(null),n=K({paymentMethod:1,paymentType:"wechat_native"}),x=c(!1),b=c(""),Q=c(!1),T=c(null),w=c(null),u=c(""),te=()=>n.paymentMethod===1,ae=()=>u.value&&u.value!=="",P=c(!1),U=c(!1),V=K({cancelReason:""}),z=async()=>{$.value=!0;try{const s={page:k.page,pageSize:k.pageSize,status:N.value!==""?N.value:void 0},e=await Ie(s);E.value=e.data.records,k.total=e.data.total}catch(s){p.error(s.message||"获取预订列表失败")}finally{$.value=!1}},se=()=>{k.page=1,z()},le=s=>({0:"warning",1:"success",2:"info",3:"success",4:"info",5:"danger"})[s]||"info",oe=s=>({0:"待支付",1:"已支付",2:"已取消",3:"已完成",4:"已退款",5:"超时取消"})[s]||"未知",ne=s=>{ee.push(`/booking/detail/${s}`)},ie=s=>{M.value=s,n.paymentMethod=1,n.paymentType="wechat_native",x.value=!1,b.value="",T.value=null,u.value="",C.value=!0},D=s=>{x.value=!1,b.value="",T.value=null,u.value="",s==="wechat_native"?(n.paymentMethod=1,n.paymentType="wechat_native"):s==="alipay_page"?(n.paymentMethod=1,n.paymentType="alipay_page"):s==="balance"?(n.paymentMethod=2,n.paymentType=""):s==="onsite"&&(n.paymentMethod=4,n.paymentType="")},de=()=>{n.paymentMethod===1?j():ye()},ue=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ce=()=>{w.value&&clearInterval(w.value),u.value="paying",w.value=setInterval(async()=>{try{const s=await Oe(M.value.id);s.data.status===1?(u.value="success",clearInterval(w.value),C.value=!1,z(),p.success("支付成功！")):s.data.status===5&&(u.value="failed",clearInterval(w.value),p.error("支付超时，请重新尝试"))}catch{}},3e3)},j=async()=>{Q.value=!0;try{const s=await Z(M.value.id,{paymentMethod:n.paymentMethod,paymentType:n.paymentType});T.value=s.data,n.paymentMethod===1&&s.data.qrCodeUrl?(s.data.qrCodeUrl.startsWith("data:")?b.value=s.data.qrCodeUrl:b.value=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${s.data.paymentNo}`,x.value=!0,ce()):n.paymentMethod===2?(u.value="success",C.value=!1,z()):n.paymentMethod===4&&(p.success("现场支付订单已确认"),C.value=!1,z())}catch(s){p.error(s.message||"生成支付二维码失败"),x.value=!1}finally{Q.value=!1}},re=async()=>{await j()},pe=()=>{w.value&&clearInterval(w.value),C.value=!1,x.value=!1,u.value=""},ve=async()=>{try{await fetch(`http://localhost:8080/api/mock/payment/scan-success/${T.value.paymentNo}`,{method:"POST"}),p.success("模拟支付成功！支付状态已更新")}catch(s){p.error("模拟支付失败: "+s.message)}},me=async()=>{try{await fetch(`http://localhost:8080/api/mock/payment/scan-fail/${T.value.paymentNo}`,{method:"POST"}),p.success("模拟支付失败！支付状态已更新")}catch(s){p.error("模拟支付失败: "+s.message)}},ye=async()=>{if(te())await j();else{O.value=!0;try{await Z(M.value.id,{paymentMethod:n.paymentMethod}),p.success("支付成功"),C.value=!1,z()}catch(s){p.error(s.message||"支付失败")}finally{O.value=!1}}},fe=s=>{M.value=s,V.cancelReason="",P.value=!0},_e=async()=>{if(!V.cancelReason.trim()){p.warning("请输入取消原因");return}U.value=!0;try{await Ee(M.value.id,{cancelReason:V.cancelReason}),p.success("取消成功"),P.value=!1,z()}catch(s){p.error(s.message||"取消失败")}finally{U.value=!1}};return Te(()=>{z()}),be(()=>{w.value&&clearInterval(w.value)}),(s,e)=>{const S=y("el-radio-button"),ge=y("el-radio-group"),W=y("el-card"),A=y("el-empty"),he=y("el-tag"),L=y("el-divider"),m=y("el-icon"),_=y("el-button"),ke=y("el-pagination"),G=y("el-dialog"),Ce=y("el-input"),Me=y("el-form-item"),we=y("el-form"),ze=Pe("loading");return i(),g("div",Qe,[e[42]||(e[42]=t("h2",{class:"page-title"},"我的预订",-1)),a(W,{class:"filter-card"},{default:l(()=>[a(ge,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=o=>N.value=o),onChange:se},{default:l(()=>[a(S,{label:""},{default:l(()=>[...e[12]||(e[12]=[d("全部",-1)])]),_:1}),a(S,{label:0},{default:l(()=>[...e[13]||(e[13]=[d("待支付",-1)])]),_:1}),a(S,{label:1},{default:l(()=>[...e[14]||(e[14]=[d("已支付",-1)])]),_:1}),a(S,{label:2},{default:l(()=>[...e[15]||(e[15]=[d("已取消",-1)])]),_:1}),a(S,{label:3},{default:l(()=>[...e[16]||(e[16]=[d("已完成",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),Ve((i(),g("div",je,[E.value.length===0?(i(),h(A,{key:0,description:"暂无预订记录"})):r("",!0),(i(!0),g(Se,null,Be(E.value,o=>(i(),h(W,{key:o.id,class:"booking-card"},{default:l(()=>{var B,q;return[t("div",He,[t("div",Ke,[t("span",We,"订单号: "+v(o.bookingNo),1),a(he,{type:le(o.status),size:"small"},{default:l(()=>[d(v(oe(o.status)),1)]),_:2},1032,["type"])]),t("div",Ae,v(o.createTime),1)]),a(L),t("div",Ge,[t("div",Je,[t("h3",null,v(o.venueName),1),t("p",Xe,[a(m,null,{default:l(()=>[a(f(Fe))]),_:1}),d(" "+v(o.venueLocation),1)])]),t("div",Ye,[t("div",Ze,[a(m,null,{default:l(()=>[a(f(Re))]),_:1}),t("span",null,v(o.bookingDate),1)]),t("div",et,[a(m,null,{default:l(()=>[a(f($e))]),_:1}),t("span",null,v(o.timeSlot),1)]),t("div",tt,[a(m,null,{default:l(()=>[a(f(Ne))]),_:1}),t("span",null,v(o.duration)+"小时",1)])]),t("div",at,[e[17]||(e[17]=t("div",{class:"price-label"},"实付金额",-1)),t("div",st,"¥"+v(((B=o.actualPrice)==null?void 0:B.toFixed(2))||((q=o.totalPrice)==null?void 0:q.toFixed(2))),1)])]),a(L),t("div",lt,[a(_,{type:"primary",link:"",onClick:F=>ne(o.id)},{default:l(()=>[...e[18]||(e[18]=[d(" 查看详情 ",-1)])]),_:1},8,["onClick"]),o.status===0?(i(),h(_,{key:0,type:"success",onClick:F=>ie(o)},{default:l(()=>[...e[19]||(e[19]=[d(" 立即支付 ",-1)])]),_:1},8,["onClick"])):r("",!0),o.status===0||o.status===1?(i(),h(_,{key:1,type:"danger",onClick:F=>fe(o)},{default:l(()=>[...e[20]||(e[20]=[d(" 取消预订 ",-1)])]),_:1},8,["onClick"])):r("",!0)])]}),_:2},1024))),128))])),[[ze,$.value]]),k.total>0?(i(),h(ke,{key:0,"current-page":k.page,"onUpdate:currentPage":e[1]||(e[1]=o=>k.page=o),"page-size":k.pageSize,"onUpdate:pageSize":e[2]||(e[2]=o=>k.pageSize=o),total:k.total,"page-sizes":[5,10,20],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:z,onCurrentChange:z,class:"pagination"},null,8,["current-page","page-size","total"])):r("",!0),a(G,{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=o=>C.value=o),title:"选择支付方式",width:"600px","close-on-click-modal":!1},{footer:l(()=>[t("div",bt,[a(_,{size:"large",onClick:e[7]||(e[7]=o=>C.value=!1)},{default:l(()=>[...e[37]||(e[37]=[d("取消",-1)])]),_:1}),x.value?r("",!0):(i(),h(_,{key:0,type:"primary",size:"large",onClick:de,loading:O.value,disabled:!n.paymentType&&n.paymentMethod!==2&&n.paymentMethod!==4},{default:l(()=>[...e[38]||(e[38]=[d(" 确认支付 ",-1)])]),_:1},8,["loading","disabled"])),x.value?(i(),h(_,{key:1,type:"danger",size:"large",onClick:pe,loading:U.value},{default:l(()=>[...e[39]||(e[39]=[d(" 取消支付 ",-1)])]),_:1},8,["loading"])):r("",!0)])]),default:l(()=>{var o,B,q,F,J,X,Y;return[t("div",ot,[e[21]||(e[21]=t("div",{class:"amount-label"},"订单金额",-1)),t("div",nt,"¥"+v(((B=(o=M.value)==null?void 0:o.actualPrice)==null?void 0:B.toFixed(2))||((F=(q=M.value)==null?void 0:q.totalPrice)==null?void 0:F.toFixed(2))),1)]),a(L),t("div",it,[e[28]||(e[28]=t("div",{class:"section-title"},"请选择支付方式",-1)),t("div",{class:I(["payment-method-card",{active:n.paymentType==="wechat_native"}]),onClick:e[3]||(e[3]=H=>D("wechat_native"))},[e[22]||(e[22]=t("div",{class:"method-icon wechat-icon"},[t("svg",{viewBox:"0 0 1024 1024",width:"32",height:"32"},[t("path",{d:"M664.250054 368.541681c10.015098 0 19.892049 0.732687 29.67281 1.795902-26.647917-122.810047-159.358451-214.077703-310.826188-214.077703-169.353083 0-308.085774 114.232694-308.085774 259.274068 0 83.708494 46.165436 152.460344 123.281791 205.78483l-30.80868 91.730191 107.688651-53.455469c38.558178 7.53665 69.459978 15.308661 107.924012 15.308661 9.66308 0 19.230993-0.470721 28.752858-1.225921-6.025227-20.36584-9.521864-41.723264-9.521864-63.862493C402.328693 476.632491 517.908058 368.541681 664.250054 368.541681zM498.62897 285.87389c23.200398 0 38.557154 15.120372 38.557154 38.061874 0 22.846334-15.356756 38.156018-38.557154 38.156018-23.107277 0-46.260603-15.309684-46.260603-38.156018C452.368366 300.994262 475.522716 285.87389 498.62897 285.87389zM283.016307 362.090758c-23.107277 0-46.402843-15.309684-46.402843-38.156018 0-22.941502 23.295566-38.061874 46.402843-38.061874 23.081695 0 38.46301 15.120372 38.46301 38.061874C321.479317 346.782098 306.098002 362.090758 283.016307 362.090758zM945.448458 606.151333c0-121.888048-123.258255-221.236753-261.683954-221.236753-146.57838 0-262.015505 99.348706-262.015505 221.236753 0 122.06508 115.437126 221.200938 262.015505 221.200938 30.66644 0 61.617359-7.609305 92.423993-15.262612l84.513836 45.786813-23.178909-76.17082C899.379213 735.776599 945.448458 674.90216 945.448458 606.151333zM598.803483 567.994292c-15.332197 0-30.807656-15.096836-30.807656-30.501688 0-15.190981 15.47546-30.477129 30.807656-30.477129 23.295566 0 38.558178 15.286148 38.558178 30.477129C637.361661 552.897456 622.099049 567.994292 598.803483 567.994292zM768.25071 567.994292c-15.213493 0-30.594809-15.096836-30.594809-30.501688 0-15.190981 15.381315-30.477129 30.594809-30.477129 23.107277 0 38.558178 15.286148 38.558178 30.477129C806.808888 552.897456 791.357987 567.994292 768.25071 567.994292z",fill:"#00C800"})])],-1)),e[23]||(e[23]=t("div",{class:"method-info"},[t("div",{class:"method-name"},"微信支付"),t("div",{class:"method-desc"},"推荐使用微信扫码支付")],-1)),t("div",dt,[n.paymentType==="wechat_native"?(i(),h(m,{key:0,color:"#07C160",size:24},{default:l(()=>[a(f(R))]),_:1})):r("",!0)])],2),t("div",{class:I(["payment-method-card",{active:n.paymentType==="alipay_page"}]),onClick:e[4]||(e[4]=H=>D("alipay_page"))},[e[24]||(e[24]=t("div",{class:"method-icon alipay-icon"},[t("svg",{viewBox:"0 0 1024 1024",width:"32",height:"32"},[t("path",{d:"M1024 701.9v162.8c0 88.5-71.7 160.2-160.2 160.2H160.2C71.7 1024.9 0 953.2 0 864.7V159.9C0 71.4 71.7-0.3 160.2-0.3h703.6c88.5 0 160.2 71.7 160.2 160.2v390.8c-51.8-23.8-155.9-67.8-289.8-67.8-228.9 0-378.1 112.1-430.5 210.5l-0.5 0.9 490.4 199.3c47.6-63.3 118.8-127.1 230.4-151.6z m-514.4-68.9c-0.3 0-0.5 0-0.8 0.1-0.3 0-0.5 0.1-0.8 0.1-44.2 8.2-89.3 22.6-134.4 42.8-9.5 4.3-19 8.9-28.4 13.8-52.2-88.7-152.9-148.3-267.3-148.3-15.7 0-31.1 1.2-46.2 3.4V232.3h585.6v401.6c-35.6-0.3-71.7 0-107.7 0.1z m-278.8-236c-51.7 0-93.6 41.9-93.6 93.6s41.9 93.6 93.6 93.6 93.6-41.9 93.6-93.6-41.9-93.6-93.6-93.6z",fill:"#1296DB"})])],-1)),e[25]||(e[25]=t("div",{class:"method-info"},[t("div",{class:"method-name"},"支付宝支付"),t("div",{class:"method-desc"},"支持支付宝扫码或跳转支付")],-1)),t("div",ut,[n.paymentType==="alipay_page"?(i(),h(m,{key:0,color:"#1677FF",size:24},{default:l(()=>[a(f(R))]),_:1})):r("",!0)])],2),t("div",{class:I(["payment-method-card",{active:n.paymentMethod===2}]),onClick:e[5]||(e[5]=H=>D("balance"))},[t("div",ct,[a(m,{size:32},{default:l(()=>[a(f(Ue))]),_:1})]),e[26]||(e[26]=t("div",{class:"method-info"},[t("div",{class:"method-name"},"余额支付"),t("div",{class:"method-desc"},"当前余额: ¥0.00")],-1)),t("div",rt,[n.paymentMethod===2?(i(),h(m,{key:0,color:"#F56C6C",size:24},{default:l(()=>[a(f(R))]),_:1})):r("",!0)])],2),t("div",{class:I(["payment-method-card",{active:n.paymentMethod===4}]),onClick:e[6]||(e[6]=H=>D("onsite"))},[t("div",pt,[a(m,{size:32},{default:l(()=>[a(f(De))]),_:1})]),e[27]||(e[27]=t("div",{class:"method-info"},[t("div",{class:"method-name"},"现场支付"),t("div",{class:"method-desc"},"到场后现金或刷卡支付")],-1)),t("div",vt,[n.paymentMethod===4?(i(),h(m,{key:0,color:"#909399",size:24},{default:l(()=>[a(f(R))]),_:1})):r("",!0)])],2)]),x.value?(i(),g("div",mt,[t("div",yt,[t("span",null,"请使用"+v(n.paymentType==="wechat_native"?"微信":"支付宝")+"扫码支付",1),a(_,{type:"text",onClick:re,loading:Q.value},{default:l(()=>[...e[29]||(e[29]=[d(" 刷新二维码 ",-1)])]),_:1},8,["loading"])]),t("div",ft,[b.value?(i(),g("img",{key:0,src:b.value,alt:"支付二维码",class:"qr-code-img"},null,8,_t)):(i(),g("div",gt,[a(A,{description:"生成二维码中..."})]))]),t("div",ht,[t("p",null,"支付单号: "+v((J=T.value)==null?void 0:J.paymentNo),1),t("p",null,"订单号: "+v((X=M.value)==null?void 0:X.bookingNo),1),(Y=T.value)!=null&&Y.expireTime?(i(),g("p",kt," 二维码有效期至: "+v(ue(T.value.expireTime)),1)):r("",!0)]),t("div",Ct,[a(L,null,{default:l(()=>[...e[30]||(e[30]=[d("开发环境模拟功能",-1)])]),_:1}),t("div",Mt,[a(_,{type:"success",onClick:ve,disabled:u.value==="success"},{default:l(()=>[...e[31]||(e[31]=[d(" 模拟扫码支付成功 ",-1)])]),_:1},8,["disabled"]),a(_,{type:"danger",onClick:me,disabled:u.value==="failed"},{default:l(()=>[...e[32]||(e[32]=[d(" 模拟扫码支付失败 ",-1)])]),_:1},8,["disabled"])]),e[33]||(e[33]=t("p",{class:"mock-tip"},"点击按钮模拟用户扫码支付结果",-1))])])):r("",!0),ae?(i(),g("div",wt,[u.value==="paying"?(i(),g("div",zt,[a(m,{class:"status-icon is-loading"},{default:l(()=>[a(f($))]),_:1}),e[34]||(e[34]=t("span",null,"等待支付完成...",-1))])):u.value==="success"?(i(),g("div",xt,[a(m,{class:"status-icon"},{default:l(()=>[a(f(R))]),_:1}),e[35]||(e[35]=t("span",null,"支付成功！",-1))])):u.value==="failed"?(i(),g("div",Tt,[a(m,{class:"status-icon"},{default:l(()=>[a(f(Le))]),_:1}),e[36]||(e[36]=t("span",null,"支付失败，请重试",-1))])):r("",!0)])):r("",!0)]}),_:1},8,["modelValue"]),a(G,{modelValue:P.value,"onUpdate:modelValue":e[11]||(e[11]=o=>P.value=o),title:"取消预订",width:"400px"},{footer:l(()=>[a(_,{onClick:e[10]||(e[10]=o=>P.value=!1)},{default:l(()=>[...e[40]||(e[40]=[d("取消",-1)])]),_:1}),a(_,{type:"danger",onClick:_e,loading:U.value},{default:l(()=>[...e[41]||(e[41]=[d("确认取消",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(we,{model:V,"label-width":"100px"},{default:l(()=>[a(Me,{label:"取消原因",required:""},{default:l(()=>[a(Ce,{modelValue:V.cancelReason,"onUpdate:modelValue":e[9]||(e[9]=o=>V.cancelReason=o),type:"textarea",rows:4,placeholder:"请输入取消原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},qt=xe(Vt,[["__scopeId","data-v-59cd950e"]]);export{qt as default};
