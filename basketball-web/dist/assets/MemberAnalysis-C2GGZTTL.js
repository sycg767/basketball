import{_ as $}from"./LineChart-BnR1cl7s.js";import{g as j,a as T,b as q,c as U}from"./analytics-BpXSRZ2d.js";import{_ as F,r as o,n as G,E as H,d as J,b as l,e as t,a as s,f as n,R as K,o as D,y as p,c as k,g as O,Q as W,i as v}from"./index-DfALJeeI.js";import"./index-D5fw03LZ.js";import"./request-CZtBzr0V.js";const X={class:"member-analysis-container"},Y={class:"stat-content"},Z={class:"stat-info"},ee={class:"stat-value"},te={class:"stat-content"},ae={class:"stat-info"},se={class:"stat-value green"},le={class:"stat-content"},oe={class:"stat-info"},ne={class:"stat-value red"},re={class:"card-header"},ie={class:"card-header"},de={class:"pagination-container"},ce={__name:"MemberAnalysis",setup(ue){const V=o(0),z=o(0),A=o(0),_=o(7),u=o("active"),m=o(!1),C=o([]),g=o(1),f=o(10),M=o(0),b=o({xAxisData:[],series:[]});G(()=>{S(),y(),N()});const S=async()=>{try{const a=await j({days:_.value});a.code===200&&a.data&&a.data.length>0&&(b.value={xAxisData:a.data.map(e=>e.analysisDate),series:[{name:"活跃用户数",data:a.data.map(e=>e.loginCount||0)}]})}catch(a){console.error("获取活跃度趋势失败:",a)}},y=async()=>{m.value=!0;try{let a;const e={page:g.value,size:f.value};u.value==="active"?a=await T(e):u.value==="inactive"?a=await q(e):a=await U(e),a.code===200&&(C.value=a.data.records||[],M.value=a.data.total||0)}catch{H.error("获取会员列表失败")}finally{m.value=!1}},N=async()=>{var a,e,i;try{const[d,x]=await Promise.all([T({page:1,size:1}),U({page:1,size:1})]);V.value=(((a=d.data)==null?void 0:a.total)||0)+100,z.value=((e=d.data)==null?void 0:e.total)||0,A.value=((i=x.data)==null?void 0:i.total)||0}catch(d){console.error("获取统计数据失败:",d)}},R=a=>a>=80?"success":a>=60?"":a>=40?"warning":"danger";return(a,e)=>{const i=n("el-card"),d=n("el-col"),x=n("el-row"),w=n("el-option"),B=n("el-select"),h=n("el-radio-button"),I=n("el-radio-group"),c=n("el-table-column"),E=n("el-tag"),P=n("el-table"),L=n("el-pagination"),Q=K("loading");return D(),J("div",X,[e[12]||(e[12]=l("h2",{class:"page-title"},"会员活跃度分析",-1)),t(x,{gutter:20,class:"stats-row"},{default:s(()=>[t(d,{xs:24,sm:8},{default:s(()=>[t(i,{class:"stat-card"},{default:s(()=>[l("div",Y,[l("div",Z,[e[4]||(e[4]=l("p",{class:"stat-label"},"总会员数",-1)),l("p",ee,p(V.value),1)])])]),_:1})]),_:1}),t(d,{xs:24,sm:8},{default:s(()=>[t(i,{class:"stat-card"},{default:s(()=>[l("div",te,[l("div",ae,[e[5]||(e[5]=l("p",{class:"stat-label"},"活跃会员",-1)),l("p",se,p(z.value),1)])])]),_:1})]),_:1}),t(d,{xs:24,sm:8},{default:s(()=>[t(i,{class:"stat-card"},{default:s(()=>[l("div",le,[l("div",oe,[e[6]||(e[6]=l("p",{class:"stat-label"},"流失风险",-1)),l("p",ne,p(A.value),1)])])]),_:1})]),_:1})]),_:1}),t(i,{class:"chart-card"},{header:s(()=>[l("div",re,[e[7]||(e[7]=l("span",null,"会员活跃度趋势",-1)),t(B,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=r=>_.value=r),onChange:S,size:"small",style:{width:"120px"}},{default:s(()=>[t(w,{label:"最近7天",value:7}),t(w,{label:"最近15天",value:15}),t(w,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:s(()=>[b.value.xAxisData?(D(),k($,{key:0,data:b.value,height:"350px","y-axis-name":"活跃度","show-area":!0},null,8,["data"])):O("",!0)]),_:1}),t(i,null,{header:s(()=>[l("div",ie,[e[11]||(e[11]=l("span",null,"会员列表",-1)),t(I,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=r=>u.value=r),onChange:y,size:"small"},{default:s(()=>[t(h,{value:"active"},{default:s(()=>[...e[8]||(e[8]=[v("活跃用户",-1)])]),_:1}),t(h,{value:"inactive"},{default:s(()=>[...e[9]||(e[9]=[v("不活跃用户",-1)])]),_:1}),t(h,{value:"churn"},{default:s(()=>[...e[10]||(e[10]=[v("流失风险",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:s(()=>[W((D(),k(P,{data:C.value,stripe:""},{default:s(()=>[t(c,{prop:"userId",label:"用户ID",width:"100"}),t(c,{prop:"username",label:"用户名"}),t(c,{prop:"realName",label:"真实姓名"}),t(c,{prop:"activityScore",label:"活跃度",width:"100"},{default:s(({row:r})=>[t(E,{type:R(r.activityScore)},{default:s(()=>[v(p(r.activityScore),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"lastActiveTime",label:"最后活跃",width:"180"})]),_:1},8,["data"])),[[Q,m.value]]),l("div",de,[t(L,{"current-page":g.value,"onUpdate:currentPage":e[2]||(e[2]=r=>g.value=r),"page-size":f.value,"onUpdate:pageSize":e[3]||(e[3]=r=>f.value=r),total:M.value,layout:"total, prev, pager, next",onCurrentChange:y},null,8,["current-page","page-size","total"])])]),_:1})])}}},fe=F(ce,[["__scopeId","data-v-571f5be1"]]);export{fe as default};
