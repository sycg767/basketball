import{_ as G,r as d,k as J,a6 as K,$ as U,t as L,d as h,e as a,b as o,a as n,f as r,E as p,m as O,o as _,g as Y,B as c,i as T,u as Q,a1 as W,c as M}from"./index-zUzrFZpX.js";import{a as X}from"./venue-BrYgpQev.js";import{b as Z,d as ee}from"./booking-CZxD_MNj.js";import{B as te}from"./BackButton-BCA-o-ra.js";const ae={class:"booking-create-container"},oe={class:"create-content"},le={key:0,class:"venue-info"},ne=["src"],se={class:"venue-details"},re={class:"location"},ie={class:"price"},ue={class:"price-value"},de={key:0,class:"availability-tip"},ce={class:"price-summary"},me={class:"price-item"},pe={class:"price-item"},_e={class:"price-item total"},ve={class:"total-price"},fe={class:"action-buttons"},ge={__name:"Create",setup(be){const V=K(),D=O(),g=d(null),b=d(!1),i=d(null),v=d(!1),m=d(!1),w=d(!1),e=J({venueId:V.params.venueId,bookingDate:"",startTime:"",endTime:"",bookingType:1,contactName:"",contactPhone:"",peopleCount:1,remark:""}),q={bookingDate:[{required:!0,message:"请选择预订日期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],contactPhone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},C=U(()=>{if(!e.startTime||!e.endTime)return 0;const l=new Date(`2000-01-01 ${e.startTime}`),f=(new Date(`2000-01-01 ${e.endTime}`)-l)/(1e3*60*60);return f>0?f:0}),R=U(()=>{var l;return(l=i.value)!=null&&l.basePrice?C.value*i.value.basePrice:0}),$=l=>l<new Date(new Date().setHours(0,0,0,0)),k=async()=>{if(!e.bookingDate||!e.startTime||!e.endTime){v.value=!1;return}w.value=!0;try{const l=await Z({venueId:e.venueId,bookingDate:e.bookingDate,startTime:e.startTime,endTime:e.endTime});m.value=l.data,v.value=!0}catch(l){p.error(l.message||"检查可用性失败"),m.value=!1,v.value=!1}finally{w.value=!1}},A=async()=>{try{const l=await X(V.params.venueId);i.value=l.data}catch(l){p.error(l.message||"获取场地信息失败"),D.back()}},E=async()=>{if(g.value)try{if(await g.value.validate(),!m.value){p.warning("该时段不可预订,请重新选择");return}b.value=!0;const l=await ee({venueId:parseInt(e.venueId),bookingDate:e.bookingDate,startTime:e.startTime,endTime:e.endTime,bookingType:e.bookingType,contactName:e.contactName,contactPhone:e.contactPhone,peopleCount:e.peopleCount,remark:e.remark});p.success("预订成功"),D.push(`/booking/detail/${l.data}`)}catch(l){p.error(l.message||"预订失败")}finally{b.value=!1}};return L(()=>{A()}),(l,t)=>{const f=r("el-icon"),P=r("el-card"),z=r("el-date-picker"),u=r("el-form-item"),N=r("el-time-select"),x=r("el-col"),F=r("el-row"),B=r("el-alert"),y=r("el-input"),S=r("el-input-number"),j=r("el-form"),I=r("el-button");return _(),h("div",ae,[a(te,{text:"返回"}),o("div",oe,[a(P,{class:"venue-card"},{header:n(()=>[...t[7]||(t[7]=[o("div",{class:"card-header"},[o("span",null,"场地信息")],-1)])]),default:n(()=>[i.value?(_(),h("div",le,[o("img",{src:i.value.imageUrl||"/default-venue.jpg",alt:"场地图片",class:"venue-image"},null,8,ne),o("div",se,[o("h2",null,c(i.value.venueName),1),o("p",re,[a(f,null,{default:n(()=>[a(Q(W))]),_:1}),T(" "+c(i.value.location),1)]),o("p",ie,[t[8]||(t[8]=o("span",{class:"price-label"},"价格:",-1)),o("span",ue,"¥"+c(i.value.basePrice)+"/小时",1)])])])):Y("",!0)]),_:1}),a(P,{class:"form-card"},{header:n(()=>[...t[9]||(t[9]=[o("div",{class:"card-header"},[o("span",null,"预订信息")],-1)])]),default:n(()=>[a(j,{ref_key:"formRef",ref:g,model:e,rules:q,"label-width":"100px"},{default:n(()=>[a(u,{label:"预订日期",prop:"bookingDate",required:""},{default:n(()=>[a(z,{modelValue:e.bookingDate,"onUpdate:modelValue":t[0]||(t[0]=s=>e.bookingDate=s),type:"date",placeholder:"选择预订日期","disabled-date":$,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},onChange:k},null,8,["modelValue"])]),_:1}),a(u,{label:"预订时段",required:""},{default:n(()=>[a(F,{gutter:16},{default:n(()=>[a(x,{span:12},{default:n(()=>[a(u,{prop:"startTime"},{default:n(()=>[a(N,{modelValue:e.startTime,"onUpdate:modelValue":t[1]||(t[1]=s=>e.startTime=s),placeholder:"开始时间",start:"06:00",end:"22:00",step:"01:00",onChange:k,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(x,{span:12},{default:n(()=>[a(u,{prop:"endTime"},{default:n(()=>[a(N,{modelValue:e.endTime,"onUpdate:modelValue":t[2]||(t[2]=s=>e.endTime=s),placeholder:"结束时间",start:"07:00",end:"23:00",step:"01:00","min-time":e.startTime,onChange:k,style:{width:"100%"}},null,8,["modelValue","min-time"])]),_:1})]),_:1})]),_:1}),v.value?(_(),h("div",de,[m.value?(_(),M(B,{key:0,title:"该时段可预订",type:"success",closable:!1,"show-icon":""})):(_(),M(B,{key:1,title:"该时段已被预订,请选择其他时间",type:"error",closable:!1,"show-icon":""}))])):Y("",!0)]),_:1}),a(u,{label:"联系人",prop:"contactName"},{default:n(()=>[a(y,{modelValue:e.contactName,"onUpdate:modelValue":t[3]||(t[3]=s=>e.contactName=s),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),a(u,{label:"联系电话",prop:"contactPhone"},{default:n(()=>[a(y,{modelValue:e.contactPhone,"onUpdate:modelValue":t[4]||(t[4]=s=>e.contactPhone=s),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(u,{label:"人数",prop:"peopleCount"},{default:n(()=>{var s;return[a(S,{modelValue:e.peopleCount,"onUpdate:modelValue":t[5]||(t[5]=H=>e.peopleCount=H),min:1,max:((s=i.value)==null?void 0:s.capacity)||100,placeholder:"请输入人数"},null,8,["modelValue","max"])]}),_:1}),a(u,{label:"备注",prop:"remark"},{default:n(()=>[a(y,{modelValue:e.remark,"onUpdate:modelValue":t[6]||(t[6]=s=>e.remark=s),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1}),a(u,{label:"预计费用"},{default:n(()=>{var s;return[o("div",ce,[o("div",me,[t[10]||(t[10]=o("span",null,"时长:",-1)),o("span",null,c(C.value)+" 小时",1)]),o("div",pe,[t[11]||(t[11]=o("span",null,"单价:",-1)),o("span",null,"¥"+c(((s=i.value)==null?void 0:s.basePrice)||0)+"/小时",1)]),o("div",_e,[t[12]||(t[12]=o("span",null,"总计:",-1)),o("span",ve,"¥"+c(R.value.toFixed(2)),1)])])]}),_:1})]),_:1},8,["model"])]),_:1}),o("div",fe,[a(I,{onClick:l.goBack,size:"large"},{default:n(()=>[...t[13]||(t[13]=[T("取消",-1)])]),_:1},8,["onClick"]),a(I,{type:"primary",size:"large",onClick:E,loading:b.value,disabled:!m.value},{default:n(()=>[...t[14]||(t[14]=[T(" 确认预订 ",-1)])]),_:1},8,["loading","disabled"])])])])}}},Ve=G(ge,[["__scopeId","data-v-5c37df96"]]);export{Ve as default};
