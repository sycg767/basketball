import{_ as S,j as W,r as y,w as V,c as $,a as n,b as a,e as s,v as p,f as c,O as g,u as w,ad as P,a9 as k,i as x,m as j,o as O,E as m,D as A}from"./index-DqRIPXSt.js";import{p as R}from"./course-CXNwJnW4.js";import{a as G}from"./member-Ch_HX4wW.js";const H={class:"payment-dialog-content"},J={class:"order-info"},K={class:"info-item"},L={class:"value"},Q={class:"info-item"},X={class:"value"},Y={class:"info-item"},Z={class:"value amount"},ee={class:"payment-methods"},ae={class:"method-content"},oe={class:"method-icon wechat"},se={class:"method-content"},te={class:"method-icon alipay"},le={class:"method-content"},ne={class:"method-icon balance"},re={class:"method-info"},ie={class:"dialog-footer"},de={__name:"CoursePaymentDialog",props:{modelValue:{type:Boolean,default:!1},enrollmentId:{type:[Number,String],required:!0},orderInfo:{type:Object,default:()=>({courseName:"",enrollmentNo:"",amount:"0.00"})}},emits:["update:modelValue","success"],setup(f,{emit:B}){const t=f,I=B,_=j(),z=W(),r=y(!1),i=y(!1),l=y("wechat"),v=y("0.00");V(()=>t.modelValue,o=>{r.value=o,o&&T()}),V(r,o=>{I("update:modelValue",o)});const T=async()=>{var o;try{const e=await G();e.code===200&&(v.value=(e.data||0).toFixed(2))}catch(e){console.error("获取用户余额失败:",e);const d=((o=z.userInfo)==null?void 0:o.balance)||0;v.value=d.toFixed(2)}},M=async()=>{if(!l.value){m.warning("请选择支付方式");return}i.value=!0;try{switch(l.value){case"wechat":await U();break;case"alipay":await q();break;case"balance":await D();break;default:m.error("不支持的支付方式"),i.value=!1}}catch(o){console.error("支付失败:",o),m.error(o.message||"支付失败"),i.value=!1}},U=async()=>{r.value=!1,_.push({path:"/payment/wechat",query:{businessNo:t.enrollmentId,businessType:"course",businessName:t.orderInfo.courseName,amount:t.orderInfo.amount}})},q=async()=>{r.value=!1,_.push({path:"/payment/alipay",query:{businessNo:t.enrollmentId,businessType:"course",businessName:t.orderInfo.courseName,amount:t.orderInfo.amount}})},D=async()=>{try{const o=parseFloat(v.value),e=parseFloat(t.orderInfo.amount);if(o<e){m.error("余额不足，请充值后再试"),i.value=!1;return}await A.confirm(`确认使用余额支付 ¥${t.orderInfo.amount} 吗？`,"确认支付",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const d=await R(t.enrollmentId,{paymentMethod:2,paymentType:""});d.code===200?(m.success("支付成功！"),r.value=!1,I("success"),setTimeout(()=>{_.push({path:"/payment/result",query:{status:"success",orderNo:t.orderInfo.enrollmentNo,amount:t.orderInfo.amount,paymentMethod:"余额支付",type:"course"}})},500)):(m.error(d.message||"支付失败"),i.value=!1)}catch(o){if(o==="cancel"){i.value=!1;return}throw o}},N=()=>{r.value=!1,i.value=!1,l.value="wechat"};return(o,e)=>{const d=c("el-divider"),h=c("el-icon"),b=c("el-radio"),E=c("el-radio-group"),C=c("el-button"),F=c("el-dialog");return O(),$(F,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=u=>r.value=u),title:"课程支付",width:"600px","close-on-click-modal":!1,onClose:N},{footer:n(()=>[a("div",ie,[s(C,{onClick:N},{default:n(()=>[...e[13]||(e[13]=[x("取消",-1)])]),_:1}),s(C,{type:"primary",loading:i.value,disabled:!l.value,onClick:M},{default:n(()=>[x(" 确认支付 ¥"+p(f.orderInfo.amount||"0.00"),1)]),_:1},8,["loading","disabled"])])]),default:n(()=>[a("div",H,[a("div",J,[e[8]||(e[8]=a("h3",{class:"section-title"},"订单信息",-1)),a("div",K,[e[5]||(e[5]=a("span",{class:"label"},"课程名称:",-1)),a("span",L,p(f.orderInfo.courseName||"-"),1)]),a("div",Q,[e[6]||(e[6]=a("span",{class:"label"},"订单编号:",-1)),a("span",X,p(f.orderInfo.enrollmentNo||"-"),1)]),a("div",Y,[e[7]||(e[7]=a("span",{class:"label"},"订单金额:",-1)),a("span",Z,"¥"+p(f.orderInfo.amount||"0.00"),1)])]),s(d),a("div",ee,[e[12]||(e[12]=a("h3",{class:"section-title"},"选择支付方式",-1)),s(E,{modelValue:l.value,"onUpdate:modelValue":e[3]||(e[3]=u=>l.value=u),class:"method-group"},{default:n(()=>[a("div",{class:g(["method-item",{active:l.value==="wechat"}]),onClick:e[0]||(e[0]=u=>l.value="wechat")},[s(b,{value:"wechat",size:"large"},{default:n(()=>[a("div",ae,[a("div",oe,[s(h,{size:28},{default:n(()=>[s(w(P))]),_:1})]),e[9]||(e[9]=a("div",{class:"method-info"},[a("h4",null,"微信支付"),a("p",null,"推荐使用微信扫码支付")],-1))])]),_:1})],2),a("div",{class:g(["method-item",{active:l.value==="alipay"}]),onClick:e[1]||(e[1]=u=>l.value="alipay")},[s(b,{value:"alipay",size:"large"},{default:n(()=>[a("div",se,[a("div",te,[s(h,{size:28},{default:n(()=>[s(w(k))]),_:1})]),e[10]||(e[10]=a("div",{class:"method-info"},[a("h4",null,"支付宝支付"),a("p",null,"支持支付宝扫码或跳转支付")],-1))])]),_:1})],2),a("div",{class:g(["method-item",{active:l.value==="balance"}]),onClick:e[2]||(e[2]=u=>l.value="balance")},[s(b,{value:"balance",size:"large"},{default:n(()=>[a("div",le,[a("div",ne,[s(h,{size:28},{default:n(()=>[s(w(k))]),_:1})]),a("div",re,[e[11]||(e[11]=a("h4",null,"余额支付",-1)),a("p",null,"当前余额: ¥"+p(v.value),1)])])]),_:1})],2)]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"])}}},fe=S(de,[["__scopeId","data-v-a2e69c7a"]]);export{fe as C};
