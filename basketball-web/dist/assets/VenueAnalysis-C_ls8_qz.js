import{_ as V}from"./BarChart-CBA1hEbM.js";import{_ as w}from"./LineChart-BK58KCXo.js";import{h as P,i as B,j as E}from"./analytics-DUF9C8Sc.js";import{_ as N,r as o,n as z,E as M,d as U,b as n,e as t,a as s,f as l,R as $,o as d,c as g,g as x,Q as j}from"./index-Do8XCnNk.js";import"./index-D5fw03LZ.js";import"./request-fDvtbK_n.js";const F={class:"venue-analysis-container"},I={class:"card-header"},Q={__name:"VenueAnalysis",setup(q){const u=o(7),c=o(!1),f=o([]),p=o({xAxisData:[],series:[]}),m=o({xAxisData:[],series:[]});z(()=>{y(),h(),b()});const y=async()=>{c.value=!0;try{const e=await P({days:u.value,limit:10});e.code===200&&e.data&&e.data.length>0&&(p.value={xAxisData:e.data.map(a=>a.venueName),series:[{name:"使用率",data:e.data.map(a=>a.usageRate||0)}]})}catch{M.error("获取场地排行榜失败")}finally{c.value=!1}},h=async()=>{try{const e=await B({days:30});e.code===200&&e.data&&e.data.length>0&&(m.value={xAxisData:e.data.map(a=>a.analysisDate),series:[{name:"总收入",data:e.data.map(a=>a.totalRevenue||0)}]})}catch(e){console.error("获取收入分析失败:",e)}},b=async()=>{try{const e=await E({days:7});e.code===200&&e.data&&(f.value=e.data||[])}catch(e){console.error("获取高峰时段失败:",e)}},k=e=>e>=80?"#67C23A":e>=60?"#E6A23C":"#F56C6C";return(e,a)=>{const _=l("el-option"),A=l("el-select"),v=l("el-card"),r=l("el-table-column"),D=l("el-progress"),C=l("el-table"),R=$("loading");return d(),U("div",F,[a[4]||(a[4]=n("h2",{class:"page-title"},"场地使用分析",-1)),t(v,null,{header:s(()=>[n("div",I,[a[1]||(a[1]=n("span",null,"场地使用率排行",-1)),t(A,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=i=>u.value=i),onChange:y,size:"small",style:{width:"120px"}},{default:s(()=>[t(_,{label:"最近7天",value:7}),t(_,{label:"最近15天",value:15}),t(_,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:s(()=>[p.value.xAxisData?(d(),g(V,{key:0,data:p.value,height:"400px","y-axis-name":"使用率(%)",horizontal:!0},null,8,["data"])):x("",!0)]),_:1}),t(v,{class:"revenue-card"},{header:s(()=>[...a[2]||(a[2]=[n("span",null,"场地收入分析",-1)])]),default:s(()=>[m.value.xAxisData?(d(),g(w,{key:0,data:m.value,height:"350px","y-axis-name":"收入(元)","show-area":!0},null,8,["data"])):x("",!0)]),_:1}),t(v,null,{header:s(()=>[...a[3]||(a[3]=[n("span",null,"高峰时段分布",-1)])]),default:s(()=>[j((d(),g(C,{data:f.value,stripe:""},{default:s(()=>[t(r,{prop:"period",label:"时段",width:"120"}),t(r,{prop:"bookingCount",label:"预订次数",width:"120"}),t(r,{prop:"usageRate",label:"使用率",width:"120"},{default:s(({row:i})=>[t(D,{percentage:i.usageRate,color:k(i.usageRate)},null,8,["percentage","color"])]),_:1}),t(r,{prop:"revenue",label:"收入(元)"})]),_:1},8,["data"])),[[R,c.value]])]),_:1})])}}},S=N(Q,[["__scopeId","data-v-1461f01a"]]);export{S as default};
