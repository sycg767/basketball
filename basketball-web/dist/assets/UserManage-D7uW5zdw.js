import{_ as Q,r as L,k as C,t as W,d as X,b as Y,e,a as t,f as r,E as _,a4 as Z,o as h,i as c,u as v,a5 as ee,N as ae,a3 as le,c as U,B as k,aw as te,az as ne,aA as oe,M as se}from"./index-zUzrFZpX.js";import{w as re,x as ue,y as de}from"./admin-CAaDuMXk.js";const me={class:"user-manage-container"},ie={__name:"UserManage",setup(pe){const x=L(!1),f=L(!1),y=L(null),d=C({username:"",memberLevel:""}),m=C({page:1,pageSize:10,total:0}),w=L([]),o=C({id:null,username:"",realName:"",phone:"",memberLevel:0,balance:0}),B={realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],memberLevel:[{required:!0,message:"请选择会员等级",trigger:"change"}]},b=async()=>{x.value=!0;try{const n={page:m.page,pageSize:m.pageSize,username:d.username||void 0,memberLevel:d.memberLevel!==""?d.memberLevel:void 0},a=await re(n);w.value=a.data.records.map(s=>({id:s.id,username:s.username,realName:s.realName||"-",phone:s.phone,memberLevel:s.memberLevel||0,balance:s.balance||0,registerTime:s.createTime,status:s.status})),m.total=a.data.total}catch(n){_.error(n.message||"获取用户列表失败")}finally{x.value=!1}},$=n=>({0:"info",1:"",2:"warning",3:"danger"})[n]||"info",D=n=>({0:"普通会员",1:"银卡会员",2:"金卡会员",3:"钻石会员"})[n]||"未知",N=()=>{m.page=1,b()},F=()=>{d.username="",d.memberLevel="",N()},E=n=>{Object.assign(o,n),f.value=!0},R=async n=>{const a=n.status===1?"禁用":"启用",s=n.status===1?0:1;try{await se.confirm(`确定要${a}用户"${n.username}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ue(n.id,s),_.success(`${a}成功`),b()}catch(u){u!=="cancel"&&_.error(u.message||`${a}失败`)}},j=async()=>{if(y.value)try{if(!await y.value.validate())return;const a={realName:o.realName,phone:o.phone,memberLevel:o.memberLevel,balance:o.balance};await de(o.id,a),_.success("修改成功"),f.value=!1,b()}catch(n){_.error(n.message||"修改失败")}},q=()=>{var n;(n=y.value)==null||n.resetFields(),Object.assign(o,{id:null,username:"",realName:"",phone:"",memberLevel:0,balance:0})},I=()=>{b()},O=()=>{b()};return W(()=>{b()}),(n,a)=>{const s=r("el-input"),u=r("el-form-item"),i=r("el-option"),S=r("el-select"),V=r("el-icon"),g=r("el-button"),z=r("el-form"),M=r("el-card"),p=r("el-table-column"),T=r("el-tag"),P=r("el-table"),A=r("el-pagination"),G=r("el-input-number"),H=r("el-dialog"),J=Z("loading");return h(),X("div",me,[a[16]||(a[16]=Y("h2",{class:"page-title"},"用户管理",-1)),e(M,{class:"search-card"},{default:t(()=>[e(z,{inline:!0,model:d},{default:t(()=>[e(u,{label:"用户名"},{default:t(()=>[e(s,{modelValue:d.username,"onUpdate:modelValue":a[0]||(a[0]=l=>d.username=l),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(u,{label:"会员等级"},{default:t(()=>[e(S,{modelValue:d.memberLevel,"onUpdate:modelValue":a[1]||(a[1]=l=>d.memberLevel=l),placeholder:"请选择会员等级",clearable:""},{default:t(()=>[e(i,{label:"全部",value:""}),e(i,{label:"普通会员",value:0}),e(i,{label:"银卡会员",value:1}),e(i,{label:"金卡会员",value:2}),e(i,{label:"钻石会员",value:3})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(g,{type:"primary",onClick:N},{default:t(()=>[e(V,null,{default:t(()=>[e(v(ee))]),_:1}),a[11]||(a[11]=c(" 搜索 ",-1))]),_:1}),e(g,{onClick:F},{default:t(()=>[e(V,null,{default:t(()=>[e(v(ae))]),_:1}),a[12]||(a[12]=c(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(M,{class:"table-card"},{default:t(()=>[le((h(),U(P,{data:w.value,stripe:""},{default:t(()=>[e(p,{prop:"id",label:"ID",width:"80"}),e(p,{prop:"username",label:"用户名",width:"120"}),e(p,{prop:"realName",label:"真实姓名",width:"120"}),e(p,{prop:"phone",label:"手机号",width:"130"}),e(p,{prop:"memberLevel",label:"会员等级",width:"120"},{default:t(({row:l})=>[e(T,{type:$(l.memberLevel)},{default:t(()=>[c(k(D(l.memberLevel)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"balance",label:"账户余额",width:"120"},{default:t(({row:l})=>[c(" ¥"+k(l.balance.toFixed(2)),1)]),_:1}),e(p,{prop:"registerTime",label:"注册时间",width:"180"}),e(p,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[e(T,{type:l.status===1?"success":"danger"},{default:t(()=>[c(k(l.status===1?"正常":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[e(g,{type:"primary",link:"",onClick:K=>E(l)},{default:t(()=>[e(V,null,{default:t(()=>[e(v(te))]),_:1}),a[13]||(a[13]=c(" 编辑 ",-1))]),_:1},8,["onClick"]),e(g,{type:l.status===1?"warning":"success",link:"",onClick:K=>R(l)},{default:t(()=>[e(V,null,{default:t(()=>[l.status===1?(h(),U(v(ne),{key:0})):(h(),U(v(oe),{key:1}))]),_:2},1024),c(" "+k(l.status===1?"禁用":"启用"),1)]),_:2},1032,["type","onClick"])]),_:1})]),_:1},8,["data"])),[[J,x.value]]),e(A,{"current-page":m.page,"onUpdate:currentPage":a[2]||(a[2]=l=>m.page=l),"page-size":m.pageSize,"onUpdate:pageSize":a[3]||(a[3]=l=>m.pageSize=l),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:O,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(H,{modelValue:f.value,"onUpdate:modelValue":a[10]||(a[10]=l=>f.value=l),title:"编辑用户",width:"500px",onClose:q},{footer:t(()=>[e(g,{onClick:a[9]||(a[9]=l=>f.value=!1)},{default:t(()=>[...a[14]||(a[14]=[c("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:j},{default:t(()=>[...a[15]||(a[15]=[c("确定",-1)])]),_:1})]),default:t(()=>[e(z,{ref_key:"userFormRef",ref:y,model:o,rules:B,"label-width":"100px"},{default:t(()=>[e(u,{label:"用户名"},{default:t(()=>[e(s,{modelValue:o.username,"onUpdate:modelValue":a[4]||(a[4]=l=>o.username=l),disabled:""},null,8,["modelValue"])]),_:1}),e(u,{label:"真实姓名",prop:"realName"},{default:t(()=>[e(s,{modelValue:o.realName,"onUpdate:modelValue":a[5]||(a[5]=l=>o.realName=l),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),e(u,{label:"手机号",prop:"phone"},{default:t(()=>[e(s,{modelValue:o.phone,"onUpdate:modelValue":a[6]||(a[6]=l=>o.phone=l),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(u,{label:"会员等级",prop:"memberLevel"},{default:t(()=>[e(S,{modelValue:o.memberLevel,"onUpdate:modelValue":a[7]||(a[7]=l=>o.memberLevel=l),placeholder:"请选择会员等级"},{default:t(()=>[e(i,{label:"普通会员",value:0}),e(i,{label:"银卡会员",value:1}),e(i,{label:"金卡会员",value:2}),e(i,{label:"钻石会员",value:3})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"账户余额",prop:"balance"},{default:t(()=>[e(G,{modelValue:o.balance,"onUpdate:modelValue":a[8]||(a[8]=l=>o.balance=l),min:0,precision:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ge=Q(ie,[["__scopeId","data-v-6d020474"]]);export{ge as default};
