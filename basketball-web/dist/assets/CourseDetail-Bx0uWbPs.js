import{_ as pe,j as me,r as v,k as _e,a0 as U,t as fe,d as m,e as t,c as _,g as f,a as n,f as d,a7 as ye,E as g,m as ge,o as r,b as e,u as c,ab as he,v as a,i as h,y as O,I as be,V as ke,ac as xe,F as q,N as G,A as Ce,U as we,a2 as De}from"./index-BU1z93KZ.js";import{b as Pe,d as Ve,e as Ne,f as Me}from"./course-a8-PN5Sg.js";import{B as Ue}from"./BackButton-CN15_tN6.js";import{C as Se}from"./CoursePaymentDialog-BSggdc5v.js";import"./member-Cz1wm3WK.js";const Ie={class:"course-detail-container"},Le={class:"course-header"},Te={class:"course-cover"},Be={class:"image-slot"},Fe={class:"course-basic-info"},Ee={class:"course-header-top"},Ae={class:"course-name"},Re={class:"course-stats"},$e={class:"stat-item"},Ye={class:"stat-item"},je={class:"stat-item"},ze={class:"stat-item"},Oe={class:"course-attributes"},qe={class:"attr-row"},Ge={class:"attr-row"},He={class:"attr-row"},Je={class:"attr-row"},Ke={class:"attr-row"},Qe={class:"course-price"},We={class:"price-item"},Xe={class:"price-value"},Ze={key:0,class:"price-item"},es={class:"price-value member"},ss={class:"course-description"},ts={key:0,class:"course-syllabus"},ls={key:2,class:"course-video"},as=["src"],os={class:"card-header"},ns={class:"date-filter"},us={key:0,class:"schedule-list"},rs={class:"schedule-info"},is={class:"schedule-date"},ds={class:"schedule-time"},cs={class:"schedule-venue"},vs={class:"schedule-seats"},ps={class:"schedule-action"},ms={class:"price-detail"},_s={class:"price-row"},fs={key:0,class:"price-row discount"},ys={class:"price-row total"},gs={key:1,class:"points-slider"},hs={class:"points-info"},bs={class:"final-amount"},ks={__name:"CourseDetail",setup(xs){const A=ye(),H=ge(),b=me(),u=v(null),S=v([]),x=v([]),w=v(!1),V=v(null),I=_e({scheduleId:null}),p=v({basePrice:0,memberPrice:0,actualPrice:0,discountAmount:0,hasCard:!1,cardName:"",discount:1,canUsePoints:!1,maxPointsDeduct:0}),y=v(!1),k=v(100),D=v(0);U(()=>p.value.actualPrice||0);const N=U(()=>(b.points||0)>=100),R=U(()=>{const l=b.points||0,s=p.value.maxPointsDeduct||0,i=Math.floor(s*100);return Math.min(l,i)}),$=U(()=>{const l=p.value.actualPrice||0,s=y.value?D.value:0;return Math.max(0,l-s)}),J=l=>({1:9.5,2:9,3:8.5,4:8,5:7.5})[l]||10,K=async()=>{try{const{data:l}=await Pe(A.params.id);u.value=l}catch{g.error("获取课程详情失败")}},L=async()=>{try{const l={};x.value&&x.value.length===2&&(l.startDate=x.value[0],l.endDate=x.value[1]);const{data:s}=await Ve(A.params.id,l);S.value=s||[]}catch{g.error("获取课程排期失败")}},Q=l=>{const s=new Date(l);return`${l} ${["周日","周一","周二","周三","周四","周五","周六"][s.getDay()]}`},W=async l=>{if(!b.isLogin){g.warning("请先登录"),H.push("/login");return}V.value=l,I.scheduleId=l.id;try{const{data:s}=await Ne({scheduleId:l.id,courseId:u.value.id});p.value=s,y.value=!1,k.value=100,D.value=0,w.value=!0}catch{g.error("获取价格信息失败")}},Y=()=>{D.value=k.value/100},X=l=>{if(!l)k.value=100,D.value=0;else{if(!N.value){y.value=!1,g.warning("积分不足，最少需要 100 积分才能使用抵扣功能");return}Y()}},T=v(!1),j=v({courseName:"",enrollmentNo:"",amount:"0.00"}),z=v(0),Z=async()=>{var l;try{const s={scheduleId:I.scheduleId,usePoints:y.value,pointsToUse:y.value?k.value:0},{data:i}=await Me(s);g.success("报名成功，请完成支付"),w.value=!1,z.value=i,j.value={courseName:((l=u.value)==null?void 0:l.courseName)||"课程报名",enrollmentNo:`ENR${i}`,amount:$.value.toFixed(2)},T.value=!0}catch(s){g.error(s.message||"报名失败")}},ee=()=>{g.success("支付成功！"),L()},se=l=>({1:"基础班",2:"提高班",3:"专业班",4:"私教课"})[l]||"未知",te=l=>({1:"success",2:"primary",3:"warning",4:"danger"})[l]||"info",le=l=>({1:"入门",2:"初级",3:"中级",4:"高级"})[l]||"未知",ae=l=>({1:"success",2:"primary",3:"warning",4:"danger"})[l]||"info";return fe(()=>{K(),L()}),(l,s)=>{const i=d("el-icon"),oe=d("el-image"),M=d("el-tag"),B=d("el-divider"),F=d("el-card"),ne=d("el-date-picker"),E=d("el-button"),ue=d("el-empty"),C=d("el-form-item"),re=d("el-checkbox"),ie=d("el-alert"),de=d("el-slider"),ce=d("el-form"),ve=d("el-dialog");return r(),m("div",Ie,[t(Ue,{text:"返回列表"}),u.value?(r(),_(F,{key:0,class:"course-card"},{default:n(()=>[e("div",Le,[e("div",Te,[t(oe,{src:u.value.coverImage||"/images/default-course.jpg",fit:"cover",class:"cover-image"},{error:n(()=>[e("div",Be,[t(i,null,{default:n(()=>[t(c(he))]),_:1})])]),_:1},8,["src"])]),e("div",Fe,[e("div",Ee,[e("h1",Ae,a(u.value.courseName),1),t(M,{type:te(u.value.courseType),size:"large"},{default:n(()=>[h(a(se(u.value.courseType)),1)]),_:1},8,["type"])]),e("div",Re,[e("div",$e,[t(i,null,{default:n(()=>[t(c(O))]),_:1}),e("span",null,"教练："+a(u.value.coachName),1)]),e("div",Ye,[t(i,null,{default:n(()=>[t(c(be))]),_:1}),e("span",null,"评分："+a(u.value.rating||"5.0"),1)]),e("div",je,[t(i,null,{default:n(()=>[t(c(ke))]),_:1}),e("span",null,"浏览："+a(u.value.viewCount||0),1)]),e("div",ze,[t(i,null,{default:n(()=>[t(c(xe))]),_:1}),e("span",null,"报名："+a(u.value.enrollCount||0)+"人",1)])]),e("div",Oe,[e("div",qe,[s[6]||(s[6]=e("span",{class:"attr-label"},"难度等级：",-1)),t(M,{type:ae(u.value.difficultyLevel)},{default:n(()=>[h(a(le(u.value.difficultyLevel)),1)]),_:1},8,["type"])]),e("div",Ge,[s[7]||(s[7]=e("span",{class:"attr-label"},"适合年龄：",-1)),e("span",null,a(u.value.ageRange),1)]),e("div",He,[s[8]||(s[8]=e("span",{class:"attr-label"},"课程人数：",-1)),e("span",null,a(u.value.minStudents)+"-"+a(u.value.maxStudents)+"人",1)]),e("div",Je,[s[9]||(s[9]=e("span",{class:"attr-label"},"课程时长：",-1)),e("span",null,a(u.value.duration)+"分钟/节",1)]),e("div",Ke,[s[10]||(s[10]=e("span",{class:"attr-label"},"总课时：",-1)),e("span",null,a(u.value.totalSessions)+"节课",1)])]),e("div",Qe,[e("div",We,[s[11]||(s[11]=e("span",{class:"price-label"},"课程价格：",-1)),e("span",Xe,"¥"+a(u.value.price),1)]),c(b).userInfo&&c(b).memberLevel>0?(r(),m("div",Ze,[s[12]||(s[12]=e("span",{class:"price-label"},"会员折扣：",-1)),e("span",es,a(J(c(b).memberLevel))+"折",1)])):f("",!0)])])]),t(B),e("div",ss,[s[13]||(s[13]=e("h3",null,"课程介绍",-1)),e("p",null,a(u.value.description),1)]),t(B),u.value.syllabusList&&u.value.syllabusList.length>0?(r(),m("div",ts,[s[14]||(s[14]=e("h3",null,"课程大纲",-1)),e("ul",null,[(r(!0),m(q,null,G(u.value.syllabusList,(o,P)=>(r(),m("li",{key:P},a(o),1))),128))])])):f("",!0),u.value.videoUrl?(r(),_(B,{key:1})):f("",!0),u.value.videoUrl?(r(),m("div",ls,[s[15]||(s[15]=e("h3",null,"课程视频",-1)),e("video",{src:u.value.videoUrl,controls:"",class:"video-player"},null,8,as)])):f("",!0)]),_:1})):f("",!0),u.value?(r(),_(F,{key:1,class:"schedule-card"},{header:n(()=>[e("div",os,[s[16]||(s[16]=e("span",null,"课程排期",-1)),e("div",ns,[t(ne,{modelValue:x.value,"onUpdate:modelValue":s[0]||(s[0]=o=>x.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD",onChange:L},null,8,["modelValue"])])])]),default:n(()=>[S.value.length>0?(r(),m("div",us,[(r(!0),m(q,null,G(S.value,o=>(r(),_(F,{key:o.id,class:"schedule-item",shadow:"hover"},{default:n(()=>[e("div",rs,[e("div",is,[t(i,null,{default:n(()=>[t(c(Ce))]),_:1}),e("span",null,a(Q(o.scheduleDate)),1)]),e("div",ds,[t(i,null,{default:n(()=>[t(c(we))]),_:1}),e("span",null,a(o.timeSlot),1)]),e("div",cs,[t(i,null,{default:n(()=>[t(c(De))]),_:1}),e("span",null,a(o.venueName),1)]),e("div",vs,[t(i,null,{default:n(()=>[t(c(O))]),_:1}),e("span",null,"剩余名额："+a(o.remainingSeats)+"/"+a(o.maxStudents),1)])]),e("div",ps,[o.status===2?(r(),_(M,{key:0,type:"danger",effect:"dark"},{default:n(()=>[...s[17]||(s[17]=[h(" 已满员 ",-1)])]),_:1})):o.status===5?(r(),_(M,{key:1,type:"info",effect:"dark"},{default:n(()=>[...s[18]||(s[18]=[h(" 已取消 ",-1)])]),_:1})):(r(),_(E,{key:2,type:"primary",disabled:o.status!==1,onClick:P=>W(o)},{default:n(()=>[...s[19]||(s[19]=[h(" 立即报名 ",-1)])]),_:1},8,["disabled","onClick"]))])]),_:2},1024))),128))])):(r(),_(ue,{key:1,description:"暂无排期数据"}))]),_:1})):f("",!0),t(ve,{modelValue:w.value,"onUpdate:modelValue":s[4]||(s[4]=o=>w.value=o),title:"课程报名",width:"600px"},{footer:n(()=>[t(E,{onClick:s[3]||(s[3]=o=>w.value=!1)},{default:n(()=>[...s[23]||(s[23]=[h("取消",-1)])]),_:1}),t(E,{type:"primary",onClick:Z},{default:n(()=>[...s[24]||(s[24]=[h("确认报名",-1)])]),_:1})]),default:n(()=>[t(ce,{model:I,"label-width":"100px"},{default:n(()=>[t(C,{label:"课程名称"},{default:n(()=>{var o;return[e("span",null,a((o=u.value)==null?void 0:o.courseName),1)]}),_:1}),t(C,{label:"上课时间"},{default:n(()=>{var o,P;return[e("span",null,a((o=V.value)==null?void 0:o.scheduleDate)+" "+a((P=V.value)==null?void 0:P.timeSlot),1)]}),_:1}),t(C,{label:"上课地点"},{default:n(()=>{var o;return[e("span",null,a((o=V.value)==null?void 0:o.venueName),1)]}),_:1}),t(C,{label:"课程价格"},{default:n(()=>[e("div",ms,[e("div",_s,[s[20]||(s[20]=e("span",null,"原价:",-1)),e("span",null,"¥"+a(p.value.basePrice),1)]),p.value.hasCard?(r(),m("div",fs,[e("span",null,a(p.value.cardName)+":",1),e("span",null,"-¥"+a(p.value.discountAmount.toFixed(2)),1)])):f("",!0),e("div",ys,[s[21]||(s[21]=e("span",null,"小计:",-1)),e("span",null,"¥"+a(p.value.actualPrice.toFixed(2)),1)])])]),_:1}),p.value.canUsePoints?(r(),_(C,{key:0,label:"使用积分"},{default:n(()=>[t(re,{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=o=>y.value=o),onChange:X,disabled:!N.value},{default:n(()=>[h(" 使用积分抵扣（可用: "+a(c(b).points||0)+"） ",1)]),_:1},8,["modelValue","disabled"]),N.value?f("",!0):(r(),_(ie,{key:0,type:"warning",closable:!1,"show-icon":"",style:{"margin-top":"8px"}},{title:n(()=>[...s[22]||(s[22]=[e("span",{style:{"font-size":"13px"}}," 积分不足，最少需要 100 积分才能使用抵扣功能 ",-1)])]),_:1})),y.value&&N.value&&R.value>=100?(r(),m("div",gs,[t(de,{modelValue:k.value,"onUpdate:modelValue":s[2]||(s[2]=o=>k.value=o),min:100,max:Math.max(100,R.value),step:100,onChange:Y},null,8,["modelValue","max"]),e("div",hs,[e("span",null,"使用 "+a(k.value)+" 积分",1),e("span",null,"抵扣 ¥"+a(D.value.toFixed(2)),1)])])):f("",!0)]),_:1})):f("",!0),t(C,{label:"应付金额"},{default:n(()=>[e("span",bs,"¥"+a($.value.toFixed(2)),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(Se,{modelValue:T.value,"onUpdate:modelValue":s[5]||(s[5]=o=>T.value=o),"enrollment-id":z.value,"order-info":j.value,onSuccess:ee},null,8,["modelValue","enrollment-id","order-info"])])}}},Ns=pe(ks,[["__scopeId","data-v-72c74be0"]]);export{Ns as default};
