import{_ as q,r as v,t as O,S as j,d as m,b as s,e as o,i,c as C,g as h,a,u as k,y as G,f as y,B as c,O as J,F as K,x as P,E as x,m as Q,o as u,T as W,U as X,V as Y}from"./index-DU9PCbH8.js";import{r as B}from"./request-KjaGbLG7.js";const Z={class:"announcement-section"},ee={class:"section-header"},te={class:"section-title"},se={class:"announcement-list"},ne={key:0,class:"empty-announcements"},oe=["onClick"],ae={class:"announcement-content"},le={class:"announcement-type"},ie=["title"],re=["title"],ce={class:"announcement-meta"},ue={class:"publish-time"},de={class:"view-count"},_e={class:"announcement-actions"},pe={key:0,class:"announcement-detail"},fe={class:"announcement-header"},ve={class:"announcement-type-tag"},me={class:"announcement-time"},ye={class:"announcement-content-detail"},ge=["innerHTML"],he={class:"announcement-footer"},ke={class:"view-count"},we={class:"dialog-footer"},Ce={__name:"AnnouncementSection",setup(xe){const D=Q(),_=v([]),p=v(!1),l=v(null),T=v(!1),g=v(null),A={1:{text:"系统通知",tag:"danger"},2:{text:"维护通知",tag:"warning"},3:{text:"节日通知",tag:"success"},4:{text:"活动通知",tag:"primary"}},b=async()=>{try{T.value=!0;const t=await B.get("/api/announcement/page",{params:{current:1,size:5,status:1}});t.code===200&&(_.value=t.data.records.map(e=>({...e,isRead:!1})))}catch(t){console.error("获取公告失败:",t),x.error("获取公告失败")}finally{T.value=!1}},V=t=>{var e;return((e=A[t])==null?void 0:e.tag)||"info"},M=t=>{var e;return((e=A[t])==null?void 0:e.text)||"其他"},N=(t,e=60)=>t?t.length>e?t.substring(0,e)+"...":t:"",R=t=>{if(!t)return"";const e=new Date(t),r=new Date-e;return r<60*60*1e3?"刚刚":r<24*60*60*1e3?`${Math.floor(r/36e5)}小时前`:r<7*24*60*60*1e3?`${Math.floor(r/864e5)}天前`:e.toLocaleDateString()},S=t=>t?t.replace(/\n/g,"<br>"):"",E=t=>{l.value=t,p.value=!0,t.viewCount!==void 0&&t.viewCount++},z=async t=>{try{(await B.post(`/api/announcement/read/${t.id}`)).code===200&&(t.isRead=!0,x.success("已标记为已读"))}catch(e){console.error("标记已读失败:",e),x.error("标记已读失败")}},I=()=>{D.push("/notification/list")},L=()=>{g.value=setInterval(()=>{b()},5*60*1e3)},U=()=>{g.value&&(clearInterval(g.value),g.value=null)};return O(()=>{b(),L()}),j(()=>{U()}),(t,e)=>{var $;const f=y("el-icon"),r=y("el-tag"),d=y("el-button"),F=y("el-empty"),H=y("el-dialog");return u(),m("div",Z,[s("div",ee,[s("h3",te,[o(f,{color:"#f56c6c"},{default:a(()=>[o(k(G))]),_:1}),e[3]||(e[3]=i(" 系统公告 ",-1)),_.value.length>0?(u(),C(r,{key:0,type:"info",size:"small"},{default:a(()=>[i(c(_.value.length)+" 条 ",1)]),_:1})):h("",!0)]),o(d,{type:"primary",link:"",size:"small",onClick:I},{default:a(()=>[e[4]||(e[4]=i(" 查看全部 ",-1)),o(f,null,{default:a(()=>[o(k(J))]),_:1})]),_:1})]),s("div",se,[_.value.length===0?(u(),m("div",ne,[o(F,{description:"暂无公告","image-size":80},{description:a(()=>[...e[5]||(e[5]=[s("span",{class:"empty-text"},"暂无系统公告",-1)])]),_:1})])):(u(!0),m(K,{key:1},P(_.value,n=>(u(),m("div",{class:"announcement-item",key:n.id,onClick:w=>E(n)},[s("div",ae,[s("div",le,[o(r,{type:V(n.type),size:"small",effect:"plain"},{default:a(()=>[i(c(M(n.type)),1)]),_:2},1032,["type"])]),s("h4",{class:"announcement-title",title:n.title},c(n.title),9,ie),s("p",{class:"announcement-desc",title:n.content},c(N(n.content)),9,re),s("div",ce,[s("span",ue,[o(f,null,{default:a(()=>[o(k(W))]),_:1}),i(" "+c(R(n.publishTime)),1)]),s("span",de,[o(f,null,{default:a(()=>[o(k(X))]),_:1}),i(" "+c(n.viewCount||0)+" 阅读 ",1)])])]),s("div",_e,[n.isRead?h("",!0):(u(),C(d,{key:0,type:"primary",link:"",size:"small",onClick:Y(w=>z(n),["stop"])},{default:a(()=>[...e[6]||(e[6]=[i(" 标记已读 ",-1)])]),_:1},8,["onClick"]))])],8,oe))),128))]),o(H,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=n=>p.value=n),title:($=l.value)==null?void 0:$.title,width:"600px","destroy-on-close":""},{footer:a(()=>{var n;return[s("div",we,[o(d,{onClick:e[0]||(e[0]=w=>p.value=!1)},{default:a(()=>[...e[7]||(e[7]=[i("关闭",-1)])]),_:1}),(n=l.value)!=null&&n.isRead?h("",!0):(u(),C(d,{key:0,type:"primary",onClick:e[1]||(e[1]=w=>{z(l.value),p.value=!1})},{default:a(()=>[...e[8]||(e[8]=[i(" 标记已读 ",-1)])]),_:1}))])]}),default:a(()=>[l.value?(u(),m("div",pe,[s("div",fe,[s("div",ve,[o(r,{type:V(l.value.type),size:"small"},{default:a(()=>[i(c(M(l.value.type)),1)]),_:1},8,["type"])]),s("div",me,[s("span",null,"发布时间："+c(R(l.value.publishTime)),1)])]),s("div",ye,[s("div",{class:"content-text",innerHTML:S(l.value.content)},null,8,ge)]),s("div",he,[s("span",ke,"阅读量："+c(l.value.viewCount||0),1)])])):h("",!0)]),_:1},8,["modelValue","title"])])}}},be=q(Ce,[["__scopeId","data-v-611a6058"]]);export{be as A};
