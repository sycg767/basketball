import{k as Le,l as qe,m as Ne,n as Re,o as ze,p as Be,q as Fe,r as Me,t as $e,v as Ee}from"./admin-zXaSWenD.js";import{_ as je,r as c,k as P,t as Oe,d as le,e,a,f as n,E as f,a5 as Pe,o as U,i as s,a4 as te,b as q,c as H,v as b,F as He,N as Ye,D as ae}from"./index-BU1z93KZ.js";const Ae={class:"course-manage-container"},Je={class:"pagination-container"},Ge={class:"schedule-header"},Ke={__name:"CourseManage",setup(Qe){const N=c(!1),Y=c([]),A=c(0),g=P({keyword:"",courseType:"",status:"",page:1,pageSize:10}),C=c(!1),R=c(""),D=c(null),z=c(!1),u=P({id:null,courseName:"",courseCode:"",courseType:null,coachId:null,maxStudents:20,minStudents:10,price:0,duration:90,totalSessions:12,difficultyLevel:null,ageRange:"",description:"",coverImage:"",status:1}),V=c(""),J=c([]),oe={courseName:[{required:!0,message:"请输入课程名称",trigger:"blur"}],courseCode:[{required:!0,message:"请输入课程编号",trigger:"blur"}],courseType:[{required:!0,message:"请选择课程类型",trigger:"change"}],coachId:[{required:!0,message:"请选择教练",trigger:"change"}],difficultyLevel:[{required:!0,message:"请选择难度等级",trigger:"change"}],minStudents:[{required:!0,message:"请输入最小人数",trigger:"blur"}],maxStudents:[{required:!0,message:"请输入最大人数",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],duration:[{required:!0,message:"请输入课时",trigger:"blur"}],totalSessions:[{required:!0,message:"请输入总课时数",trigger:"blur"}],description:[{required:!0,message:"请输入课程描述",trigger:"blur"}]},B=c(!1),F=c(!1),G=c([]),w=c(null),x=c(!1),I=c(null),M=c(!1),m=P({courseId:null,venueId:null,scheduleDate:"",startTime:"",endTime:"",maxStudents:20,remark:""}),ue={venueId:[{required:!0,message:"请输入场地ID",trigger:"blur"}],scheduleDate:[{required:!0,message:"请选择上课日期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],maxStudents:[{required:!0,message:"请输入最大人数",trigger:"blur"}]},k=async()=>{try{N.value=!0;const{data:o}=await Le(g);Y.value=o.records||[],A.value=o.total||0}catch(o){console.error("获取课程列表失败:",o),f.error("获取课程列表失败")}finally{N.value=!1}},L=()=>{g.page=1,k()},re=()=>{Object.assign(g,{keyword:"",courseType:"",status:"",page:1,pageSize:10}),k()},ne=async()=>{await K(),R.value="添加课程",Q(),C.value=!0},se=async o=>{await K(),R.value="编辑课程";try{const{data:l}=await Ne(o.id);if(Object.assign(u,l),l.syllabus)try{const d=JSON.parse(l.syllabus);V.value=d.join(`
`)}catch{V.value=""}C.value=!0}catch(l){console.error("获取课程详情失败:",l),f.error("获取课程详情失败")}},de=o=>{ae.confirm(`确定要删除课程"${o.courseName}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Re(o.id),f.success("删除成功"),k()}catch(l){console.error("删除失败:",l),f.error("删除失败")}}).catch(()=>{})},ie=async o=>{try{await qe(o.id,o.status),f.success("状态更新成功")}catch(l){console.error("状态更新失败:",l),f.error("状态更新失败"),o.status=o.status===1?0:1}},me=async()=>{D.value&&await D.value.validate(async o=>{if(o)try{z.value=!0;const l={...u};V.value&&(l.syllabus=JSON.stringify(V.value.split(`
`).filter(d=>d.trim()))),u.id?(await ze(u.id,l),f.success("更新成功")):(await Be(l),f.success("添加成功")),C.value=!1,k()}catch(l){console.error("提交失败:",l),f.error("提交失败")}finally{z.value=!1}})},pe=async o=>{w.value=o,await $(o.id),B.value=!0},$=async o=>{try{F.value=!0;const{data:l}=await Ee(o);G.value=l||[]}catch(l){console.error("获取排期列表失败:",l),f.error("获取排期列表失败")}finally{F.value=!1}},ce=()=>{ye(),m.courseId=w.value.id,m.maxStudents=w.value.maxStudents,x.value=!0},fe=async()=>{I.value&&await I.value.validate(async o=>{if(o)try{M.value=!0,await Me(m),f.success("添加排期成功"),x.value=!1,$(w.value.id)}catch(l){console.error("添加排期失败:",l),f.error("添加排期失败")}finally{M.value=!1}})},ge=o=>{ae.prompt("请输入取消原因","取消排期",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/.+/,inputErrorMessage:"请输入取消原因"}).then(async({value:l})=>{try{await Fe(o.id,l),f.success("取消成功"),$(w.value.id)}catch(d){console.error("取消失败:",d),f.error("取消失败")}}).catch(()=>{})},ve=o=>{f.info("学员管理功能开发中...")},K=async()=>{try{const{data:o}=await $e();J.value=o.records||[]}catch(o){console.error("获取教练列表失败:",o)}},Q=()=>{var o;Object.assign(u,{id:null,courseName:"",courseCode:"",courseType:null,coachId:null,maxStudents:20,minStudents:10,price:0,duration:90,totalSessions:12,difficultyLevel:null,ageRange:"",description:"",coverImage:"",status:1}),V.value="",(o=D.value)==null||o.clearValidate()},ye=()=>{var o;Object.assign(m,{courseId:null,scheduleDate:"",startTime:"",endTime:"",maxStudents:20,remark:""}),(o=I.value)==null||o.clearValidate()},be=()=>{Q()},Ve=o=>({1:"基础班",2:"提高班",3:"专业班",4:"私教课"})[o]||"未知",_e=o=>({1:"success",2:"primary",3:"warning",4:"danger"})[o]||"info",Ce=o=>({1:"入门",2:"初级",3:"中级",4:"高级"})[o]||"未知",Se=o=>({1:"success",2:"primary",3:"warning",4:"danger"})[o]||"info",he=o=>({0:"未开始",1:"报名中",2:"已满员",3:"进行中",4:"已结束",5:"已取消"})[o]||"未知",we=o=>({0:"info",1:"primary",2:"warning",3:"",4:"success",5:"danger"})[o]||"info",xe=(o,l)=>{const d=o/l*100;return d<50?"#67c23a":d<80?"#e6a23c":"#f56c6c"};return Oe(()=>{k()}),(o,l)=>{const d=n("el-input"),r=n("el-form-item"),p=n("el-option"),T=n("el-select"),v=n("el-button"),E=n("el-form"),W=n("el-card"),i=n("el-table-column"),j=n("el-tag"),ke=n("el-switch"),X=n("el-table"),Te=n("el-pagination"),y=n("el-col"),S=n("el-row"),h=n("el-input-number"),Ue=n("el-alert"),O=n("el-dialog"),De=n("el-progress"),Ie=n("el-date-picker"),Z=n("el-time-picker"),ee=Pe("loading");return U(),le("div",Ae,[e(W,{class:"filter-card"},{default:a(()=>[e(E,{inline:!0,model:g,class:"search-form"},{default:a(()=>[e(r,{label:"课程名称"},{default:a(()=>[e(d,{modelValue:g.keyword,"onUpdate:modelValue":l[0]||(l[0]=t=>g.keyword=t),placeholder:"请输入课程名称",clearable:"",onClear:L},null,8,["modelValue"])]),_:1}),e(r,{label:"课程类型"},{default:a(()=>[e(T,{modelValue:g.courseType,"onUpdate:modelValue":l[1]||(l[1]=t=>g.courseType=t),placeholder:"请选择类型",clearable:""},{default:a(()=>[e(p,{label:"全部",value:""}),e(p,{label:"基础班",value:1}),e(p,{label:"提高班",value:2}),e(p,{label:"专业班",value:3}),e(p,{label:"私教课",value:4})]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"状态"},{default:a(()=>[e(T,{modelValue:g.status,"onUpdate:modelValue":l[2]||(l[2]=t=>g.status=t),placeholder:"请选择状态",clearable:""},{default:a(()=>[e(p,{label:"全部",value:""}),e(p,{label:"启用",value:1}),e(p,{label:"停用",value:0})]),_:1},8,["modelValue"])]),_:1}),e(r,null,{default:a(()=>[e(v,{type:"primary",icon:"Search",onClick:L},{default:a(()=>[...l[30]||(l[30]=[s("搜索",-1)])]),_:1}),e(v,{icon:"Refresh",onClick:re},{default:a(()=>[...l[31]||(l[31]=[s("重置",-1)])]),_:1}),e(v,{type:"primary",icon:"Plus",onClick:ne},{default:a(()=>[...l[32]||(l[32]=[s("添加课程",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(W,{class:"table-card"},{default:a(()=>[te((U(),H(X,{data:Y.value,stripe:"",border:""},{default:a(()=>[e(i,{prop:"id",label:"ID",width:"80"}),e(i,{prop:"courseName",label:"课程名称","min-width":"150"}),e(i,{prop:"courseCode",label:"课程编号",width:"140"}),e(i,{label:"课程类型",width:"100"},{default:a(({row:t})=>[e(j,{type:_e(t.courseType)},{default:a(()=>[s(b(Ve(t.courseType)),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"coachName",label:"教练",width:"100"}),e(i,{label:"难度",width:"100"},{default:a(({row:t})=>[e(j,{type:Se(t.difficultyLevel),size:"small"},{default:a(()=>[s(b(Ce(t.difficultyLevel)),1)]),_:2},1032,["type"])]),_:1}),e(i,{label:"人数",width:"100"},{default:a(({row:t})=>[s(b(t.minStudents)+"-"+b(t.maxStudents)+"人 ",1)]),_:1}),e(i,{label:"价格",width:"120"},{default:a(({row:t})=>[q("div",null,"¥"+b(t.price),1)]),_:1}),e(i,{prop:"duration",label:"时长(分钟)",width:"100"}),e(i,{label:"状态",width:"100"},{default:a(({row:t})=>[e(ke,{modelValue:t.status,"onUpdate:modelValue":_=>t.status=_,"active-value":1,"inactive-value":0,onChange:_=>ie(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(i,{label:"操作",width:"280",fixed:"right"},{default:a(({row:t})=>[e(v,{type:"primary",link:"",icon:"Calendar",onClick:_=>pe(t)},{default:a(()=>[...l[33]||(l[33]=[s(" 排期 ",-1)])]),_:1},8,["onClick"]),e(v,{type:"primary",link:"",icon:"Edit",onClick:_=>se(t)},{default:a(()=>[...l[34]||(l[34]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(v,{type:"danger",link:"",icon:"Delete",onClick:_=>de(t)},{default:a(()=>[...l[35]||(l[35]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ee,N.value]]),q("div",Je,[e(Te,{"current-page":g.page,"onUpdate:currentPage":l[3]||(l[3]=t=>g.page=t),"page-size":g.pageSize,"onUpdate:pageSize":l[4]||(l[4]=t=>g.pageSize=t),total:A.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:L,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1}),e(O,{modelValue:C.value,"onUpdate:modelValue":l[20]||(l[20]=t=>C.value=t),title:R.value,width:"800px",onClose:be},{footer:a(()=>[e(v,{onClick:l[19]||(l[19]=t=>C.value=!1)},{default:a(()=>[...l[37]||(l[37]=[s("取消",-1)])]),_:1}),e(v,{type:"primary",onClick:me,loading:z.value},{default:a(()=>[...l[38]||(l[38]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(E,{ref_key:"formRef",ref:D,model:u,rules:oe,"label-width":"120px"},{default:a(()=>[e(S,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(r,{label:"课程名称",prop:"courseName"},{default:a(()=>[e(d,{modelValue:u.courseName,"onUpdate:modelValue":l[5]||(l[5]=t=>u.courseName=t),placeholder:"请输入课程名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(r,{label:"课程编号",prop:"courseCode"},{default:a(()=>[e(d,{modelValue:u.courseCode,"onUpdate:modelValue":l[6]||(l[6]=t=>u.courseCode=t),placeholder:"请输入课程编号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(r,{label:"课程类型",prop:"courseType"},{default:a(()=>[e(T,{modelValue:u.courseType,"onUpdate:modelValue":l[7]||(l[7]=t=>u.courseType=t),placeholder:"请选择类型",style:{width:"100%"}},{default:a(()=>[e(p,{label:"基础班",value:1}),e(p,{label:"提高班",value:2}),e(p,{label:"专业班",value:3}),e(p,{label:"私教课",value:4})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(r,{label:"教练",prop:"coachId"},{default:a(()=>[e(T,{modelValue:u.coachId,"onUpdate:modelValue":l[8]||(l[8]=t=>u.coachId=t),placeholder:"请选择教练",style:{width:"100%"}},{default:a(()=>[(U(!0),le(He,null,Ye(J.value,t=>(U(),H(p,{key:t.id,label:t.realName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:20},{default:a(()=>[e(y,{span:12},{default:a(()=>[e(r,{label:"难度等级",prop:"difficultyLevel"},{default:a(()=>[e(T,{modelValue:u.difficultyLevel,"onUpdate:modelValue":l[9]||(l[9]=t=>u.difficultyLevel=t),placeholder:"请选择难度",style:{width:"100%"}},{default:a(()=>[e(p,{label:"入门",value:1}),e(p,{label:"初级",value:2}),e(p,{label:"中级",value:3}),e(p,{label:"高级",value:4})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(r,{label:"适龄范围",prop:"ageRange"},{default:a(()=>[e(d,{modelValue:u.ageRange,"onUpdate:modelValue":l[10]||(l[10]=t=>u.ageRange=t),placeholder:"例如: 10-15岁"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:20},{default:a(()=>[e(y,{span:8},{default:a(()=>[e(r,{label:"最小人数",prop:"minStudents"},{default:a(()=>[e(h,{modelValue:u.minStudents,"onUpdate:modelValue":l[11]||(l[11]=t=>u.minStudents=t),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:8},{default:a(()=>[e(r,{label:"最大人数",prop:"maxStudents"},{default:a(()=>[e(h,{modelValue:u.maxStudents,"onUpdate:modelValue":l[12]||(l[12]=t=>u.maxStudents=t),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:8},{default:a(()=>[e(r,{label:"课时(分钟)",prop:"duration"},{default:a(()=>[e(h,{modelValue:u.duration,"onUpdate:modelValue":l[13]||(l[13]=t=>u.duration=t),min:30,step:15,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:20},{default:a(()=>[e(y,{span:8},{default:a(()=>[e(r,{label:"总课时数",prop:"totalSessions"},{default:a(()=>[e(h,{modelValue:u.totalSessions,"onUpdate:modelValue":l[14]||(l[14]=t=>u.totalSessions=t),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(y,{span:12},{default:a(()=>[e(r,{label:"课程价格",prop:"price"},{default:a(()=>[e(h,{modelValue:u.price,"onUpdate:modelValue":l[15]||(l[15]=t=>u.price=t),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(S,null,{default:a(()=>[e(y,{span:24},{default:a(()=>[e(Ue,{title:"会员折扣说明",type:"info",closable:!1,style:{"margin-bottom":"15px"}},{default:a(()=>[...l[36]||(l[36]=[s(" 会员价格根据会员等级自动计算：1级9.5折，2级9折，3级8.5折，4级8折，5级7.5折 ",-1)])]),_:1})]),_:1})]),_:1}),e(r,{label:"课程封面"},{default:a(()=>[e(d,{modelValue:u.coverImage,"onUpdate:modelValue":l[16]||(l[16]=t=>u.coverImage=t),placeholder:"请输入封面图片URL"},null,8,["modelValue"])]),_:1}),e(r,{label:"课程描述",prop:"description"},{default:a(()=>[e(d,{modelValue:u.description,"onUpdate:modelValue":l[17]||(l[17]=t=>u.description=t),type:"textarea",rows:3,placeholder:"请输入课程描述"},null,8,["modelValue"])]),_:1}),e(r,{label:"课程大纲"},{default:a(()=>[e(d,{modelValue:V.value,"onUpdate:modelValue":l[18]||(l[18]=t=>V.value=t),type:"textarea",rows:5,placeholder:"每行一个课时内容，例如：第1课：基础知识"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(O,{modelValue:B.value,"onUpdate:modelValue":l[21]||(l[21]=t=>B.value=t),title:"课程排期管理",width:"1000px"},{default:a(()=>[q("div",Ge,[e(v,{type:"primary",icon:"Plus",onClick:ce},{default:a(()=>[...l[39]||(l[39]=[s(" 添加排期 ",-1)])]),_:1})]),te((U(),H(X,{data:G.value,stripe:"",border:""},{default:a(()=>[e(i,{prop:"scheduleNo",label:"排期编号",width:"160"}),e(i,{label:"上课日期",width:"120"},{default:a(({row:t})=>[s(b(t.scheduleDate),1)]),_:1}),e(i,{label:"上课时间",width:"180"},{default:a(({row:t})=>[s(b(t.startTime)+" - "+b(t.endTime),1)]),_:1}),e(i,{label:"报名情况",width:"150"},{default:a(({row:t})=>[e(De,{percentage:Math.round(t.enrolledCount/t.maxStudents*100),color:xe(t.enrolledCount,t.maxStudents)},{default:a(()=>[q("span",null,b(t.enrolledCount)+"/"+b(t.maxStudents),1)]),_:2},1032,["percentage","color"])]),_:1}),e(i,{prop:"checkedInCount",label:"已签到",width:"80"}),e(i,{label:"状态",width:"100"},{default:a(({row:t})=>[e(j,{type:we(t.status)},{default:a(()=>[s(b(he(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),e(i,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[e(v,{type:"primary",link:"",icon:"User",onClick:_=>ve(t)},{default:a(()=>[...l[40]||(l[40]=[s(" 学员 ",-1)])]),_:1},8,["onClick"]),e(v,{type:"danger",link:"",icon:"Close",onClick:_=>ge(t),disabled:t.status===5},{default:a(()=>[...l[41]||(l[41]=[s(" 取消 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[ee,F.value]])]),_:1},8,["modelValue"]),e(O,{modelValue:x.value,"onUpdate:modelValue":l[29]||(l[29]=t=>x.value=t),title:"添加课程排期",width:"500px"},{footer:a(()=>[e(v,{onClick:l[28]||(l[28]=t=>x.value=!1)},{default:a(()=>[...l[42]||(l[42]=[s("取消",-1)])]),_:1}),e(v,{type:"primary",onClick:fe,loading:M.value},{default:a(()=>[...l[43]||(l[43]=[s(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(E,{ref_key:"scheduleFormRef",ref:I,model:m,rules:ue,"label-width":"100px"},{default:a(()=>[e(r,{label:"上课场地",prop:"venueId"},{default:a(()=>[e(d,{modelValue:m.venueId,"onUpdate:modelValue":l[22]||(l[22]=t=>m.venueId=t),type:"number",placeholder:"请输入场地ID",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(r,{label:"上课日期",prop:"scheduleDate"},{default:a(()=>[e(Ie,{modelValue:m.scheduleDate,"onUpdate:modelValue":l[23]||(l[23]=t=>m.scheduleDate=t),type:"date",placeholder:"选择日期",style:{width:"100%"},"value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(r,{label:"开始时间",prop:"startTime"},{default:a(()=>[e(Z,{modelValue:m.startTime,"onUpdate:modelValue":l[24]||(l[24]=t=>m.startTime=t),placeholder:"选择时间",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(r,{label:"结束时间",prop:"endTime"},{default:a(()=>[e(Z,{modelValue:m.endTime,"onUpdate:modelValue":l[25]||(l[25]=t=>m.endTime=t),placeholder:"选择时间",style:{width:"100%"},"value-format":"HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(r,{label:"最大人数",prop:"maxStudents"},{default:a(()=>[e(h,{modelValue:m.maxStudents,"onUpdate:modelValue":l[26]||(l[26]=t=>m.maxStudents=t),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(r,{label:"备注"},{default:a(()=>[e(d,{modelValue:m.remark,"onUpdate:modelValue":l[27]||(l[27]=t=>m.remark=t),type:"textarea",rows:3,placeholder:"请输入备注"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ze=je(Ke,[["__scopeId","data-v-4e0e0279"]]);export{Ze as default};
