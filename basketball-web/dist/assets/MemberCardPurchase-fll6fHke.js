import{_ as A,r as m,k as G,t as H,d as n,e as s,b as e,F as N,N as V,v as d,a as o,f as r,E as h,m as J,o as c,O as K,g as f,u,aa as L,i as y,U as Q,ag as W,y as X,z as Y,ah as Z,a9 as ee,D as se}from"./index-BU1z93KZ.js";import{e as te,p as ae}from"./member-Cz1wm3WK.js";import{B as le}from"./BackButton-CN15_tN6.js";const oe={class:"card-purchase-container"},ne={class:"purchase-content"},ce={class:"card-types-grid"},de=["onClick"],ie={class:"card-type-content"},re={class:"card-type-header"},ue={class:"card-icon"},_e={class:"card-name"},pe={class:"card-price"},me={class:"price-value"},fe={class:"card-details"},ve={key:0,class:"detail-item"},he={key:1,class:"detail-item"},ye={class:"detail-item"},ge={key:0,class:"card-benefits"},be={class:"benefits-list"},ke={key:1,class:"selected-badge"},Ce={key:0,class:"purchase-confirm"},Me={class:"confirm-card"},xe={class:"confirm-details"},we={class:"detail-row"},Be={class:"detail-value"},Ne={class:"detail-row"},Ve={class:"detail-value price"},Le={class:"option-content"},Fe={class:"option-content"},Ee={class:"confirm-actions"},Ie={key:1,class:"empty-selection"},Pe={__name:"MemberCardPurchase",setup(Re){const g=J(),b=m([]),_=m(null),v=m(!1),p=G({cardTypeId:null,payMethod:1}),F={payMethod:[{required:!0,message:"请选择支付方式",trigger:"change"}]},k=m(null),E=async()=>{try{const l=await te();l.code===200&&(b.value=l.data.records)}catch{h.error("获取会员卡类型失败")}},I=l=>{_.value=l,p.cardTypeId=l.id},P=async()=>{await k.value.validate(),se.confirm(`确认购买【${_.value.cardName}】吗?`,"确认购买",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{v.value=!0;try{(await ae(p)).code===200&&(h.success("购买成功"),g.push("/member/card"))}catch(l){h.error(l.message||"购买失败")}finally{v.value=!1}}).catch(()=>{})},R=()=>{g.back()},T=l=>({1:"primary",2:"success",3:"warning"})[l]||"info",$=l=>({1:"时间卡",2:"次卡",3:"储值卡"})[l]||"未知",z=l=>({0:"普通用户",1:"银卡会员",2:"金卡会员",3:"铂金会员",4:"VIP会员"})[l]||"普通用户";return H(()=>{E()}),(l,t)=>{const i=r("el-icon"),D=r("el-tag"),C=r("el-radio"),S=r("el-radio-group"),U=r("el-form-item"),M=r("el-button"),q=r("el-form"),O=r("el-empty");return c(),n("div",oe,[s(le,{text:"返回"}),e("div",ne,[e("div",ce,[(c(!0),n(N,null,V(b.value,a=>{var x,w;return c(),n("div",{key:a.id,class:K(["card-type-item",[{"card-selected":((x=_.value)==null?void 0:x.id)===a.id},`card-style-${a.cardType}`]]),onClick:B=>I(a)},[t[3]||(t[3]=e("div",{class:"card-decoration"},[e("div",{class:"deco-circle circle-1"}),e("div",{class:"deco-circle circle-2"})],-1)),e("div",ie,[e("div",re,[e("div",ue,[s(i,null,{default:o(()=>[s(u(L))]),_:1})]),s(D,{type:T(a.cardType),class:"card-tag"},{default:o(()=>[y(d($(a.cardType)),1)]),_:2},1032,["type"])]),e("h3",_e,d(a.cardName),1),e("div",pe,[t[1]||(t[1]=e("span",{class:"price-symbol"},"¥",-1)),e("span",me,d(a.price),1)]),e("div",fe,[a.cardType===1?(c(),n("div",ve,[s(i,null,{default:o(()=>[s(u(Q))]),_:1}),e("span",null,"有效期 "+d(a.duration)+" 天",1)])):f("",!0),a.cardType===2?(c(),n("div",he,[s(i,null,{default:o(()=>[s(u(W))]),_:1}),e("span",null,d(a.times)+" 次使用",1)])):f("",!0),e("div",ye,[s(i,null,{default:o(()=>[s(u(X))]),_:1}),e("span",null,d(z(a.memberLevel)),1)])]),a.benefitsList&&a.benefitsList.length?(c(),n("div",ge,[t[2]||(t[2]=e("div",{class:"benefits-title"},"会员权益",-1)),e("ul",be,[(c(!0),n(N,null,V(a.benefitsList,(B,j)=>(c(),n("li",{key:j},[s(i,null,{default:o(()=>[s(u(Y))]),_:1}),e("span",null,d(B),1)]))),128))])])):f("",!0),((w=_.value)==null?void 0:w.id)===a.id?(c(),n("div",ke,[s(i,null,{default:o(()=>[s(u(Z))]),_:1})])):f("",!0)])],10,de)}),128))]),_.value?(c(),n("div",Ce,[e("div",Me,[t[10]||(t[10]=e("h3",{class:"confirm-title"},"确认购买信息",-1)),e("div",xe,[e("div",we,[t[4]||(t[4]=e("span",{class:"detail-label"},"会员卡类型",-1)),e("span",Be,d(_.value.cardName),1)]),e("div",Ne,[t[5]||(t[5]=e("span",{class:"detail-label"},"支付金额",-1)),e("span",Ve,"¥"+d(_.value.price),1)])]),s(q,{model:p,rules:F,ref_key:"purchaseFormRef",ref:k},{default:o(()=>[s(U,{label:"支付方式",prop:"payMethod",class:"payment-method"},{default:o(()=>[s(S,{modelValue:p.payMethod,"onUpdate:modelValue":t[0]||(t[0]=a=>p.payMethod=a),class:"payment-options"},{default:o(()=>[s(C,{label:1,class:"payment-option"},{default:o(()=>[e("div",Le,[s(i,null,{default:o(()=>[s(u(L))]),_:1}),t[6]||(t[6]=e("span",null,"在线支付",-1))])]),_:1}),s(C,{label:2,class:"payment-option"},{default:o(()=>[e("div",Fe,[s(i,null,{default:o(()=>[s(u(ee))]),_:1}),t[7]||(t[7]=e("span",null,"余额支付",-1))])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e("div",Ee,[s(M,{onClick:R,class:"cancel-btn"},{default:o(()=>[...t[8]||(t[8]=[y("取消",-1)])]),_:1}),s(M,{type:"primary",onClick:P,loading:v.value,class:"purchase-btn"},{default:o(()=>[...t[9]||(t[9]=[y(" 立即购买 ",-1)])]),_:1},8,["loading"])])]),_:1},8,["model"])])])):(c(),n("div",Ie,[s(O,{description:"请先选择要购买的会员卡类型"})]))])])}}},De=A(Pe,[["__scopeId","data-v-999f412b"]]);export{De as default};
