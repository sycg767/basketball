import{_ as j}from"./LineChart-B3qbn8Ir.js";import{g as q,a as T,b as F,c as U}from"./analytics-GeRKdCj5.js";import{_ as G,r,t as H,E as k,d as J,b as l,e as t,a as s,f as i,B as p,c as I,g as K,a3 as Q,a4 as W,i as v,o as h}from"./index-DU9PCbH8.js";import"./index-D5fw03LZ.js";const X={class:"member-analysis-container"},Y={class:"stat-content"},Z={class:"stat-info"},ee={class:"stat-value"},te={class:"stat-content"},ae={class:"stat-info"},se={class:"stat-value green"},le={class:"stat-content"},oe={class:"stat-info"},ne={class:"stat-value red"},re={class:"card-header"},ie={class:"card-header"},de={class:"pagination-container"},ce={__name:"MemberAnalysis",setup(ue){const S=r(0),C=r(0),V=r(0),_=r(7),u=r("active"),m=r(!1),z=r([]),g=r(1),f=r(10),A=r(0),b=r({xAxisData:[],series:[]});H(()=>{M(),y(),B()});const M=async()=>{try{const a=new Date,e=new Date;e.setDate(e.getDate()-_.value);const o=await q({startDate:e.toISOString().split("T")[0],endDate:a.toISOString().split("T")[0]});o.code===200&&o.data&&o.data.length>0&&(b.value={xAxisData:o.data.map(n=>n.analysisDate||n.date),series:[{name:"活跃用户数",data:o.data.map(n=>n.loginCount||n.activeCount||0)}]})}catch(a){console.error("获取活跃度趋势失败:",a),k.error("获取活跃度趋势失败")}},y=async()=>{m.value=!0;try{let a;const e={page:g.value,size:f.value};u.value==="active"?a=await T(e):u.value==="inactive"?a=await F(e):a=await U(e),a.code===200&&(z.value=a.data.records||[],A.value=a.data.total||0)}catch{k.error("获取会员列表失败")}finally{m.value=!1}},B=async()=>{var a,e,o;try{const[n,x]=await Promise.all([T({page:1,size:1}),U({page:1,size:1})]);S.value=(((a=n.data)==null?void 0:a.total)||0)+100,C.value=((e=n.data)==null?void 0:e.total)||0,V.value=((o=x.data)==null?void 0:o.total)||0}catch(n){console.error("获取统计数据失败:",n)}},N=a=>a>=80?"success":a>=60?"":a>=40?"warning":"danger";return(a,e)=>{const o=i("el-card"),n=i("el-col"),x=i("el-row"),D=i("el-option"),R=i("el-select"),w=i("el-radio-button"),E=i("el-radio-group"),c=i("el-table-column"),P=i("el-tag"),L=i("el-table"),O=i("el-pagination"),$=W("loading");return h(),J("div",X,[e[12]||(e[12]=l("h2",{class:"page-title"},"会员活跃度分析",-1)),t(x,{gutter:20,class:"stats-row"},{default:s(()=>[t(n,{xs:24,sm:8},{default:s(()=>[t(o,{class:"stat-card"},{default:s(()=>[l("div",Y,[l("div",Z,[e[4]||(e[4]=l("p",{class:"stat-label"},"总会员数",-1)),l("p",ee,p(S.value),1)])])]),_:1})]),_:1}),t(n,{xs:24,sm:8},{default:s(()=>[t(o,{class:"stat-card"},{default:s(()=>[l("div",te,[l("div",ae,[e[5]||(e[5]=l("p",{class:"stat-label"},"活跃会员",-1)),l("p",se,p(C.value),1)])])]),_:1})]),_:1}),t(n,{xs:24,sm:8},{default:s(()=>[t(o,{class:"stat-card"},{default:s(()=>[l("div",le,[l("div",oe,[e[6]||(e[6]=l("p",{class:"stat-label"},"流失风险",-1)),l("p",ne,p(V.value),1)])])]),_:1})]),_:1})]),_:1}),t(o,{class:"chart-card"},{header:s(()=>[l("div",re,[e[7]||(e[7]=l("span",null,"会员活跃度趋势",-1)),t(R,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=d=>_.value=d),onChange:M,size:"small",style:{width:"120px"}},{default:s(()=>[t(D,{label:"最近7天",value:7}),t(D,{label:"最近15天",value:15}),t(D,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:s(()=>[b.value.xAxisData?(h(),I(j,{key:0,data:b.value,height:"350px","y-axis-name":"活跃度","show-area":!0},null,8,["data"])):K("",!0)]),_:1}),t(o,null,{header:s(()=>[l("div",ie,[e[11]||(e[11]=l("span",null,"会员列表",-1)),t(E,{modelValue:u.value,"onUpdate:modelValue":e[1]||(e[1]=d=>u.value=d),onChange:y,size:"small"},{default:s(()=>[t(w,{value:"active"},{default:s(()=>[...e[8]||(e[8]=[v("活跃用户",-1)])]),_:1}),t(w,{value:"inactive"},{default:s(()=>[...e[9]||(e[9]=[v("不活跃用户",-1)])]),_:1}),t(w,{value:"churn"},{default:s(()=>[...e[10]||(e[10]=[v("流失风险",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:s(()=>[Q((h(),I(L,{data:z.value,stripe:""},{default:s(()=>[t(c,{prop:"userId",label:"用户ID",width:"100"}),t(c,{prop:"username",label:"用户名"}),t(c,{prop:"realName",label:"真实姓名"}),t(c,{prop:"activityScore",label:"活跃度",width:"100"},{default:s(({row:d})=>[t(P,{type:N(d.activityScore)},{default:s(()=>[v(p(d.activityScore),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"lastActiveTime",label:"最后活跃",width:"180"})]),_:1},8,["data"])),[[$,m.value]]),l("div",de,[t(O,{"current-page":g.value,"onUpdate:currentPage":e[2]||(e[2]=d=>g.value=d),"page-size":f.value,"onUpdate:pageSize":e[3]||(e[3]=d=>f.value=d),total:A.value,layout:"total, prev, pager, next",onCurrentChange:y},null,8,["current-page","page-size","total"])])]),_:1})])}}},ge=G(ce,[["__scopeId","data-v-6c8bdfc0"]]);export{ge as default};
