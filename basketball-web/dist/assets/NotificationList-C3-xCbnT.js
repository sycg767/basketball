import{_ as W,r as C,a0 as q,t as J,E as d,d as _,e as n,a as o,f as c,m as Z,a5 as ee,o as s,b as l,a4 as te,g as E,i,c as R,F as ae,N as oe,O as ne,an as se,P as le,v as g,W as T,R as ie,aa as re,a9 as ce,L as de,ao as B,s as k,a8 as _e,Q as ue,D as I}from"./index-DqRIPXSt.js";import{b as Ce,c as Ee,a as Se,d as pe,m as fe}from"./notification-BeiUfyTe.js";import{B as Re}from"./BackButton-CB8aFD-N.js";const ge={class:"notification-list-container"},ve={class:"card-header"},Ne={class:"header-actions"},Oe={class:"filter-bar"},me={class:"notification-content"},Fe=["onClick"],ye={class:"notification-left"},Me={class:"notification-main"},Ue={class:"notification-header-row"},Ae={class:"notification-title"},Te={class:"notification-time"},Be={class:"notification-body"},ke={key:0,class:"notification-meta"},Ie={key:0,class:"related-id"},De={class:"notification-actions"},Le={key:0,class:"pagination-container"},he={__name:"NotificationList",setup(ze){const D=Z(),S=C([]),v=C(!1),u=C(1),N=C(10),m=C(0),O=C(""),L=q(()=>S.value.some(t=>t.isRead===0));J(()=>{p()});const p=async()=>{v.value=!0;try{let t;O.value==="unread"?t=await Ce({page:u.value,size:N.value}):t=await Ee({page:u.value,size:N.value,templateCode:O.value||void 0}),t.code===200&&(S.value=t.data.records||[],m.value=t.data.total||0)}catch(t){console.error("获取通知列表失败:",t),d.error("获取通知列表失败")}finally{v.value=!1}},h=()=>{u.value=1,p()},z=()=>{p()},b=()=>{u.value=1,p()},w=t=>{D.push(`/notification/${t.id}`)},x=async t=>{try{await Se(t.id),t.isRead=1,d.success("已标记为已读")}catch(e){console.error("标记已读失败:",e),d.error("操作失败")}},P=async()=>{try{await I.confirm("确定要将所有未读消息标记为已读吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await fe(),S.value.forEach(t=>{t.isRead=1}),d.success("已全部标记为已读")}catch(t){t!=="cancel"&&(console.error("全部已读失败:",t),d.error("操作失败"))}},G=async t=>{try{await I.confirm("确定要删除这条通知吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pe(t.id),d.success("删除成功"),p()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),d.error("删除失败"))}},K=t=>({BOOKING_SUCCESS:k,BOOKING_CANCEL:B,BOOKING_START_REMINDER:_e,COURSE_ENROLL_SUCCESS:k,COURSE_ENROLL_CANCEL:B,COURSE_START_REMINDER:de,PAYMENT_SUCCESS:ce,REFUND_SUCCESS:re,MEMBER_CARD_EXPIRE_SOON:ie})[t]||ue,$=t=>({BOOKING_SUCCESS:"#67C23A",BOOKING_CANCEL:"#F56C6C",BOOKING_START_REMINDER:"#409EFF",COURSE_ENROLL_SUCCESS:"#67C23A",COURSE_ENROLL_CANCEL:"#F56C6C",COURSE_START_REMINDER:"#E6A23C",PAYMENT_SUCCESS:"#67C23A",REFUND_SUCCESS:"#409EFF",MEMBER_CARD_EXPIRE_SOON:"#E6A23C"})[t]||"#909399",V=t=>({BOOKING_SUCCESS:"#F0F9FF",BOOKING_CANCEL:"#FEF0F0",BOOKING_START_REMINDER:"#ECF5FF",COURSE_ENROLL_SUCCESS:"#F0F9FF",COURSE_ENROLL_CANCEL:"#FEF0F0",COURSE_START_REMINDER:"#FDF6EC",PAYMENT_SUCCESS:"#F0F9FF",REFUND_SUCCESS:"#ECF5FF",MEMBER_CARD_EXPIRE_SOON:"#FDF6EC"})[t]||"#F5F7FA",Y=t=>({BOOKING:"预订",COURSE:"课程",PAYMENT:"支付",MEMBER_CARD:"会员卡"})[t]||t,X=t=>{if(!t)return"";const e=new Date(t),f=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),F=String(e.getDate()).padStart(2,"0"),y=String(e.getHours()).padStart(2,"0"),M=String(e.getMinutes()).padStart(2,"0");return`${f}-${r}-${F} ${y}:${M}`};return(t,e)=>{const f=c("el-button"),r=c("el-radio-button"),F=c("el-radio-group"),y=c("el-empty"),M=c("el-icon"),U=c("el-tag"),j=c("el-pagination"),H=c("el-card"),Q=ee("loading");return s(),_("div",ge,[n(Re,{text:"返回"}),n(H,{class:"notification-card"},{header:o(()=>[l("div",ve,[e[4]||(e[4]=l("h3",null,"通知中心",-1)),l("div",Ne,[L.value?(s(),R(f,{key:0,type:"primary",size:"small",onClick:P},{default:o(()=>[...e[3]||(e[3]=[i(" 全部已读 ",-1)])]),_:1})):E("",!0)])])]),default:o(()=>[l("div",Oe,[n(F,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=a=>O.value=a),onChange:h},{default:o(()=>[n(r,{label:""},{default:o(()=>[...e[5]||(e[5]=[i("全部",-1)])]),_:1}),n(r,{label:"unread"},{default:o(()=>[...e[6]||(e[6]=[i("未读",-1)])]),_:1}),n(r,{label:"BOOKING_SUCCESS"},{default:o(()=>[...e[7]||(e[7]=[i("预订通知",-1)])]),_:1}),n(r,{label:"COURSE_ENROLL_SUCCESS"},{default:o(()=>[...e[8]||(e[8]=[i("课程通知",-1)])]),_:1}),n(r,{label:"PAYMENT_SUCCESS"},{default:o(()=>[...e[9]||(e[9]=[i("支付通知",-1)])]),_:1}),n(r,{label:"MEMBER_CARD_EXPIRE_SOON"},{default:o(()=>[...e[10]||(e[10]=[i("会员提醒",-1)])]),_:1})]),_:1},8,["modelValue"])]),te((s(),_("div",me,[S.value.length===0&&!v.value?(s(),R(y,{key:0,description:"暂无通知"})):(s(!0),_(ae,{key:1},oe(S.value,a=>(s(),_("div",{key:a.id,class:ne(["notification-card",{"is-unread":a.isRead===0}]),onClick:A=>w(a)},[l("div",ye,[l("div",{class:"notification-icon",style:se({backgroundColor:V(a.templateCode)})},[n(M,{size:24,color:$(a.templateCode)},{default:o(()=>[(s(),R(le(K(a.templateCode))))]),_:2},1032,["color"])],4)]),l("div",Me,[l("div",Ue,[l("div",Ae,[i(g(a.title)+" ",1),a.isRead===0?(s(),R(U,{key:0,type:"danger",size:"small",effect:"dark"},{default:o(()=>[...e[11]||(e[11]=[i(" 未读 ",-1)])]),_:1})):E("",!0)]),l("div",Te,g(X(a.sendTime)),1)]),l("div",Be,g(a.content),1),a.relatedType?(s(),_("div",ke,[n(U,{size:"small",type:"info"},{default:o(()=>[i(g(Y(a.relatedType)),1)]),_:2},1024),a.relatedId?(s(),_("span",Ie,"ID: "+g(a.relatedId),1)):E("",!0)])):E("",!0)]),l("div",De,[a.isRead===0?(s(),R(f,{key:0,type:"text",size:"small",onClick:T(A=>x(a),["stop"])},{default:o(()=>[...e[12]||(e[12]=[i(" 标记已读 ",-1)])]),_:1},8,["onClick"])):E("",!0),n(f,{type:"text",size:"small",onClick:T(A=>G(a),["stop"])},{default:o(()=>[...e[13]||(e[13]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])])],10,Fe))),128))])),[[Q,v.value]]),m.value>0?(s(),_("div",Le,[n(j,{"current-page":u.value,"onUpdate:currentPage":e[1]||(e[1]=a=>u.value=a),"page-size":N.value,"onUpdate:pageSize":e[2]||(e[2]=a=>N.value=a),total:m.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:b,onCurrentChange:z},null,8,["current-page","page-size","total"])])):E("",!0)]),_:1})])}}},Pe=W(he,[["__scopeId","data-v-c68e7c02"]]);export{Pe as default};
