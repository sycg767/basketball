import{_ as C}from"./BarChart-B_gMieq2.js";import{_ as V}from"./LineChart-BeRPMtI5.js";import{h as R,i as I,j as O}from"./analytics-Cmz_9IhM.js";import{_ as P,r,t as T,E as B,d as E,b as i,e as n,a as o,c as v,g as y,f as l,a3 as N,a4 as z,o as u}from"./index-zUzrFZpX.js";import"./index-D5fw03LZ.js";const M={class:"venue-analysis-container"},U={class:"card-header"},$={__name:"VenueAnalysis",setup(j){const p=r(7),_=r(!1),f=r([]),g=r({xAxisData:[],series:[]}),m=r({xAxisData:[],series:[]});T(()=>{x(),h(),b()});const x=async()=>{_.value=!0;try{const t=new Date,e=new Date;e.setDate(e.getDate()-p.value);const a=await R({startDate:e.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0],limit:10});a.code===200&&a.data&&a.data.length>0&&(g.value={xAxisData:a.data.map(s=>s.venueName),series:[{name:"使用率",data:a.data.map(s=>s.usageRate||s.rate||0)}]})}catch(t){console.error("获取场地排行榜失败:",t),B.error("获取场地排行榜失败")}finally{_.value=!1}},h=async()=>{try{const t=new Date,e=new Date;e.setDate(e.getDate()-30);const a=await I({startDate:e.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]});a.code===200&&a.data&&a.data.length>0&&(m.value={xAxisData:a.data.map(s=>s.analysisDate||s.date),series:[{name:"总收入",data:a.data.map(s=>s.totalRevenue||s.revenue||0)}]})}catch(t){console.error("获取收入分析失败:",t)}},b=async()=>{try{const t=new Date,e=new Date;e.setDate(e.getDate()-7);const a=await O({startDate:e.toISOString().split("T")[0],endDate:t.toISOString().split("T")[0]});a.code===200&&a.data&&(f.value=a.data||[])}catch(t){console.error("获取高峰时段失败:",t)}},w=t=>t>=80?"#67C23A":t>=60?"#E6A23C":"#F56C6C";return(t,e)=>{const a=l("el-option"),s=l("el-select"),D=l("el-card"),d=l("el-table-column"),k=l("el-progress"),A=l("el-table"),S=z("loading");return u(),E("div",M,[e[4]||(e[4]=i("h2",{class:"page-title"},"场地使用分析",-1)),n(D,null,{header:o(()=>[i("div",U,[e[1]||(e[1]=i("span",null,"场地使用率排行",-1)),n(s,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=c=>p.value=c),onChange:x,size:"small",style:{width:"120px"}},{default:o(()=>[n(a,{label:"最近7天",value:7}),n(a,{label:"最近15天",value:15}),n(a,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:o(()=>[g.value.xAxisData?(u(),v(C,{key:0,data:g.value,height:"400px","y-axis-name":"使用率(%)",horizontal:!0},null,8,["data"])):y("",!0)]),_:1}),n(D,{class:"revenue-card"},{header:o(()=>[...e[2]||(e[2]=[i("span",null,"场地收入分析",-1)])]),default:o(()=>[m.value.xAxisData?(u(),v(V,{key:0,data:m.value,height:"350px","y-axis-name":"收入(元)","show-area":!0},null,8,["data"])):y("",!0)]),_:1}),n(D,null,{header:o(()=>[...e[3]||(e[3]=[i("span",null,"高峰时段分布",-1)])]),default:o(()=>[N((u(),v(A,{data:f.value,stripe:""},{default:o(()=>[n(d,{prop:"period",label:"时段",width:"120"}),n(d,{prop:"bookingCount",label:"预订次数",width:"120"}),n(d,{prop:"usageRate",label:"使用率",width:"120"},{default:o(({row:c})=>[n(k,{percentage:c.usageRate,color:w(c.usageRate)},null,8,["percentage","color"])]),_:1}),n(d,{prop:"revenue",label:"收入(元)"})]),_:1},8,["data"])),[[S,_.value]])]),_:1})])}}},K=P($,[["__scopeId","data-v-ca65b7bd"]]);export{K as default};
