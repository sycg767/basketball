import{_ as ke,r as f,k as j,t as be,S as Ce,d as b,e as l,a3 as Me,a4 as we,b as a,a as t,f as _,c as m,g as r,a6 as xe,E as y,m as Te,o as d,A as ze,B as u,i,z as $,u as M,s as z,a8 as Pe,R as Ve,h as O,D as Ne,T as G}from"./index-DU9PCbH8.js";import{a as J,c as Re,p as K}from"./booking-K964GJ6h.js";import{B as Be}from"./BackButton-Sx8z1nOG.js";const De={class:"booking-detail-container"},Fe={class:"detail-content"},qe={class:"status-content"},Se={class:"status-info"},$e={class:"order-no"},Ie={class:"price-highlight"},Ue={class:"action-buttons"},Ae={class:"payment-amount-section"},Ee={class:"amount-value"},Oe={class:"payment-methods-section"},Qe={class:"method-check"},Le={class:"method-check"},He={class:"method-icon balance-icon"},We={class:"method-check"},je={class:"method-icon onsite-icon"},Ge={class:"method-check"},Je={key:0,class:"qr-code-container"},Ke={class:"qr-code-header"},Xe={class:"qr-code-content"},Ye=["src"],Ze={key:1,class:"qr-code-placeholder"},ea={class:"qr-code-status"},aa={key:0,class:"expire-time"},ta={class:"mock-scan-area"},la={class:"mock-scan-buttons"},sa={key:1,class:"payment-status"},oa={key:0,class:"status-paying"},na={key:1,class:"status-success"},ia={key:2,class:"status-failed"},da={class:"dialog-footer"},ua={__name:"Detail",setup(ca){const X=xe(),Y=Te(),D=f(!1),s=f({}),h=f(!1),I=f(!1),n=j({paymentMethod:2,paymentType:"wechat_native"}),w=f(!1),P=f(""),U=f(!1),x=f(null),C=f(null),p=f(""),Z=()=>n.paymentMethod===1,ee=()=>p.value&&p.value!=="",N=f(!1),F=f(!1),V=j({cancelReason:""}),T=async()=>{D.value=!0;try{const o=await J(X.params.id);s.value=o.data}catch(o){y.error(o.message||"获取预订详情失败"),Y.back()}finally{D.value=!1}},ae=o=>({0:G,1:z,2:O,3:z,4:O,5:Ne})[o]||G,te=o=>({0:"#E6A23C",1:"#67C23A",2:"#909399",3:"#67C23A",4:"#909399",5:"#F56C6C"})[o]||"#909399",le=o=>({0:"待支付",1:"已支付",2:"已取消",3:"已完成",4:"已退款",5:"超时取消"})[o]||"未知",se=()=>{n.paymentMethod=1,n.paymentType="wechat_native",w.value=!1,P.value="",x.value=null,p.value="",h.value=!0},q=o=>{w.value=!1,P.value="",x.value=null,p.value="",o==="wechat_native"?(n.paymentMethod=1,n.paymentType="wechat_native"):o==="alipay_page"?(n.paymentMethod=1,n.paymentType="alipay_page"):o==="balance"?(n.paymentMethod=2,n.paymentType=""):o==="onsite"&&(n.paymentMethod=4,n.paymentType="")},oe=()=>{n.paymentMethod===1?A():ve()},ne=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",ie=()=>{C.value&&clearInterval(C.value),p.value="paying",C.value=setInterval(async()=>{try{const o=await J(s.value.id);o.data.status===1?(p.value="success",clearInterval(C.value),h.value=!1,T(),y.success("支付成功！")):o.data.status===5&&(p.value="failed",clearInterval(C.value),y.error("支付超时，请重新尝试"))}catch{}},3e3)},A=async()=>{U.value=!0;try{const o=await K(s.value.id,{paymentMethod:n.paymentMethod,paymentType:n.paymentType});x.value=o.data,n.paymentMethod===1&&o.data.qrCodeUrl?(o.data.qrCodeUrl.startsWith("data:")?P.value=o.data.qrCodeUrl:P.value=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${o.data.paymentNo}`,w.value=!0,ie()):n.paymentMethod===2||n.paymentMethod===3?(p.value="success",h.value=!1,T()):n.paymentMethod===4&&(y.success("现场支付订单已确认"),h.value=!1,T())}catch(o){y.error(o.message||"生成支付二维码失败"),w.value=!1}finally{U.value=!1}},de=async()=>{await A()},ue=()=>{C.value&&clearInterval(C.value),h.value=!1,w.value=!1,p.value=""},ce=async()=>{try{await fetch(`http://localhost:8080/api/mock/payment/scan-success/${x.value.paymentNo}`,{method:"POST"}),y.success("模拟支付成功！支付状态已更新")}catch(o){y.error("模拟支付失败: "+o.message)}},re=async()=>{try{await fetch(`http://localhost:8080/api/mock/payment/scan-fail/${x.value.paymentNo}`,{method:"POST"}),y.success("模拟支付失败！支付状态已更新")}catch(o){y.error("模拟支付失败: "+o.message)}},ve=async()=>{if(Z())await A();else{I.value=!0;try{await K(s.value.id,{paymentMethod:n.paymentMethod}),y.success("支付成功"),h.value=!1,T()}catch(o){y.error(o.message||"支付失败")}finally{I.value=!1}}},me=()=>{V.cancelReason="",N.value=!0},pe=async()=>{if(!V.cancelReason.trim()){y.warning("请输入取消原因");return}F.value=!0;try{await Re(s.value.id,{cancelReason:V.cancelReason}),y.success("取消成功"),N.value=!1,T()}catch(o){y.error(o.message||"取消失败")}finally{F.value=!1}};return be(()=>{T()}),Ce(()=>{C.value&&clearInterval(C.value)}),(o,e)=>{const g=_("el-icon"),R=_("el-card"),v=_("el-descriptions-item"),S=_("el-descriptions"),k=_("el-button"),Q=_("el-divider"),ye=_("el-empty"),L=_("el-dialog"),fe=_("el-input"),_e=_("el-form-item"),he=_("el-form"),ge=we("loading");return d(),b("div",De,[l(Be,{text:"返回"}),Me((d(),b("div",Fe,[l(R,{class:"status-card"},{default:t(()=>[a("div",qe,[l(g,{size:48,color:te(s.value.status)},{default:t(()=>[(d(),m(ze(ae(s.value.status))))]),_:1},8,["color"]),a("div",Se,[a("h2",null,u(le(s.value.status)),1),a("p",$e,"订单号: "+u(s.value.bookingNo),1)])])]),_:1}),l(R,{class:"info-card"},{header:t(()=>[...e[9]||(e[9]=[a("div",{class:"card-header"},[a("span",null,"场地信息")],-1)])]),default:t(()=>[l(S,{column:2,border:""},{default:t(()=>[l(v,{label:"场地名称"},{default:t(()=>[i(u(s.value.venueName),1)]),_:1}),l(v,{label:"场地位置"},{default:t(()=>[i(u(s.value.venueLocation),1)]),_:1})]),_:1})]),_:1}),l(R,{class:"info-card"},{header:t(()=>[...e[10]||(e[10]=[a("div",{class:"card-header"},[a("span",null,"预订信息")],-1)])]),default:t(()=>[l(S,{column:2,border:""},{default:t(()=>[l(v,{label:"预订日期"},{default:t(()=>[i(u(s.value.bookingDate),1)]),_:1}),l(v,{label:"时间段"},{default:t(()=>[i(u(s.value.timeSlot),1)]),_:1}),l(v,{label:"时长"},{default:t(()=>[i(u(s.value.duration)+" 小时 ",1)]),_:1}),l(v,{label:"预订类型"},{default:t(()=>[i(u(s.value.bookingType===1?"按时段":"包场"),1)]),_:1}),s.value.contactName?(d(),m(v,{key:0,label:"联系人"},{default:t(()=>[i(u(s.value.contactName),1)]),_:1})):r("",!0),s.value.contactPhone?(d(),m(v,{key:1,label:"联系电话"},{default:t(()=>[i(u(s.value.contactPhone),1)]),_:1})):r("",!0),s.value.peopleCount?(d(),m(v,{key:2,label:"人数"},{default:t(()=>[i(u(s.value.peopleCount)+" 人 ",1)]),_:1})):r("",!0),s.value.remark?(d(),m(v,{key:3,label:"备注",span:2},{default:t(()=>[i(u(s.value.remark),1)]),_:1})):r("",!0)]),_:1})]),_:1}),l(R,{class:"info-card"},{header:t(()=>[...e[11]||(e[11]=[a("div",{class:"card-header"},[a("span",null,"费用信息")],-1)])]),default:t(()=>[l(S,{column:2,border:""},{default:t(()=>[l(v,{label:"单价"},{default:t(()=>{var c;return[i(" ¥"+u((c=s.value.price)==null?void 0:c.toFixed(2))+"/小时 ",1)]}),_:1}),l(v,{label:"总价"},{default:t(()=>{var c;return[i(" ¥"+u((c=s.value.totalPrice)==null?void 0:c.toFixed(2)),1)]}),_:1}),l(v,{label:"优惠金额"},{default:t(()=>{var c;return[i(" ¥"+u(((c=s.value.discountAmount)==null?void 0:c.toFixed(2))||"0.00"),1)]}),_:1}),l(v,{label:"实付金额"},{default:t(()=>{var c,B;return[a("span",Ie,"¥"+u(((c=s.value.actualPrice)==null?void 0:c.toFixed(2))||((B=s.value.totalPrice)==null?void 0:B.toFixed(2))),1)]}),_:1}),s.value.payMethodName?(d(),m(v,{key:0,label:"支付方式"},{default:t(()=>[i(u(s.value.payMethodName),1)]),_:1})):r("",!0)]),_:1})]),_:1}),l(R,{class:"info-card"},{header:t(()=>[...e[12]||(e[12]=[a("div",{class:"card-header"},[a("span",null,"时间信息")],-1)])]),default:t(()=>[l(S,{column:2,border:""},{default:t(()=>[l(v,{label:"创建时间"},{default:t(()=>[i(u(s.value.createTime),1)]),_:1}),s.value.payTime?(d(),m(v,{key:0,label:"支付时间"},{default:t(()=>[i(u(s.value.payTime),1)]),_:1})):r("",!0),s.value.cancelTime?(d(),m(v,{key:1,label:"取消时间"},{default:t(()=>[i(u(s.value.cancelTime),1)]),_:1})):r("",!0),s.value.cancelReason?(d(),m(v,{key:2,label:"取消原因",span:2},{default:t(()=>[i(u(s.value.cancelReason),1)]),_:1})):r("",!0),s.value.expireTime&&s.value.status===0?(d(),m(v,{key:3,label:"过期时间"},{default:t(()=>[i(u(s.value.expireTime),1)]),_:1})):r("",!0)]),_:1})]),_:1}),a("div",Ue,[s.value.status===0?(d(),m(k,{key:0,type:"success",size:"large",onClick:se},{default:t(()=>[...e[13]||(e[13]=[i(" 立即支付 ",-1)])]),_:1})):r("",!0),s.value.status===0||s.value.status===1?(d(),m(k,{key:1,type:"danger",size:"large",onClick:me},{default:t(()=>[...e[14]||(e[14]=[i(" 取消预订 ",-1)])]),_:1})):r("",!0)])])),[[ge,D.value]]),l(L,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=c=>h.value=c),title:"选择支付方式",width:"600px","close-on-click-modal":!1},{footer:t(()=>[a("div",da,[l(k,{size:"large",onClick:e[4]||(e[4]=c=>h.value=!1)},{default:t(()=>[...e[31]||(e[31]=[i("取消",-1)])]),_:1}),w.value?r("",!0):(d(),m(k,{key:0,type:"primary",size:"large",onClick:oe,loading:I.value,disabled:!n.paymentType&&n.paymentMethod!==2&&n.paymentMethod!==4},{default:t(()=>[...e[32]||(e[32]=[i(" 确认支付 ",-1)])]),_:1},8,["loading","disabled"])),w.value?(d(),m(k,{key:1,type:"danger",size:"large",onClick:ue,loading:F.value},{default:t(()=>[...e[33]||(e[33]=[i(" 取消支付 ",-1)])]),_:1},8,["loading"])):r("",!0)])]),default:t(()=>{var c,B,H,W;return[a("div",Ae,[e[15]||(e[15]=a("div",{class:"amount-label"},"订单金额",-1)),a("div",Ee,"¥"+u(((c=s.value.actualPrice)==null?void 0:c.toFixed(2))||((B=s.value.totalPrice)==null?void 0:B.toFixed(2))),1)]),l(Q),a("div",Oe,[e[22]||(e[22]=a("div",{class:"section-title"},"请选择支付方式",-1)),a("div",{class:$(["payment-method-card",{active:n.paymentType==="wechat_native"}]),onClick:e[0]||(e[0]=E=>q("wechat_native"))},[e[16]||(e[16]=a("div",{class:"method-icon wechat-icon"},[a("svg",{viewBox:"0 0 1024 1024",width:"32",height:"32"},[a("path",{d:"M664.250054 368.541681c10.015098 0 19.892049 0.732687 29.67281 1.795902-26.647917-122.810047-159.358451-214.077703-310.826188-214.077703-169.353083 0-308.085774 114.232694-308.085774 259.274068 0 83.708494 46.165436 152.460344 123.281791 205.78483l-30.80868 91.730191 107.688651-53.455469c38.558178 7.53665 69.459978 15.308661 107.924012 15.308661 9.66308 0 19.230993-0.470721 28.752858-1.225921-6.025227-20.36584-9.521864-41.723264-9.521864-63.862493C402.328693 476.632491 517.908058 368.541681 664.250054 368.541681zM498.62897 285.87389c23.200398 0 38.557154 15.120372 38.557154 38.061874 0 22.846334-15.356756 38.156018-38.557154 38.156018-23.107277 0-46.260603-15.309684-46.260603-38.156018C452.368366 300.994262 475.522716 285.87389 498.62897 285.87389zM283.016307 362.090758c-23.107277 0-46.402843-15.309684-46.402843-38.156018 0-22.941502 23.295566-38.061874 46.402843-38.061874 23.081695 0 38.46301 15.120372 38.46301 38.061874C321.479317 346.782098 306.098002 362.090758 283.016307 362.090758zM945.448458 606.151333c0-121.888048-123.258255-221.236753-261.683954-221.236753-146.57838 0-262.015505 99.348706-262.015505 221.236753 0 122.06508 115.437126 221.200938 262.015505 221.200938 30.66644 0 61.617359-7.609305 92.423993-15.262612l84.513836 45.786813-23.178909-76.17082C899.379213 735.776599 945.448458 674.90216 945.448458 606.151333zM598.803483 567.994292c-15.332197 0-30.807656-15.096836-30.807656-30.501688 0-15.190981 15.47546-30.477129 30.807656-30.477129 23.295566 0 38.558178 15.286148 38.558178 30.477129C637.361661 552.897456 622.099049 567.994292 598.803483 567.994292zM768.25071 567.994292c-15.213493 0-30.594809-15.096836-30.594809-30.501688 0-15.190981 15.381315-30.477129 30.594809-30.477129 23.107277 0 38.558178 15.286148 38.558178 30.477129C806.808888 552.897456 791.357987 567.994292 768.25071 567.994292z",fill:"#00C800"})])],-1)),e[17]||(e[17]=a("div",{class:"method-info"},[a("div",{class:"method-name"},"微信支付"),a("div",{class:"method-desc"},"推荐使用微信扫码支付")],-1)),a("div",Qe,[n.paymentType==="wechat_native"?(d(),m(g,{key:0,color:"#07C160",size:24},{default:t(()=>[l(M(z))]),_:1})):r("",!0)])],2),a("div",{class:$(["payment-method-card",{active:n.paymentType==="alipay_page"}]),onClick:e[1]||(e[1]=E=>q("alipay_page"))},[e[18]||(e[18]=a("div",{class:"method-icon alipay-icon"},[a("svg",{viewBox:"0 0 1024 1024",width:"32",height:"32"},[a("path",{d:"M1024 701.9v162.8c0 88.5-71.7 160.2-160.2 160.2H160.2C71.7 1024.9 0 953.2 0 864.7V159.9C0 71.4 71.7-0.3 160.2-0.3h703.6c88.5 0 160.2 71.7 160.2 160.2v390.8c-51.8-23.8-155.9-67.8-289.8-67.8-228.9 0-378.1 112.1-430.5 210.5l-0.5 0.9 490.4 199.3c47.6-63.3 118.8-127.1 230.4-151.6z m-514.4-68.9c-0.3 0-0.5 0-0.8 0.1-0.3 0-0.5 0.1-0.8 0.1-44.2 8.2-89.3 22.6-134.4 42.8-9.5 4.3-19 8.9-28.4 13.8-52.2-88.7-152.9-148.3-267.3-148.3-15.7 0-31.1 1.2-46.2 3.4V232.3h585.6v401.6c-35.6-0.3-71.7 0-107.7 0.1z m-278.8-236c-51.7 0-93.6 41.9-93.6 93.6s41.9 93.6 93.6 93.6 93.6-41.9 93.6-93.6-41.9-93.6-93.6-93.6z",fill:"#1296DB"})])],-1)),e[19]||(e[19]=a("div",{class:"method-info"},[a("div",{class:"method-name"},"支付宝支付"),a("div",{class:"method-desc"},"支持支付宝扫码或跳转支付")],-1)),a("div",Le,[n.paymentType==="alipay_page"?(d(),m(g,{key:0,color:"#1677FF",size:24},{default:t(()=>[l(M(z))]),_:1})):r("",!0)])],2),a("div",{class:$(["payment-method-card",{active:n.paymentMethod===2}]),onClick:e[2]||(e[2]=E=>q("balance"))},[a("div",He,[l(g,{size:32},{default:t(()=>[l(M(Pe))]),_:1})]),e[20]||(e[20]=a("div",{class:"method-info"},[a("div",{class:"method-name"},"余额支付"),a("div",{class:"method-desc"},"当前余额: ¥0.00")],-1)),a("div",We,[n.paymentMethod===2?(d(),m(g,{key:0,color:"#F56C6C",size:24},{default:t(()=>[l(M(z))]),_:1})):r("",!0)])],2),a("div",{class:$(["payment-method-card",{active:n.paymentMethod===4}]),onClick:e[3]||(e[3]=E=>q("onsite"))},[a("div",je,[l(g,{size:32},{default:t(()=>[l(M(Ve))]),_:1})]),e[21]||(e[21]=a("div",{class:"method-info"},[a("div",{class:"method-name"},"现场支付"),a("div",{class:"method-desc"},"到场后现金或刷卡支付")],-1)),a("div",Ge,[n.paymentMethod===4?(d(),m(g,{key:0,color:"#909399",size:24},{default:t(()=>[l(M(z))]),_:1})):r("",!0)])],2)]),w.value?(d(),b("div",Je,[a("div",Ke,[a("span",null,"请使用"+u(n.paymentType==="wechat_native"?"微信":"支付宝")+"扫码支付",1),l(k,{type:"text",onClick:de,loading:U.value},{default:t(()=>[...e[23]||(e[23]=[i(" 刷新二维码 ",-1)])]),_:1},8,["loading"])]),a("div",Xe,[P.value?(d(),b("img",{key:0,src:P.value,alt:"支付二维码",class:"qr-code-img"},null,8,Ye)):(d(),b("div",Ze,[l(ye,{description:"生成二维码中..."})]))]),a("div",ea,[a("p",null,"支付单号: "+u((H=x.value)==null?void 0:H.paymentNo),1),a("p",null,"订单号: "+u(s.value.bookingNo),1),(W=x.value)!=null&&W.expireTime?(d(),b("p",aa," 二维码有效期至: "+u(ne(x.value.expireTime)),1)):r("",!0)]),a("div",ta,[l(Q,null,{default:t(()=>[...e[24]||(e[24]=[i("开发环境模拟功能",-1)])]),_:1}),a("div",la,[l(k,{type:"success",onClick:ce,disabled:p.value==="success"},{default:t(()=>[...e[25]||(e[25]=[i(" 模拟扫码支付成功 ",-1)])]),_:1},8,["disabled"]),l(k,{type:"danger",onClick:re,disabled:p.value==="failed"},{default:t(()=>[...e[26]||(e[26]=[i(" 模拟扫码支付失败 ",-1)])]),_:1},8,["disabled"])]),e[27]||(e[27]=a("p",{class:"mock-tip"},"点击按钮模拟用户扫码支付结果",-1))])])):r("",!0),ee?(d(),b("div",sa,[p.value==="paying"?(d(),b("div",oa,[l(g,{class:"status-icon is-loading"},{default:t(()=>[l(M(D))]),_:1}),e[28]||(e[28]=a("span",null,"等待支付完成...",-1))])):p.value==="success"?(d(),b("div",na,[l(g,{class:"status-icon"},{default:t(()=>[l(M(z))]),_:1}),e[29]||(e[29]=a("span",null,"支付成功！",-1))])):p.value==="failed"?(d(),b("div",ia,[l(g,{class:"status-icon"},{default:t(()=>[l(M(O))]),_:1}),e[30]||(e[30]=a("span",null,"支付失败，请重试",-1))])):r("",!0)])):r("",!0)]}),_:1},8,["modelValue"]),l(L,{modelValue:N.value,"onUpdate:modelValue":e[8]||(e[8]=c=>N.value=c),title:"取消预订",width:"400px"},{footer:t(()=>[l(k,{onClick:e[7]||(e[7]=c=>N.value=!1)},{default:t(()=>[...e[34]||(e[34]=[i("取消",-1)])]),_:1}),l(k,{type:"danger",onClick:pe,loading:F.value},{default:t(()=>[...e[35]||(e[35]=[i("确认取消",-1)])]),_:1},8,["loading"])]),default:t(()=>[l(he,{model:V,"label-width":"100px"},{default:t(()=>[l(_e,{label:"取消原因",required:""},{default:t(()=>[l(fe,{modelValue:V.cancelReason,"onUpdate:modelValue":e[6]||(e[6]=c=>V.cancelReason=c),type:"textarea",rows:4,placeholder:"请输入取消原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},pa=ke(ua,[["__scopeId","data-v-11f7bede"]]);export{pa as default};
