import{_ as ie,r as v,k as G,t as pe,d as me,e,a as t,b as T,a4 as fe,f as r,p as ce,i as s,u as $,a6 as _e,G as ve,a5 as be,c as A,v as p,ae as ge,g as ye,E as y,D as Ve,o as q}from"./index-DqRIPXSt.js";import{s as x}from"./request-6I7FbxP_.js";function we(c){return x({url:"/api/admin/notification-template/page",method:"get",params:c})}function Ce(c){return x({url:"/api/admin/notification-template",method:"post",data:c})}function Te(c,V){return x({url:`/api/admin/notification-template/${c}`,method:"put",data:V})}function ke(c){return x({url:`/api/admin/notification-template/${c}`,method:"delete"})}function xe(c,V){return x({url:`/api/admin/notification-template/${c}/status`,method:"put",params:{status:V}})}const Ue={class:"template-manage-container"},Ne={class:"card-header"},he={class:"filter-bar"},ze={class:"pagination-container"},Se={__name:"TemplateManage",setup(c){const V=v(!1),E=v([]),M=v(0),C=v(!1),N=v(!1),h=v(""),U=v(!1),d=v(null),z=v(null),u=G({page:1,size:10,templateType:"",scene:"",keyword:""}),n=G({templateCode:"",templateName:"",templateType:"system",scene:"",title:"",content:"",variables:"[]",priority:2,status:1,remark:""}),F={templateCode:[{required:!0,message:"请输入模板编码",trigger:"blur"}],templateName:[{required:!0,message:"请输入模板名称",trigger:"blur"}],templateType:[{required:!0,message:"请选择模板类型",trigger:"change"}],scene:[{required:!0,message:"请输入场景",trigger:"blur"}],title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},O=o=>({system:"primary",sms:"success",email:"warning",wechat:"info"})[o]||"info",R=o=>({system:"系统通知",sms:"短信通知",email:"邮件通知",wechat:"微信通知"})[o]||o,w=async()=>{V.value=!0;try{const o=await we(u);o.code===200&&(E.value=o.data.records,M.value=o.data.total)}catch(o){console.error("加载数据失败:",o),y.error("加载数据失败")}finally{V.value=!1}},j=()=>{u.page=1,w()},J=()=>{u.page=1,u.templateType="",u.scene="",u.keyword="",w()},L=()=>{w()},H=()=>{w()},Q=()=>{h.value="新增模板",U.value=!1,le(),C.value=!0},W=o=>{h.value="编辑模板",U.value=!0,Object.assign(n,o),C.value=!0},X=o=>{d.value=o,N.value=!0},Y=async o=>{try{await Ve.confirm("确定要删除这个模板吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ke(o.id),y.success("删除成功"),w()}catch(l){l!=="cancel"&&(console.error("删除失败:",l),y.error("删除失败"))}},Z=async o=>{try{await xe(o.id,o.status),y.success("状态更新成功")}catch(l){console.error("状态更新失败:",l),y.error("状态更新失败"),o.status=o.status===1?0:1}},ee=async()=>{try{await z.value.validate(),U.value?(await Te(n.id,n),y.success("更新成功")):(await Ce(n),y.success("新增成功")),C.value=!1,w()}catch(o){console.error("提交失败:",o),o!==!1&&y.error("提交失败")}},le=()=>{var o;Object.assign(n,{templateCode:"",templateName:"",templateType:"system",scene:"",title:"",content:"",variables:"[]",priority:2,status:1,remark:""}),(o=z.value)==null||o.clearValidate()};return pe(()=>{w()}),(o,l)=>{const S=r("el-icon"),b=r("el-button"),m=r("el-option"),D=r("el-select"),i=r("el-form-item"),g=r("el-input"),I=r("el-form"),_=r("el-table-column"),B=r("el-tag"),te=r("el-switch"),ae=r("el-table"),oe=r("el-pagination"),ne=r("el-card"),se=r("el-input-number"),K=r("el-radio"),re=r("el-radio-group"),P=r("el-dialog"),f=r("el-descriptions-item"),ue=r("el-descriptions"),de=be("loading");return q(),me("div",Ue,[e(ne,null,{header:t(()=>[T("div",Ne,[l[19]||(l[19]=T("h3",null,"通知模板管理",-1)),e(b,{type:"primary",onClick:Q},{default:t(()=>[e(S,null,{default:t(()=>[e($(ge))]),_:1}),l[18]||(l[18]=s(" 新增模板 ",-1))]),_:1})])]),default:t(()=>[T("div",he,[e(I,{inline:!0,model:u},{default:t(()=>[e(i,{label:"模板类型"},{default:t(()=>[e(D,{modelValue:u.templateType,"onUpdate:modelValue":l[0]||(l[0]=a=>u.templateType=a),placeholder:"全部",clearable:"",style:{width:"150px"}},{default:t(()=>[e(m,{label:"系统通知",value:"system"}),e(m,{label:"短信通知",value:"sms"}),e(m,{label:"邮件通知",value:"email"}),e(m,{label:"微信通知",value:"wechat"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"场景"},{default:t(()=>[e(D,{modelValue:u.scene,"onUpdate:modelValue":l[1]||(l[1]=a=>u.scene=a),placeholder:"全部",clearable:"",style:{width:"150px"}},{default:t(()=>[e(m,{label:"会员到期",value:"member_expire"}),e(m,{label:"课程提醒",value:"course_remind"}),e(m,{label:"预订成功",value:"booking_success"}),e(m,{label:"支付成功",value:"payment_success"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"关键词"},{default:t(()=>[e(g,{modelValue:u.keyword,"onUpdate:modelValue":l[2]||(l[2]=a=>u.keyword=a),placeholder:"模板名称/编码/标题",clearable:"",style:{width:"200px"},onKeyup:ce(j,["enter"])},null,8,["modelValue"])]),_:1}),e(i,null,{default:t(()=>[e(b,{type:"primary",onClick:j},{default:t(()=>[e(S,null,{default:t(()=>[e($(_e))]),_:1}),l[20]||(l[20]=s(" 搜索 ",-1))]),_:1}),e(b,{onClick:J},{default:t(()=>[e(S,null,{default:t(()=>[e($(ve))]),_:1}),l[21]||(l[21]=s(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),fe((q(),A(ae,{data:E.value,border:"",stripe:""},{default:t(()=>[e(_,{prop:"id",label:"ID",width:"80"}),e(_,{prop:"templateCode",label:"模板编码",width:"200"}),e(_,{prop:"templateName",label:"模板名称",width:"150"}),e(_,{prop:"templateType",label:"类型",width:"100"},{default:t(({row:a})=>[e(B,{type:O(a.templateType)},{default:t(()=>[s(p(R(a.templateType)),1)]),_:2},1032,["type"])]),_:1}),e(_,{prop:"scene",label:"场景",width:"120"}),e(_,{prop:"title",label:"标题","min-width":"150","show-overflow-tooltip":""}),e(_,{prop:"content",label:"内容","min-width":"200","show-overflow-tooltip":""}),e(_,{prop:"priority",label:"优先级",width:"80",align:"center"}),e(_,{prop:"status",label:"状态",width:"80",align:"center"},{default:t(({row:a})=>[e(te,{modelValue:a.status,"onUpdate:modelValue":k=>a.status=k,"active-value":1,"inactive-value":0,onChange:k=>Z(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(_,{label:"操作",width:"180",fixed:"right"},{default:t(({row:a})=>[e(b,{type:"primary",link:"",size:"small",onClick:k=>W(a)},{default:t(()=>[...l[22]||(l[22]=[s(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(b,{type:"info",link:"",size:"small",onClick:k=>X(a)},{default:t(()=>[...l[23]||(l[23]=[s(" 查看 ",-1)])]),_:1},8,["onClick"]),e(b,{type:"danger",link:"",size:"small",onClick:k=>Y(a)},{default:t(()=>[...l[24]||(l[24]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,V.value]]),T("div",ze,[e(oe,{"current-page":u.page,"onUpdate:currentPage":l[3]||(l[3]=a=>u.page=a),"page-size":u.size,"onUpdate:pageSize":l[4]||(l[4]=a=>u.size=a),total:M.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:L,onCurrentChange:H},null,8,["current-page","page-size","total"])])]),_:1}),e(P,{modelValue:C.value,"onUpdate:modelValue":l[16]||(l[16]=a=>C.value=a),title:h.value,width:"700px","close-on-click-modal":!1},{footer:t(()=>[e(b,{onClick:l[15]||(l[15]=a=>C.value=!1)},{default:t(()=>[...l[29]||(l[29]=[s("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:ee},{default:t(()=>[...l[30]||(l[30]=[s("确定",-1)])]),_:1})]),default:t(()=>[e(I,{ref_key:"formRef",ref:z,model:n,rules:F,"label-width":"100px"},{default:t(()=>[e(i,{label:"模板编码",prop:"templateCode"},{default:t(()=>[e(g,{modelValue:n.templateCode,"onUpdate:modelValue":l[5]||(l[5]=a=>n.templateCode=a),placeholder:"请输入模板编码，如：BOOKING_SUCCESS",disabled:U.value},null,8,["modelValue","disabled"])]),_:1}),e(i,{label:"模板名称",prop:"templateName"},{default:t(()=>[e(g,{modelValue:n.templateName,"onUpdate:modelValue":l[6]||(l[6]=a=>n.templateName=a),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),e(i,{label:"模板类型",prop:"templateType"},{default:t(()=>[e(D,{modelValue:n.templateType,"onUpdate:modelValue":l[7]||(l[7]=a=>n.templateType=a),placeholder:"请选择",style:{width:"100%"}},{default:t(()=>[e(m,{label:"系统通知",value:"system"}),e(m,{label:"短信通知",value:"sms"}),e(m,{label:"邮件通知",value:"email"}),e(m,{label:"微信通知",value:"wechat"})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"场景",prop:"scene"},{default:t(()=>[e(g,{modelValue:n.scene,"onUpdate:modelValue":l[8]||(l[8]=a=>n.scene=a),placeholder:"如：member_expire, course_remind"},null,8,["modelValue"])]),_:1}),e(i,{label:"标题",prop:"title"},{default:t(()=>[e(g,{modelValue:n.title,"onUpdate:modelValue":l[9]||(l[9]=a=>n.title=a),placeholder:"通知标题"},null,8,["modelValue"])]),_:1}),e(i,{label:"内容",prop:"content"},{default:t(()=>[e(g,{modelValue:n.content,"onUpdate:modelValue":l[10]||(l[10]=a=>n.content=a),type:"textarea",rows:4,placeholder:"通知内容，支持变量：{{变量名}}"},null,8,["modelValue"]),l[25]||(l[25]=T("div",{class:"form-tip"}," 提示：使用 双花括号+变量名+双花括号 格式插入变量，如：双花括号userName双花括号、双花括号expireDate双花括号 ",-1))]),_:1}),e(i,{label:"变量列表",prop:"variables"},{default:t(()=>[e(g,{modelValue:n.variables,"onUpdate:modelValue":l[11]||(l[11]=a=>n.variables=a),placeholder:'JSON数组格式，如：["userName","expireDate"]'},null,8,["modelValue"])]),_:1}),e(i,{label:"优先级",prop:"priority"},{default:t(()=>[e(se,{modelValue:n.priority,"onUpdate:modelValue":l[12]||(l[12]=a=>n.priority=a),min:1,max:10},null,8,["modelValue"]),l[26]||(l[26]=T("span",{class:"form-tip"},"（1-10，数字越大优先级越高）",-1))]),_:1}),e(i,{label:"状态",prop:"status"},{default:t(()=>[e(re,{modelValue:n.status,"onUpdate:modelValue":l[13]||(l[13]=a=>n.status=a)},{default:t(()=>[e(K,{value:1},{default:t(()=>[...l[27]||(l[27]=[s("启用",-1)])]),_:1}),e(K,{value:0},{default:t(()=>[...l[28]||(l[28]=[s("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"备注"},{default:t(()=>[e(g,{modelValue:n.remark,"onUpdate:modelValue":l[14]||(l[14]=a=>n.remark=a),type:"textarea",rows:2,placeholder:"备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(P,{modelValue:N.value,"onUpdate:modelValue":l[17]||(l[17]=a=>N.value=a),title:"模板详情",width:"600px"},{default:t(()=>[d.value?(q(),A(ue,{key:0,column:1,border:""},{default:t(()=>[e(f,{label:"模板编码"},{default:t(()=>[s(p(d.value.templateCode),1)]),_:1}),e(f,{label:"模板名称"},{default:t(()=>[s(p(d.value.templateName),1)]),_:1}),e(f,{label:"模板类型"},{default:t(()=>[e(B,{type:O(d.value.templateType)},{default:t(()=>[s(p(R(d.value.templateType)),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"场景"},{default:t(()=>[s(p(d.value.scene),1)]),_:1}),e(f,{label:"标题"},{default:t(()=>[s(p(d.value.title),1)]),_:1}),e(f,{label:"内容"},{default:t(()=>[s(p(d.value.content),1)]),_:1}),e(f,{label:"变量列表"},{default:t(()=>[s(p(d.value.variables),1)]),_:1}),e(f,{label:"优先级"},{default:t(()=>[s(p(d.value.priority),1)]),_:1}),e(f,{label:"状态"},{default:t(()=>[e(B,{type:d.value.status===1?"success":"danger"},{default:t(()=>[s(p(d.value.status===1?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),e(f,{label:"备注"},{default:t(()=>[s(p(d.value.remark||"-"),1)]),_:1}),e(f,{label:"创建时间"},{default:t(()=>[s(p(d.value.createTime),1)]),_:1}),e(f,{label:"更新时间"},{default:t(()=>[s(p(d.value.updateTime),1)]),_:1})]),_:1})):ye("",!0)]),_:1},8,["modelValue"])])}}},$e=ie(Se,[["__scopeId","data-v-1a4f385a"]]);export{$e as default};
