import{r as x}from"./request-BICGRQIW.js";import{aC as we,r as c,k as Q,t as Ce,d as X,e,a,f as n,E as y,i as r,b as s,B as d,a3 as xe,a4 as Ne,c as Y,z as Z,g as ee,M as ke,o as U,_ as he}from"./index-zUzrFZpX.js";const ze={class:"financial-container"},Ue={class:"header-content"},De={class:"stat-content"},Re={class:"stat-icon income"},Be={class:"stat-info"},Fe={class:"stat-value"},Me={class:"stat-content"},Se={class:"stat-icon expense"},Ee={class:"stat-info"},qe={class:"stat-value"},$e={class:"stat-content"},Ie={class:"stat-icon balance"},Ae={class:"stat-info"},je={class:"stat-value"},Le={class:"stat-content"},Pe={class:"stat-icon count"},We={class:"stat-info"},Oe={class:"stat-value"},Ge={class:"current-balance"},He={key:0},Je={class:"current-balance"},Ke=we({__name:"FinancialManage",setup(Qe){const D=c(!1),R=c(!1),w=c(!1),B=c(!1),N=c("create"),F=c(),p=Q({recordType:"",businessType:"",orderNo:""}),i=Q({id:null,recordType:1,businessType:1,orderNo:"",amount:0,description:""}),te={recordType:[{required:!0,message:"请选择记录类型",trigger:"change"}],businessType:[{required:!0,message:"请选择业务类型",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"}],description:[{required:!0,message:"请输入描述",trigger:"blur"}]},A=c([]),M=c(0),C=c(1),k=c(10),j=c(0),L=c(0),P=c(0),u=c(null),T=async()=>{D.value=!0;try{const o={current:C.value,size:k.value,...p},t=await x.get("/api/financial/page",{params:o});t.code===200&&(A.value=t.data.records,M.value=t.data.total)}catch{y.error("获取财务记录失败")}D.value=!1},S=async()=>{try{const o=await x.get("/api/financial/statistics");o.code===200&&(j.value=o.data.totalIncome,L.value=o.data.totalExpense,P.value=o.data.balance)}catch(o){console.error("获取财务统计失败:",o)}},W=()=>{C.value=1,T()},ae=()=>{p.recordType="",p.businessType="",p.orderNo="",W()},le=()=>{N.value="create",i.id=null,Object.assign(i,{recordType:1,businessType:1,orderNo:"",amount:0,description:""}),w.value=!0},oe=async()=>{F.value&&await F.value.validate(async o=>{if(o){R.value=!0;try{const t=N.value==="create"?"/api/financial/create":"/api/financial/update",f=await x.post(t,i);f.code===200?(y.success(N.value==="create"?"创建成功":"更新成功"),w.value=!1,T(),S()):y.error(f.message||"操作失败")}catch{y.error("保存失败")}R.value=!1}})},se=async o=>{try{const t=await x.get(`/api/financial/${o.id}`);t.code===200&&(u.value=t.data,B.value=!0)}catch{y.error("获取财务记录详情失败")}},ne=async o=>{try{await ke.confirm("确定要删除此财务记录吗？","提示",{type:"warning"});const t=await x.delete(`/api/financial/${o.id}`);t.code===200?(y.success("删除成功"),T(),S()):y.error(t.message||"删除失败")}catch(t){t!=="cancel"&&y.error("删除失败")}},O=o=>({1:"收入",2:"支出",3:"退款"})[o]||"未知",G=o=>({1:"success",2:"danger",3:"warning"})[o]||"info",H=o=>({1:"场地",2:"课程",3:"会员卡",4:"其他"})[o]||"未知",v=o=>o==null?"0.00":Number(o).toFixed(2),re=o=>o?new Date(o).toLocaleString():"",de=o=>{k.value=o,T()},ie=o=>{C.value=o,T()};return Ce(()=>{T(),S()}),(o,t)=>{const f=n("el-button"),_=n("el-option"),E=n("el-select"),b=n("el-form-item"),q=n("el-input"),J=n("el-form"),V=n("el-card"),ue=n("Money"),h=n("el-icon"),z=n("el-col"),ce=n("TrendCharts"),pe=n("Wallet"),_e=n("Document"),me=n("el-row"),m=n("el-table-column"),$=n("el-tag"),fe=n("el-table"),ve=n("el-pagination"),I=n("el-radio"),be=n("el-radio-group"),ge=n("el-input-number"),K=n("el-dialog"),g=n("el-descriptions-item"),ye=n("el-descriptions"),Te=Ne("loading");return U(),X("div",ze,[e(V,{class:"page-header"},{header:a(()=>[s("div",Ue,[t[14]||(t[14]=s("h2",null,"财务管理",-1)),e(f,{type:"primary",onClick:le},{default:a(()=>[...t[13]||(t[13]=[r("创建记录",-1)])]),_:1})])]),default:a(()=>[e(J,{model:p,inline:""},{default:a(()=>[e(b,{label:"记录类型"},{default:a(()=>[e(E,{modelValue:p.recordType,"onUpdate:modelValue":t[0]||(t[0]=l=>p.recordType=l),placeholder:"请选择类型",clearable:""},{default:a(()=>[e(_,{label:"收入",value:1}),e(_,{label:"支出",value:2}),e(_,{label:"退款",value:3})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"业务类型"},{default:a(()=>[e(E,{modelValue:p.businessType,"onUpdate:modelValue":t[1]||(t[1]=l=>p.businessType=l),placeholder:"请选择业务类型",clearable:""},{default:a(()=>[e(_,{label:"场地",value:1}),e(_,{label:"课程",value:2}),e(_,{label:"会员卡",value:3}),e(_,{label:"其他",value:4})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"订单号"},{default:a(()=>[e(q,{modelValue:p.orderNo,"onUpdate:modelValue":t[2]||(t[2]=l=>p.orderNo=l),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])]),_:1}),e(b,null,{default:a(()=>[e(f,{type:"primary",onClick:W},{default:a(()=>[...t[15]||(t[15]=[r("搜索",-1)])]),_:1}),e(f,{onClick:ae},{default:a(()=>[...t[16]||(t[16]=[r("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(me,{gutter:20,class:"statistics-cards"},{default:a(()=>[e(z,{span:6},{default:a(()=>[e(V,{class:"stat-card"},{default:a(()=>[s("div",De,[s("div",Re,[e(h,null,{default:a(()=>[e(ue)]),_:1})]),s("div",Be,[t[17]||(t[17]=s("div",{class:"stat-title"},"总收入",-1)),s("div",Fe,"¥"+d(v(j.value)),1)])])]),_:1})]),_:1}),e(z,{span:6},{default:a(()=>[e(V,{class:"stat-card"},{default:a(()=>[s("div",Me,[s("div",Se,[e(h,null,{default:a(()=>[e(ce)]),_:1})]),s("div",Ee,[t[18]||(t[18]=s("div",{class:"stat-title"},"总支出",-1)),s("div",qe,"¥"+d(v(L.value)),1)])])]),_:1})]),_:1}),e(z,{span:6},{default:a(()=>[e(V,{class:"stat-card"},{default:a(()=>[s("div",$e,[s("div",Ie,[e(h,null,{default:a(()=>[e(pe)]),_:1})]),s("div",Ae,[t[19]||(t[19]=s("div",{class:"stat-title"},"当前余额",-1)),s("div",je,"¥"+d(v(P.value)),1)])])]),_:1})]),_:1}),e(z,{span:6},{default:a(()=>[e(V,{class:"stat-card"},{default:a(()=>[s("div",Le,[s("div",Pe,[e(h,null,{default:a(()=>[e(_e)]),_:1})]),s("div",We,[t[20]||(t[20]=s("div",{class:"stat-title"},"记录总数",-1)),s("div",Oe,d(M.value)+" 条",1)])])]),_:1})]),_:1})]),_:1}),e(V,{class:"content-card"},{default:a(()=>[xe((U(),Y(fe,{data:A.value},{default:a(()=>[e(m,{prop:"id",label:"ID",width:"80"}),e(m,{prop:"recordNo",label:"流水号",width:"160"}),e(m,{prop:"recordType",label:"类型",width:"100"},{default:a(({row:l})=>[e($,{type:G(l.recordType)},{default:a(()=>[r(d(O(l.recordType)),1)]),_:2},1032,["type"])]),_:1}),e(m,{prop:"businessType",label:"业务类型",width:"100"},{default:a(({row:l})=>[e($,{type:"info"},{default:a(()=>[r(d(H(l.businessType)),1)]),_:2},1024)]),_:1}),e(m,{prop:"amount",label:"金额",width:"120"},{default:a(({row:l})=>[s("span",{class:Z(["amount",l.recordType===1?"income":"expense"])},d(l.recordType===1?"+":"-")+"¥"+d(v(l.amount)),3)]),_:1}),e(m,{prop:"balanceBefore",label:"变动前余额",width:"120"},{default:a(({row:l})=>[r(" ¥"+d(v(l.balanceBefore)),1)]),_:1}),e(m,{prop:"balanceAfter",label:"变动后余额",width:"120"},{default:a(({row:l})=>[s("span",Ge,"¥"+d(v(l.balanceAfter)),1)]),_:1}),e(m,{prop:"orderNo",label:"关联订单号",width:"140"}),e(m,{prop:"description",label:"描述","min-width":"200"}),e(m,{prop:"createTime",label:"创建时间",width:"180"}),e(m,{label:"操作",width:"120",fixed:"right"},{default:a(({row:l})=>[e(f,{type:"primary",size:"small",onClick:Ve=>se(l)},{default:a(()=>[...t[21]||(t[21]=[r("查看",-1)])]),_:1},8,["onClick"]),l.recordType===1?(U(),Y(f,{key:0,type:"danger",size:"small",onClick:Ve=>ne(l)},{default:a(()=>[...t[22]||(t[22]=[r("删除",-1)])]),_:1},8,["onClick"])):ee("",!0)]),_:1})]),_:1},8,["data"])),[[Te,D.value]]),e(ve,{"current-page":C.value,"onUpdate:currentPage":t[3]||(t[3]=l=>C.value=l),"page-size":k.value,"onUpdate:pageSize":t[4]||(t[4]=l=>k.value=l),total:M.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:ie},null,8,["current-page","page-size","total"])]),_:1}),e(K,{modelValue:w.value,"onUpdate:modelValue":t[11]||(t[11]=l=>w.value=l),title:N.value==="create"?"创建财务记录":"编辑财务记录",width:"600px"},{footer:a(()=>[e(f,{onClick:t[10]||(t[10]=l=>w.value=!1)},{default:a(()=>[...t[26]||(t[26]=[r("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:oe,loading:R.value},{default:a(()=>[...t[27]||(t[27]=[r("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(J,{ref_key:"recordFormRef",ref:F,model:i,rules:te,"label-width":"100px"},{default:a(()=>[e(b,{label:"记录类型",prop:"recordType"},{default:a(()=>[e(be,{modelValue:i.recordType,"onUpdate:modelValue":t[5]||(t[5]=l=>i.recordType=l)},{default:a(()=>[e(I,{value:1},{default:a(()=>[...t[23]||(t[23]=[r("收入",-1)])]),_:1}),e(I,{value:2},{default:a(()=>[...t[24]||(t[24]=[r("支出",-1)])]),_:1}),e(I,{value:3},{default:a(()=>[...t[25]||(t[25]=[r("退款",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"业务类型",prop:"businessType"},{default:a(()=>[e(E,{modelValue:i.businessType,"onUpdate:modelValue":t[6]||(t[6]=l=>i.businessType=l),placeholder:"请选择业务类型"},{default:a(()=>[e(_,{label:"场地",value:1}),e(_,{label:"课程",value:2}),e(_,{label:"会员卡",value:3}),e(_,{label:"其他",value:4})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"金额",prop:"amount"},{default:a(()=>[e(ge,{modelValue:i.amount,"onUpdate:modelValue":t[7]||(t[7]=l=>i.amount=l),precision:2,min:.01,step:.01,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(b,{label:"关联订单号",prop:"orderNo"},{default:a(()=>[e(q,{modelValue:i.orderNo,"onUpdate:modelValue":t[8]||(t[8]=l=>i.orderNo=l),placeholder:"请输入关联订单号"},null,8,["modelValue"])]),_:1}),e(b,{label:"描述",prop:"description"},{default:a(()=>[e(q,{modelValue:i.description,"onUpdate:modelValue":t[9]||(t[9]=l=>i.description=l),type:"textarea",rows:3,placeholder:"请输入描述信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(K,{modelValue:B.value,"onUpdate:modelValue":t[12]||(t[12]=l=>B.value=l),title:"财务记录详情",width:"600px"},{default:a(()=>[u.value?(U(),X("div",He,[e(ye,{column:2,border:""},{default:a(()=>[e(g,{label:"流水号"},{default:a(()=>[r(d(u.value.recordNo),1)]),_:1}),e(g,{label:"记录类型"},{default:a(()=>[e($,{type:G(u.value.recordType)},{default:a(()=>[r(d(O(u.value.recordType)),1)]),_:1},8,["type"])]),_:1}),e(g,{label:"业务类型"},{default:a(()=>[r(d(H(u.value.businessType)),1)]),_:1}),e(g,{label:"金额"},{default:a(()=>[s("span",{class:Z(["amount",u.value.recordType===1?"income":"expense"])},d(u.value.recordType===1?"+":"-")+"¥"+d(v(u.value.amount)),3)]),_:1}),e(g,{label:"变动前余额"},{default:a(()=>[r("¥"+d(v(u.value.balanceBefore)),1)]),_:1}),e(g,{label:"变动后余额"},{default:a(()=>[s("span",Je,"¥"+d(v(u.value.balanceAfter)),1)]),_:1}),e(g,{label:"关联订单号"},{default:a(()=>[r(d(u.value.orderNo),1)]),_:1}),e(g,{label:"创建时间"},{default:a(()=>[r(d(re(u.value.createTime)),1)]),_:1}),e(g,{label:"描述",span:2},{default:a(()=>[r(d(u.value.description),1)]),_:1})]),_:1})])):ee("",!0)]),_:1},8,["modelValue"])])}}}),Ze=he(Ke,[["__scopeId","data-v-ad83f3d0"]]);export{Ze as default};
