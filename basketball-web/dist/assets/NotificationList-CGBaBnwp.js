import{_ as J,r as E,M as W,n as Z,E as d,d as _,e as n,a as o,f as c,k as ee,R as te,o as s,b as i,Q as ae,g as C,i as l,c as R,F as oe,q as ne,v as se,a6 as ie,x as le,y as v,$ as I,z as A,A as U,s as T,B as re,K as L}from"./index-Do8XCnNk.js";import{b as ce,c as de,a as _e,d as ue,m as Ee}from"./notification-cMzTHiDR.js";import"./request-fDvtbK_n.js";const Ce={class:"notification-list-container"},Se={class:"card-header"},pe={class:"header-actions"},fe={class:"filter-bar"},Re={class:"notification-content"},ve=["onClick"],ge={class:"notification-left"},Ne={class:"notification-main"},Oe={class:"notification-header-row"},ye={class:"notification-title"},Fe={class:"notification-time"},me={class:"notification-body"},Me={key:0,class:"notification-meta"},Ae={key:0,class:"related-id"},Ue={class:"notification-actions"},Te={key:0,class:"pagination-container"},ke={__name:"NotificationList",setup(Be){const D=ee(),S=E([]),g=E(!1),u=E(1),N=E(10),y=E(0),O=E(""),h=W(()=>S.value.some(t=>t.isRead===0));Z(()=>{p()});const p=async()=>{g.value=!0;try{let t;O.value==="unread"?t=await ce({page:u.value,size:N.value}):t=await de({page:u.value,size:N.value,type:O.value||void 0}),t.code===200&&(S.value=t.data.records||[],y.value=t.data.total||0)}catch(t){console.error("获取通知列表失败:",t),d.error("获取通知列表失败")}finally{g.value=!1}},z=()=>{u.value=1,p()},w=()=>{p()},x=()=>{u.value=1,p()},K=t=>{D.push(`/notification/${t.id}`)},P=async t=>{try{await _e(t.id),t.isRead=1,d.success("已标记为已读")}catch(e){console.error("标记已读失败:",e),d.error("操作失败")}},G=async()=>{try{await L.confirm("确定要将所有未读消息标记为已读吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Ee(),S.value.forEach(t=>{t.isRead=1}),d.success("已全部标记为已读")}catch(t){t!=="cancel"&&(console.error("全部已读失败:",t),d.error("操作失败"))}},b=async t=>{try{await L.confirm("确定要删除这条通知吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ue(t.id),d.success("删除成功"),p()}catch(e){e!=="cancel"&&(console.error("删除失败:",e),d.error("删除失败"))}},$=t=>({BOOKING_SUCCESS:T,BOOKING_CANCEL:U,COURSE_ENROLL_SUCCESS:T,COURSE_ENROLL_CANCEL:U,PAYMENT_SUCCESS:T,REFUND_SUCCESS:A,MEMBER_CARD_EXPIRE_SOON:U,COURSE_START_REMINDER:A,BOOKING_START_REMINDER:A})[t]||re,V=t=>({BOOKING_SUCCESS:"#67C23A",BOOKING_CANCEL:"#E6A23C",COURSE_ENROLL_SUCCESS:"#67C23A",COURSE_ENROLL_CANCEL:"#E6A23C",PAYMENT_SUCCESS:"#67C23A",REFUND_SUCCESS:"#409EFF",MEMBER_CARD_EXPIRE_SOON:"#E6A23C",COURSE_START_REMINDER:"#409EFF",BOOKING_START_REMINDER:"#409EFF"})[t]||"#909399",Y=t=>({BOOKING_SUCCESS:"#F0F9FF",BOOKING_CANCEL:"#FEF6EC",COURSE_ENROLL_SUCCESS:"#F0F9FF",COURSE_ENROLL_CANCEL:"#FEF6EC",PAYMENT_SUCCESS:"#F0F9FF",REFUND_SUCCESS:"#EFF6FF",MEMBER_CARD_EXPIRE_SOON:"#FEF6EC",COURSE_START_REMINDER:"#EFF6FF",BOOKING_START_REMINDER:"#EFF6FF"})[t]||"#F5F7FA",X=t=>({BOOKING:"预订",COURSE:"课程",PAYMENT:"支付",MEMBER_CARD:"会员卡"})[t]||t,j=t=>{if(!t)return"";const e=new Date(t),f=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),F=String(e.getDate()).padStart(2,"0"),m=String(e.getHours()).padStart(2,"0"),M=String(e.getMinutes()).padStart(2,"0");return`${f}-${r}-${F} ${m}:${M}`};return(t,e)=>{const f=c("el-button"),r=c("el-radio-button"),F=c("el-radio-group"),m=c("el-empty"),M=c("el-icon"),k=c("el-tag"),q=c("el-pagination"),H=c("el-card"),Q=te("loading");return s(),_("div",Ce,[n(H,null,{header:o(()=>[i("div",Se,[e[4]||(e[4]=i("h3",null,"通知中心",-1)),i("div",pe,[h.value?(s(),R(f,{key:0,type:"primary",size:"small",onClick:G},{default:o(()=>[...e[3]||(e[3]=[l(" 全部已读 ",-1)])]),_:1})):C("",!0)])])]),default:o(()=>[i("div",fe,[n(F,{modelValue:O.value,"onUpdate:modelValue":e[0]||(e[0]=a=>O.value=a),onChange:z},{default:o(()=>[n(r,{value:""},{default:o(()=>[...e[5]||(e[5]=[l("全部",-1)])]),_:1}),n(r,{value:"unread"},{default:o(()=>[...e[6]||(e[6]=[l("未读",-1)])]),_:1}),n(r,{value:"BOOKING_SUCCESS"},{default:o(()=>[...e[7]||(e[7]=[l("预订通知",-1)])]),_:1}),n(r,{value:"COURSE_ENROLL_SUCCESS"},{default:o(()=>[...e[8]||(e[8]=[l("课程通知",-1)])]),_:1}),n(r,{value:"PAYMENT_SUCCESS"},{default:o(()=>[...e[9]||(e[9]=[l("支付通知",-1)])]),_:1}),n(r,{value:"MEMBER_CARD_EXPIRE_SOON"},{default:o(()=>[...e[10]||(e[10]=[l("会员提醒",-1)])]),_:1})]),_:1},8,["modelValue"])]),ae((s(),_("div",Re,[S.value.length===0&&!g.value?(s(),R(m,{key:0,description:"暂无通知"})):(s(!0),_(oe,{key:1},ne(S.value,a=>(s(),_("div",{key:a.id,class:se(["notification-card",{"is-unread":a.isRead===0}]),onClick:B=>K(a)},[i("div",ge,[i("div",{class:"notification-icon",style:ie({backgroundColor:Y(a.type)})},[n(M,{size:24,color:V(a.type)},{default:o(()=>[(s(),R(le($(a.type))))]),_:2},1032,["color"])],4)]),i("div",Ne,[i("div",Oe,[i("div",ye,[l(v(a.title)+" ",1),a.isRead===0?(s(),R(k,{key:0,type:"danger",size:"small",effect:"dark"},{default:o(()=>[...e[11]||(e[11]=[l(" 未读 ",-1)])]),_:1})):C("",!0)]),i("div",Fe,v(j(a.sendTime)),1)]),i("div",me,v(a.content),1),a.relatedType?(s(),_("div",Me,[n(k,{size:"small",type:"info"},{default:o(()=>[l(v(X(a.relatedType)),1)]),_:2},1024),a.relatedId?(s(),_("span",Ae,"ID: "+v(a.relatedId),1)):C("",!0)])):C("",!0)]),i("div",Ue,[a.isRead===0?(s(),R(f,{key:0,type:"text",size:"small",onClick:I(B=>P(a),["stop"])},{default:o(()=>[...e[12]||(e[12]=[l(" 标记已读 ",-1)])]),_:1},8,["onClick"])):C("",!0),n(f,{type:"text",size:"small",onClick:I(B=>b(a),["stop"])},{default:o(()=>[...e[13]||(e[13]=[l(" 删除 ",-1)])]),_:1},8,["onClick"])])],10,ve))),128))])),[[Q,g.value]]),y.value>0?(s(),_("div",Te,[n(q,{"current-page":u.value,"onUpdate:currentPage":e[1]||(e[1]=a=>u.value=a),"page-size":N.value,"onUpdate:pageSize":e[2]||(e[2]=a=>N.value=a),total:y.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x,onCurrentChange:w},null,8,["current-page","page-size","total"])])):C("",!0)]),_:1})])}}},he=J(ke,[["__scopeId","data-v-ec98c4d2"]]);export{he as default};
