import{_ as J,r as d,j as K,U as L,M as B,n as Q,d as T,e as a,b as o,a as l,f as r,E as p,k as W,o as _,g as M,y as c,i as h,u as X,O as Z,c as q}from"./index-Do8XCnNk.js";import{a as ee}from"./venue-BjX1hId4.js";import{b as te,d as ae}from"./booking-JYiOWMfP.js";import"./request-fDvtbK_n.js";const oe={class:"booking-create-container"},le={class:"create-content"},ne={key:0,class:"venue-info"},se=["src"],re={class:"venue-details"},ie={class:"location"},ue={class:"price"},de={class:"price-value"},ce={key:0,class:"availability-tip"},me={class:"price-summary"},pe={class:"price-item"},_e={class:"price-item"},ve={class:"price-item total"},fe={class:"total-price"},ge={class:"action-buttons"},be={__name:"Create",setup(ke){const V=L(),g=W(),b=d(null),k=d(!1),i=d(null),v=d(!1),m=d(!1),D=d(!1),e=K({venueId:V.params.venueId,bookingDate:"",startTime:"",endTime:"",bookingType:1,contactName:"",contactPhone:"",peopleCount:1,remark:""}),H={bookingDate:[{required:!0,message:"请选择预订日期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],contactPhone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},w=B(()=>{if(!e.startTime||!e.endTime)return 0;const n=new Date(`2000-01-01 ${e.startTime}`),f=(new Date(`2000-01-01 ${e.endTime}`)-n)/(1e3*60*60);return f>0?f:0}),R=B(()=>{var n;return(n=i.value)!=null&&n.basePrice?w.value*i.value.basePrice:0}),A=n=>n<new Date(new Date().setHours(0,0,0,0)),C=async()=>{if(!e.bookingDate||!e.startTime||!e.endTime){v.value=!1;return}D.value=!0;try{const n=await te({venueId:e.venueId,bookingDate:e.bookingDate,startTime:e.startTime,endTime:e.endTime});m.value=n.data,v.value=!0}catch(n){p.error(n.message||"检查可用性失败"),m.value=!1,v.value=!1}finally{D.value=!1}},$=async()=>{try{const n=await ee(V.params.venueId);i.value=n.data}catch(n){p.error(n.message||"获取场地信息失败"),g.back()}},P=()=>{g.back()},E=async()=>{if(b.value)try{if(await b.value.validate(),!m.value){p.warning("该时段不可预订,请重新选择");return}k.value=!0;const n=await ae({venueId:parseInt(e.venueId),bookingDate:e.bookingDate,startTime:e.startTime,endTime:e.endTime,bookingType:e.bookingType,contactName:e.contactName,contactPhone:e.contactPhone,peopleCount:e.peopleCount,remark:e.remark});p.success("预订成功"),g.push(`/booking/detail/${n.data}`)}catch(n){p.error(n.message||"预订失败")}finally{k.value=!1}};return Q(()=>{$()}),(n,t)=>{const f=r("el-page-header"),j=r("el-icon"),N=r("el-card"),z=r("el-date-picker"),u=r("el-form-item"),x=r("el-time-select"),I=r("el-col"),F=r("el-row"),U=r("el-alert"),y=r("el-input"),S=r("el-input-number"),O=r("el-form"),Y=r("el-button");return _(),T("div",oe,[a(f,{onBack:P,title:"返回"},{content:l(()=>[...t[7]||(t[7]=[o("span",{class:"page-title"},"预订场地",-1)])]),_:1}),o("div",le,[a(N,{class:"venue-card"},{header:l(()=>[...t[8]||(t[8]=[o("div",{class:"card-header"},[o("span",null,"场地信息")],-1)])]),default:l(()=>[i.value?(_(),T("div",ne,[o("img",{src:i.value.imageUrl||"/default-venue.jpg",alt:"场地图片",class:"venue-image"},null,8,se),o("div",re,[o("h2",null,c(i.value.venueName),1),o("p",ie,[a(j,null,{default:l(()=>[a(X(Z))]),_:1}),h(" "+c(i.value.location),1)]),o("p",ue,[t[9]||(t[9]=o("span",{class:"price-label"},"价格:",-1)),o("span",de,"¥"+c(i.value.basePrice)+"/小时",1)])])])):M("",!0)]),_:1}),a(N,{class:"form-card"},{header:l(()=>[...t[10]||(t[10]=[o("div",{class:"card-header"},[o("span",null,"预订信息")],-1)])]),default:l(()=>[a(O,{ref_key:"formRef",ref:b,model:e,rules:H,"label-width":"100px"},{default:l(()=>[a(u,{label:"预订日期",prop:"bookingDate",required:""},{default:l(()=>[a(z,{modelValue:e.bookingDate,"onUpdate:modelValue":t[0]||(t[0]=s=>e.bookingDate=s),type:"date",placeholder:"选择预订日期","disabled-date":A,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(u,{label:"预订时段",required:""},{default:l(()=>[a(F,{gutter:16},{default:l(()=>[a(I,{span:12},{default:l(()=>[a(u,{prop:"startTime"},{default:l(()=>[a(x,{modelValue:e.startTime,"onUpdate:modelValue":t[1]||(t[1]=s=>e.startTime=s),placeholder:"开始时间",start:"06:00",end:"22:00",step:"01:00",format:"HH:mm",onChange:C,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(I,{span:12},{default:l(()=>[a(u,{prop:"endTime"},{default:l(()=>[a(x,{modelValue:e.endTime,"onUpdate:modelValue":t[2]||(t[2]=s=>e.endTime=s),placeholder:"结束时间",start:"07:00",end:"23:00",step:"01:00",format:"HH:mm","min-time":e.startTime,onChange:C,style:{width:"100%"}},null,8,["modelValue","min-time"])]),_:1})]),_:1})]),_:1}),v.value?(_(),T("div",ce,[m.value?(_(),q(U,{key:0,title:"该时段可预订",type:"success",closable:!1,"show-icon":""})):(_(),q(U,{key:1,title:"该时段已被预订,请选择其他时间",type:"error",closable:!1,"show-icon":""}))])):M("",!0)]),_:1}),a(u,{label:"联系人",prop:"contactName"},{default:l(()=>[a(y,{modelValue:e.contactName,"onUpdate:modelValue":t[3]||(t[3]=s=>e.contactName=s),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),a(u,{label:"联系电话",prop:"contactPhone"},{default:l(()=>[a(y,{modelValue:e.contactPhone,"onUpdate:modelValue":t[4]||(t[4]=s=>e.contactPhone=s),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(u,{label:"人数",prop:"peopleCount"},{default:l(()=>{var s;return[a(S,{modelValue:e.peopleCount,"onUpdate:modelValue":t[5]||(t[5]=G=>e.peopleCount=G),min:1,max:((s=i.value)==null?void 0:s.capacity)||100,placeholder:"请输入人数"},null,8,["modelValue","max"])]}),_:1}),a(u,{label:"备注",prop:"remark"},{default:l(()=>[a(y,{modelValue:e.remark,"onUpdate:modelValue":t[6]||(t[6]=s=>e.remark=s),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1}),a(u,{label:"预计费用"},{default:l(()=>{var s;return[o("div",me,[o("div",pe,[t[11]||(t[11]=o("span",null,"时长:",-1)),o("span",null,c(w.value)+" 小时",1)]),o("div",_e,[t[12]||(t[12]=o("span",null,"单价:",-1)),o("span",null,"¥"+c(((s=i.value)==null?void 0:s.basePrice)||0)+"/小时",1)]),o("div",ve,[t[13]||(t[13]=o("span",null,"总计:",-1)),o("span",fe,"¥"+c(R.value.toFixed(2)),1)])])]}),_:1})]),_:1},8,["model"])]),_:1}),o("div",ge,[a(Y,{onClick:P,size:"large"},{default:l(()=>[...t[14]||(t[14]=[h("取消",-1)])]),_:1}),a(Y,{type:"primary",size:"large",onClick:E,loading:k.value,disabled:!m.value},{default:l(()=>[...t[15]||(t[15]=[h(" 确认预订 ",-1)])]),_:1},8,["loading","disabled"])])])])}}},De=J(be,[["__scopeId","data-v-b5e8767e"]]);export{De as default};
