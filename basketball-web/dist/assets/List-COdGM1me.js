import{_ as ae,r,j as N,n as le,d as $,b as o,e as a,Q as oe,c as w,g as S,a as l,f as i,R as ne,F as se,q as ie,E as v,k as de,o as p,i as s,y as u,u as B,O as ue,G as re,V as pe,W as ce}from"./index-DfALJeeI.js";import{g as me,p as fe,c as _e}from"./booking-AgLH9Eox.js";import"./request-CZtBzr0V.js";const ve={class:"booking-list-container"},ge={class:"booking-list"},ye={class:"booking-header"},Ve={class:"order-info"},ke={class:"order-no"},Ce={class:"order-time"},xe={class:"booking-content"},be={class:"venue-info"},we={class:"location"},Me={class:"booking-details"},ze={class:"detail-item"},Se={class:"detail-item"},Be={class:"detail-item"},Fe={class:"price-info"},Re={class:"price-value"},De={class:"booking-actions"},Le={class:"pay-amount"},Pe={__name:"List",setup(Ue){const I=de(),F=r(!1),M=r(""),R=r([]),d=N({page:1,pageSize:10,total:0}),g=r(!1),D=r(!1),m=r(null),y=N({paymentMethod:2}),V=r(!1),L=r(!1),f=N({cancelReason:""}),_=async()=>{F.value=!0;try{const n={page:d.page,pageSize:d.pageSize,status:M.value!==""?M.value:void 0},e=await me(n);R.value=e.data.records,d.total=e.data.total}catch(n){v.error(n.message||"获取预订列表失败")}finally{F.value=!1}},O=()=>{d.page=1,_()},Q=n=>({0:"warning",1:"success",2:"info",3:"success",4:"info",5:"danger"})[n]||"info",W=n=>({0:"待支付",1:"已支付",2:"已取消",3:"已完成",4:"已退款",5:"超时取消"})[n]||"未知",A=n=>{I.push(`/booking/detail/${n}`)},H=n=>{m.value=n,y.paymentMethod=2,g.value=!0},J=async()=>{D.value=!0;try{await fe(m.value.id,{paymentMethod:y.paymentMethod}),v.success("支付成功"),g.value=!1,_()}catch(n){v.error(n.message||"支付失败")}finally{D.value=!1}},K=n=>{m.value=n,f.cancelReason="",V.value=!0},X=async()=>{if(!f.cancelReason.trim()){v.warning("请输入取消原因");return}L.value=!0;try{await _e(m.value.id,{cancelReason:f.cancelReason}),v.success("取消成功"),V.value=!1,_()}catch(n){v.error(n.message||"取消失败")}finally{L.value=!1}};return le(()=>{_()}),(n,e)=>{const k=i("el-radio-button"),T=i("el-radio-group"),E=i("el-card"),Y=i("el-empty"),Z=i("el-tag"),j=i("el-divider"),z=i("el-icon"),c=i("el-button"),h=i("el-pagination"),P=i("el-form-item"),U=i("el-radio"),q=i("el-form"),G=i("el-dialog"),ee=i("el-input"),te=ne("loading");return p(),$("div",ve,[e[25]||(e[25]=o("h2",{class:"page-title"},"我的预订",-1)),a(E,{class:"filter-card"},{default:l(()=>[a(T,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=t=>M.value=t),onChange:O},{default:l(()=>[a(k,{label:""},{default:l(()=>[...e[9]||(e[9]=[s("全部",-1)])]),_:1}),a(k,{label:0},{default:l(()=>[...e[10]||(e[10]=[s("待支付",-1)])]),_:1}),a(k,{label:1},{default:l(()=>[...e[11]||(e[11]=[s("已支付",-1)])]),_:1}),a(k,{label:2},{default:l(()=>[...e[12]||(e[12]=[s("已取消",-1)])]),_:1}),a(k,{label:3},{default:l(()=>[...e[13]||(e[13]=[s("已完成",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),oe((p(),$("div",ge,[R.value.length===0?(p(),w(Y,{key:0,description:"暂无预订记录"})):S("",!0),(p(!0),$(se,null,ie(R.value,t=>(p(),w(E,{key:t.id,class:"booking-card"},{default:l(()=>{var C,x;return[o("div",ye,[o("div",Ve,[o("span",ke,"订单号: "+u(t.bookingNo),1),a(Z,{type:Q(t.status),size:"small"},{default:l(()=>[s(u(W(t.status)),1)]),_:2},1032,["type"])]),o("div",Ce,u(t.createTime),1)]),a(j),o("div",xe,[o("div",be,[o("h3",null,u(t.venueName),1),o("p",we,[a(z,null,{default:l(()=>[a(B(ue))]),_:1}),s(" "+u(t.venueLocation),1)])]),o("div",Me,[o("div",ze,[a(z,null,{default:l(()=>[a(B(re))]),_:1}),o("span",null,u(t.bookingDate),1)]),o("div",Se,[a(z,null,{default:l(()=>[a(B(pe))]),_:1}),o("span",null,u(t.timeSlot),1)]),o("div",Be,[a(z,null,{default:l(()=>[a(B(ce))]),_:1}),o("span",null,u(t.duration)+"小时",1)])]),o("div",Fe,[e[14]||(e[14]=o("div",{class:"price-label"},"实付金额",-1)),o("div",Re,"¥"+u(((C=t.actualPrice)==null?void 0:C.toFixed(2))||((x=t.totalPrice)==null?void 0:x.toFixed(2))),1)])]),a(j),o("div",De,[a(c,{type:"primary",link:"",onClick:b=>A(t.id)},{default:l(()=>[...e[15]||(e[15]=[s(" 查看详情 ",-1)])]),_:1},8,["onClick"]),t.status===0?(p(),w(c,{key:0,type:"success",onClick:b=>H(t)},{default:l(()=>[...e[16]||(e[16]=[s(" 立即支付 ",-1)])]),_:1},8,["onClick"])):S("",!0),t.status===0||t.status===1?(p(),w(c,{key:1,type:"danger",onClick:b=>K(t)},{default:l(()=>[...e[17]||(e[17]=[s(" 取消预订 ",-1)])]),_:1},8,["onClick"])):S("",!0)])]}),_:2},1024))),128))])),[[te,F.value]]),d.total>0?(p(),w(h,{key:0,"current-page":d.page,"onUpdate:currentPage":e[1]||(e[1]=t=>d.page=t),"page-size":d.pageSize,"onUpdate:pageSize":e[2]||(e[2]=t=>d.pageSize=t),total:d.total,"page-sizes":[5,10,20],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:_,onCurrentChange:_,class:"pagination"},null,8,["current-page","page-size","total"])):S("",!0),a(G,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=t=>g.value=t),title:"支付订单",width:"400px"},{footer:l(()=>[a(c,{onClick:e[4]||(e[4]=t=>g.value=!1)},{default:l(()=>[...e[21]||(e[21]=[s("取消",-1)])]),_:1}),a(c,{type:"primary",onClick:J,loading:D.value},{default:l(()=>[...e[22]||(e[22]=[s("确认支付",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(q,{model:y,"label-width":"100px"},{default:l(()=>[a(P,{label:"订单金额"},{default:l(()=>{var t,C,x,b;return[o("div",Le,"¥"+u(((C=(t=m.value)==null?void 0:t.actualPrice)==null?void 0:C.toFixed(2))||((b=(x=m.value)==null?void 0:x.totalPrice)==null?void 0:b.toFixed(2))),1)]}),_:1}),a(P,{label:"支付方式"},{default:l(()=>[a(T,{modelValue:y.paymentMethod,"onUpdate:modelValue":e[3]||(e[3]=t=>y.paymentMethod=t)},{default:l(()=>[a(U,{label:1},{default:l(()=>[...e[18]||(e[18]=[s("在线支付",-1)])]),_:1}),a(U,{label:2},{default:l(()=>[...e[19]||(e[19]=[s("余额支付",-1)])]),_:1}),a(U,{label:3},{default:l(()=>[...e[20]||(e[20]=[s("会员卡",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(G,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=t=>V.value=t),title:"取消预订",width:"400px"},{footer:l(()=>[a(c,{onClick:e[7]||(e[7]=t=>V.value=!1)},{default:l(()=>[...e[23]||(e[23]=[s("取消",-1)])]),_:1}),a(c,{type:"danger",onClick:X,loading:L.value},{default:l(()=>[...e[24]||(e[24]=[s("确认取消",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(q,{model:f,"label-width":"100px"},{default:l(()=>[a(P,{label:"取消原因",required:""},{default:l(()=>[a(ee,{modelValue:f.cancelReason,"onUpdate:modelValue":e[6]||(e[6]=t=>f.cancelReason=t),type:"textarea",rows:4,placeholder:"请输入取消原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ee=ae(Pe,[["__scopeId","data-v-6a11c256"]]);export{Ee as default};
