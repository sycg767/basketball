import{W as m,_ as S,r as p,w as N,v as q,d as x,o as w,al as A}from"./index-zUzrFZpX.js";function b(s){return m({url:`/api/payment/query/${s}`,method:"get"})}function k(s){return m({url:"/api/payment/wechat/native",method:"post",data:s})}function W(s){return m({url:"/api/payment/alipay/page",method:"post",data:s})}const B={class:"payment-status-poller"},F={__name:"PaymentStatusPoller",props:{paymentNo:{type:String,required:!0},queryFn:{type:Function,required:!0},interval:{type:Number,default:2e3},maxAttempts:{type:Number,default:30},autoStart:{type:Boolean,default:!1}},emits:["success","failed","timeout","error"],setup(s,{expose:v,emit:y}){const a=s,o=y,t=p(!1),n=p("pending"),r=p(0);let c=null;N(()=>a.paymentNo,e=>{e&&a.autoStart&&i()});const i=()=>{t.value||(t.value=!0,r.value=0,n.value="pending",d())},d=async()=>{if(!t.value||r.value>=a.maxAttempts){r.value>=a.maxAttempts&&P();return}r.value++;try{const e=await a.queryFn(a.paymentNo);if(e.code===200){const l=e.data.status;if(l===2){h(e.data);return}else if(l===3||l===4||l===5){_(e.data);return}}f()}catch(e){console.error("查询支付状态失败:",e),o("error",e),f()}},f=()=>{t.value&&(c=setTimeout(()=>{d()},a.interval))},h=e=>{n.value="success",t.value=!1,u(),o("success",e)},_=e=>{n.value="failed",t.value=!1,u(),o("failed",e)},P=()=>{n.value="timeout",t.value=!1,u(),o("timeout")},u=()=>{t.value=!1,c&&(clearTimeout(c),c=null)},g=()=>{u(),n.value="pending",r.value=0};return q(()=>{u()}),a.autoStart&&a.paymentNo&&i(),v({start:i,stop:u,reset:g,polling:t,status:n,attempts:r}),(e,l)=>(w(),x("div",B,[A(e.$slots,"default",{status:n.value,polling:t.value},void 0,!0)]))}},$=S(F,[["__scopeId","data-v-ed066845"]]);export{$ as P,W as a,k as c,b as q};
