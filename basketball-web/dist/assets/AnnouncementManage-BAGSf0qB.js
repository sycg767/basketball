import{r as T}from"./request-CITddpnx.js";import{aD as de,r as c,k as Q,t as me,d as q,e as t,a,f as r,E as i,a5 as ce,o as f,i as u,b as g,a4 as fe,c as k,v as b,g as U,D as B,_ as ve}from"./index-BU1z93KZ.js";const ge={class:"announcement-container"},ye={class:"header-content"},_e={key:0},be={class:"announcement-detail"},Ve={class:"announcement-meta"},ke={class:"view-count"},we=["innerHTML"],Te={class:"announcement-footer"},Ce={key:0},xe=de({__name:"AnnouncementManage",setup(ze){const $=c(!1),S=c(!1),w=c(!1),I=c(!1),C=c("create"),M=c(),v=Q({type:"",status:""}),o=Q({id:null,title:"",type:1,priority:0,targetType:1,isTop:!1,isPopup:!1,coverImage:"",content:"",expireTime:""}),W={title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],type:[{required:!0,message:"请选择公告类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],targetType:[{required:!0,message:"请选择目标对象",trigger:"change"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]},L=c([]),E=c(0),x=c(1),A=c(10),d=c(null),y=async()=>{$.value=!0;try{const n={current:x.value,size:A.value,type:v.type||void 0,status:v.status||void 0},e=await T.get("/api/admin/announcement/page",{params:n});e.code===200&&(L.value=e.data.records,E.value=e.data.total)}catch{i.error("获取公告列表失败")}$.value=!1},F=()=>{x.value=1,y()},X=()=>{v.type="",v.status="",F()},Y=()=>{C.value="create",o.id=null,Object.assign(o,{title:"",type:1,priority:0,targetType:1,isTop:!1,isPopup:!1,coverImage:"",content:"",expireTime:""}),w.value=!0},Z=n=>{C.value="edit",Object.assign(o,n),w.value=!0},ee=async n=>{try{const e=await T.get(`/api/admin/announcement/${n.id}`);e.code===200&&(d.value=e.data,I.value=!0)}catch{i.error("获取公告详情失败")}},te=async()=>{M.value&&await M.value.validate(async n=>{if(n){S.value=!0;try{const e=C.value==="create"?"/api/admin/announcement/create":"/api/admin/announcement/update",p=await T.post(e,o);p.code===200?(i.success(C.value==="create"?"创建成功":"更新成功"),w.value=!1,y()):i.error(p.message||"操作失败")}catch{i.error("保存失败")}S.value=!1}})},le=async n=>{try{await B.confirm("确定要发布此公告吗？","提示",{type:"warning"});const e=await T.post(`/api/admin/announcement/publish/${n.id}`);e.code===200?(i.success("发布公告成功"),y()):i.error(e.message||"发布失败")}catch(e){e!=="cancel"&&i.error("发布失败")}},ae=async n=>{try{await B.confirm("确定要下架此公告吗？","提示",{type:"warning"});const e=await T.post(`/api/admin/announcement/offline/${n.id}`);e.code===200?(i.success("下架公告成功"),y()):i.error(e.message||"下架失败")}catch(e){e!=="cancel"&&i.error("下架失败")}},ne=async n=>{try{await B.confirm("确定要删除此公告吗？","提示",{type:"warning"});const e=await T.delete(`/api/admin/announcement/${n.id}`);e.code===200?(i.success("删除成功"),y()):i.error(e.message||"删除失败")}catch(e){e!=="cancel"&&i.error("删除失败")}},N=n=>({1:"系统通知",2:"活动公告",3:"维护公告",4:"优惠活动"})[n]||"未知",R=n=>({1:"",2:"success",3:"warning",4:"danger"})[n]||"info",h=n=>({0:"草稿",1:"已发布",2:"已下架"})[n]||"未知",j=n=>({0:"info",1:"success",2:"danger"})[n]||"info",H=n=>n?new Date(n).toLocaleString():"",oe=n=>{A.value=n,y()},se=n=>{x.value=n,y()};return me(()=>{y()}),(n,e)=>{const p=r("el-button"),s=r("el-option"),z=r("el-select"),m=r("el-form-item"),O=r("el-form"),G=r("el-card"),_=r("el-table-column"),V=r("el-tag"),ue=r("el-table"),re=r("el-pagination"),P=r("el-input"),J=r("el-switch"),ie=r("el-date-picker"),K=r("el-dialog"),pe=ce("loading");return f(),q("div",ge,[t(G,{class:"page-header"},{header:a(()=>[g("div",ye,[e[17]||(e[17]=g("h2",null,"公告管理",-1)),t(p,{type:"primary",onClick:Y},{default:a(()=>[...e[16]||(e[16]=[u("创建公告",-1)])]),_:1})])]),default:a(()=>[t(O,{model:v,inline:""},{default:a(()=>[t(m,{label:"公告类型"},{default:a(()=>[t(z,{modelValue:v.type,"onUpdate:modelValue":e[0]||(e[0]=l=>v.type=l),placeholder:"请选择类型",clearable:""},{default:a(()=>[t(s,{label:"系统通知",value:1}),t(s,{label:"活动公告",value:2}),t(s,{label:"维护公告",value:3}),t(s,{label:"优惠活动",value:4})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:a(()=>[t(z,{modelValue:v.status,"onUpdate:modelValue":e[1]||(e[1]=l=>v.status=l),placeholder:"请选择状态",clearable:""},{default:a(()=>[t(s,{label:"草稿",value:0}),t(s,{label:"已发布",value:1}),t(s,{label:"已下架",value:2})]),_:1},8,["modelValue"])]),_:1}),t(m,null,{default:a(()=>[t(p,{type:"primary",onClick:F},{default:a(()=>[...e[18]||(e[18]=[u("搜索",-1)])]),_:1}),t(p,{onClick:X},{default:a(()=>[...e[19]||(e[19]=[u("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(G,{class:"content-card"},{default:a(()=>[fe((f(),k(ue,{data:L.value},{default:a(()=>[t(_,{prop:"id",label:"ID",width:"80"}),t(_,{prop:"title",label:"标题","min-width":"200"}),t(_,{prop:"type",label:"类型",width:"120"},{default:a(({row:l})=>[t(V,{type:R(l.type)},{default:a(()=>[u(b(N(l.type)),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:l})=>[l.priority===2?(f(),k(V,{key:0,type:"danger"},{default:a(()=>[...e[20]||(e[20]=[u("紧急",-1)])]),_:1})):l.priority===1?(f(),k(V,{key:1,type:"warning"},{default:a(()=>[...e[21]||(e[21]=[u("重要",-1)])]),_:1})):(f(),k(V,{key:2,type:"info"},{default:a(()=>[...e[22]||(e[22]=[u("普通",-1)])]),_:1}))]),_:1}),t(_,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(V,{type:j(l.status)},{default:a(()=>[u(b(h(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"viewCount",label:"浏览次数",width:"100"}),t(_,{prop:"publishTime",label:"发布时间",width:"180"}),t(_,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(p,{type:"primary",size:"small",onClick:D=>ee(l)},{default:a(()=>[...e[23]||(e[23]=[u("查看",-1)])]),_:1},8,["onClick"]),l.status===0?(f(),k(p,{key:0,type:"warning",size:"small",onClick:D=>Z(l)},{default:a(()=>[...e[24]||(e[24]=[u("编辑",-1)])]),_:1},8,["onClick"])):U("",!0),l.status===0?(f(),k(p,{key:1,type:"success",size:"small",onClick:D=>le(l)},{default:a(()=>[...e[25]||(e[25]=[u("发布",-1)])]),_:1},8,["onClick"])):U("",!0),l.status===1?(f(),k(p,{key:2,type:"info",size:"small",onClick:D=>ae(l)},{default:a(()=>[...e[26]||(e[26]=[u("下架",-1)])]),_:1},8,["onClick"])):U("",!0),t(p,{type:"danger",size:"small",onClick:D=>ne(l)},{default:a(()=>[...e[27]||(e[27]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[pe,$.value]]),t(re,{"current-page":x.value,"onUpdate:currentPage":e[2]||(e[2]=l=>x.value=l),"page-size":A.value,"onUpdate:pageSize":e[3]||(e[3]=l=>A.value=l),total:E.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:oe,onCurrentChange:se},null,8,["current-page","page-size","total"])]),_:1}),t(K,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=l=>w.value=l),title:C.value==="create"?"创建公告":"编辑公告",width:"800px"},{footer:a(()=>[t(p,{onClick:e[13]||(e[13]=l=>w.value=!1)},{default:a(()=>[...e[28]||(e[28]=[u("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:te,loading:S.value},{default:a(()=>[...e[29]||(e[29]=[u("保存",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(O,{ref_key:"announcementFormRef",ref:M,model:o,rules:W,"label-width":"100px"},{default:a(()=>[t(m,{label:"标题",prop:"title"},{default:a(()=>[t(P,{modelValue:o.title,"onUpdate:modelValue":e[4]||(e[4]=l=>o.title=l),placeholder:"请输入公告标题"},null,8,["modelValue"])]),_:1}),t(m,{label:"类型",prop:"type"},{default:a(()=>[t(z,{modelValue:o.type,"onUpdate:modelValue":e[5]||(e[5]=l=>o.type=l),placeholder:"请选择公告类型"},{default:a(()=>[t(s,{label:"系统通知",value:1}),t(s,{label:"活动公告",value:2}),t(s,{label:"维护公告",value:3}),t(s,{label:"优惠活动",value:4})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"优先级",prop:"priority"},{default:a(()=>[t(z,{modelValue:o.priority,"onUpdate:modelValue":e[6]||(e[6]=l=>o.priority=l),placeholder:"请选择优先级"},{default:a(()=>[t(s,{label:"普通",value:0}),t(s,{label:"重要",value:1}),t(s,{label:"紧急",value:2})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"目标对象",prop:"targetType"},{default:a(()=>[t(z,{modelValue:o.targetType,"onUpdate:modelValue":e[7]||(e[7]=l=>o.targetType=l),placeholder:"请选择目标对象"},{default:a(()=>[t(s,{label:"所有用户",value:1}),t(s,{label:"会员",value:2}),t(s,{label:"教练",value:3})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"是否置顶",prop:"isTop"},{default:a(()=>[t(J,{modelValue:o.isTop,"onUpdate:modelValue":e[8]||(e[8]=l=>o.isTop=l)},null,8,["modelValue"])]),_:1}),t(m,{label:"是否弹窗",prop:"isPopup"},{default:a(()=>[t(J,{modelValue:o.isPopup,"onUpdate:modelValue":e[9]||(e[9]=l=>o.isPopup=l)},null,8,["modelValue"])]),_:1}),t(m,{label:"封面图片",prop:"coverImage"},{default:a(()=>[t(P,{modelValue:o.coverImage,"onUpdate:modelValue":e[10]||(e[10]=l=>o.coverImage=l),placeholder:"请输入图片URL"},null,8,["modelValue"])]),_:1}),t(m,{label:"内容",prop:"content"},{default:a(()=>[t(P,{modelValue:o.content,"onUpdate:modelValue":e[11]||(e[11]=l=>o.content=l),type:"textarea",rows:6,placeholder:"请输入公告内容"},null,8,["modelValue"])]),_:1}),t(m,{label:"过期时间",prop:"expireTime"},{default:a(()=>[t(ie,{modelValue:o.expireTime,"onUpdate:modelValue":e[12]||(e[12]=l=>o.expireTime=l),type:"datetime",placeholder:"选择过期时间"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(K,{modelValue:I.value,"onUpdate:modelValue":e[15]||(e[15]=l=>I.value=l),title:"公告详情",width:"800px"},{default:a(()=>[d.value?(f(),q("div",_e,[g("div",be,[g("h3",null,b(d.value.title),1),g("div",Ve,[t(V,{type:R(d.value.type),size:"small"},{default:a(()=>[u(b(N(d.value.type)),1)]),_:1},8,["type"]),t(V,{type:j(d.value.status),size:"small",class:"ml-10"},{default:a(()=>[u(b(h(d.value.status)),1)]),_:1},8,["type"]),g("span",ke,"浏览次数: "+b(d.value.viewCount),1)]),g("div",{class:"announcement-content",innerHTML:d.value.content},null,8,we),g("div",Te,[g("p",null,"发布时间: "+b(H(d.value.publishTime)),1),d.value.expireTime?(f(),q("p",Ce," 过期时间: "+b(H(d.value.expireTime)),1)):U("",!0)])])])):U("",!0)]),_:1},8,["modelValue"])])}}}),De=ve(xe,[["__scopeId","data-v-92163fb6"]]);export{De as default};
