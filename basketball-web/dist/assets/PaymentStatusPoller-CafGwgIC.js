import{s as m}from"./request-fDvtbK_n.js";import{_ as S,r as p,w as N,p as q,d as x,o as w,a5 as A}from"./index-Do8XCnNk.js";function k(s){return m({url:`/api/payment/query/${s}`,method:"get"})}function $(s){return m({url:"/api/payment/wechat/native",method:"post",data:s})}function E(s){return m({url:"/api/payment/alipay/page",method:"post",data:s})}const B={class:"payment-status-poller"},F={__name:"PaymentStatusPoller",props:{paymentNo:{type:String,required:!0},queryFn:{type:Function,required:!0},interval:{type:Number,default:2e3},maxAttempts:{type:Number,default:30},autoStart:{type:Boolean,default:!1}},emits:["success","failed","timeout","error"],setup(s,{expose:v,emit:y}){const a=s,l=y,t=p(!1),r=p("pending"),n=p(0);let c=null;N(()=>a.paymentNo,e=>{e&&a.autoStart&&i()});const i=()=>{t.value||(t.value=!0,n.value=0,r.value="pending",d())},d=async()=>{if(!t.value||n.value>=a.maxAttempts){n.value>=a.maxAttempts&&P();return}n.value++;try{const e=await a.queryFn(a.paymentNo);if(e.code===200){const o=e.data.status;if(o===2){h(e.data);return}else if(o===3||o===4||o===5){_(e.data);return}}f()}catch(e){console.error("查询支付状态失败:",e),l("error",e),f()}},f=()=>{t.value&&(c=setTimeout(()=>{d()},a.interval))},h=e=>{r.value="success",t.value=!1,u(),l("success",e)},_=e=>{r.value="failed",t.value=!1,u(),l("failed",e)},P=()=>{r.value="timeout",t.value=!1,u(),l("timeout")},u=()=>{t.value=!1,c&&(clearTimeout(c),c=null)},g=()=>{u(),r.value="pending",n.value=0};return q(()=>{u()}),a.autoStart&&a.paymentNo&&i(),v({start:i,stop:u,reset:g,polling:t,status:r,attempts:n}),(e,o)=>(w(),x("div",B,[A(e.$slots,"default",{status:r.value,polling:t.value},void 0,!0)]))}},I=S(F,[["__scopeId","data-v-ed066845"]]);export{I as P,E as a,$ as c,k as q};
