import{i as B,L as F}from"./index-D5fw03LZ.js";import{_ as P,r as m,t as G,T as I,d as W,b as a,e,a as o,f as d,E as v,o as K,u as g,x as j,v as p,y as q,A as H,K as J,i as V}from"./index-BU1z93KZ.js";import{g as Q,a as X,b as Y,c as Z}from"./admin-zXaSWenD.js";const $={class:"dashboard-container"},tt={class:"stat-content"},et={class:"stat-icon"},st={class:"stat-info"},at={class:"stat-value"},ot={class:"stat-content"},lt={class:"stat-icon"},nt={class:"stat-info"},rt={class:"stat-value"},it={class:"stat-content"},dt={class:"stat-icon"},ct={class:"stat-info"},ut={class:"stat-value"},_t={class:"stat-content"},pt={class:"stat-icon"},ft={class:"stat-info"},mt={class:"stat-value"},vt={class:"chart-header"},gt={__name:"Dashboard",setup(ht){const f=m({totalVenues:0,totalUsers:0,totalBookings:0,totalRevenue:0}),x=m([]),h=m(7),b=m(null),y=m(null);let r=null,i=null;const z=async()=>{try{const s=await Q();f.value={totalVenues:s.data.totalVenues||0,totalUsers:s.data.totalUsers||0,totalBookings:s.data.totalBookings||0,totalRevenue:s.data.totalRevenue||0}}catch(s){v.error(s.message||"获取统计数据失败")}},N=async()=>{try{const s=await X(10);x.value=s.data.map(t=>({id:t.bookingNo,venueName:t.venueName,userName:t.realName||t.username,date:t.bookingDate,timeSlot:t.timeSlot,amount:t.actualPrice||t.totalPrice,status:t.status}))}catch(s){v.error(s.message||"获取最近预订失败")}},U=s=>({0:"warning",1:"success",2:"danger",3:"success",4:"info",5:"danger"})[s]||"info",L=s=>({0:"待支付",1:"已支付",2:"已取消",3:"已完成",4:"已退款",5:"超时取消"})[s]||"未知",T=()=>{if(!b.value)return;r=B(b.value);const s={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value",minInterval:1},series:[{name:"预订数量",type:"line",smooth:!0,areaStyle:{color:new F(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.5)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}])},lineStyle:{color:"#409EFF",width:3},itemStyle:{color:"#409EFF"},data:[]}]};r.setOption(s)},E=()=>{if(!y.value)return;i=B(y.value);const s={tooltip:{trigger:"item",formatter:"{b}: {c}% ({d}%)"},legend:{orient:"vertical",right:"10%",top:"center",formatter:t=>t.length>8?t.substring(0,8)+"...":t},series:[{name:"使用率",type:"pie",radius:["40%","70%"],center:["35%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:20,fontWeight:"bold",formatter:`{b}
{c}%`}},labelLine:{show:!1},data:[]}]};i.setOption(s)},k=async()=>{try{const s=await Y({days:h.value}),t=s.data.map(n=>n.date),l=s.data.map(n=>n.count);r&&r.setOption({xAxis:{data:t},series:[{data:l}]})}catch(s){v.error(s.message||"获取预订趋势失败")}},D=async()=>{try{const t=(await Z()).data.filter(l=>l.usageRate>0).map(l=>({name:l.venueName,value:l.usageRate}));i&&i.setOption({series:[{data:t}]})}catch(s){v.error(s.message||"获取场地使用率失败")}},M=()=>{k()},R=()=>{r==null||r.resize(),i==null||i.resize()};return G(()=>{z(),N(),T(),E(),k(),D(),window.addEventListener("resize",R)}),I(()=>{r==null||r.dispose(),i==null||i.dispose(),window.removeEventListener("resize",R)}),(s,t)=>{const l=d("el-icon"),n=d("el-card"),u=d("el-col"),S=d("el-row"),w=d("el-option"),C=d("el-select"),c=d("el-table-column"),O=d("el-tag"),A=d("el-table");return K(),W("div",$,[t[8]||(t[8]=a("h2",{class:"page-title"},"数据统计",-1)),e(S,{gutter:20,class:"stats-row"},{default:o(()=>[e(u,{xs:24,sm:12,md:6},{default:o(()=>[e(n,{class:"stat-card blue"},{default:o(()=>[a("div",tt,[a("div",et,[e(l,{size:32},{default:o(()=>[e(g(j))]),_:1})]),a("div",st,[a("p",at,p(f.value.totalVenues),1),t[1]||(t[1]=a("p",{class:"stat-label"},"场地总数",-1))])])]),_:1})]),_:1}),e(u,{xs:24,sm:12,md:6},{default:o(()=>[e(n,{class:"stat-card green"},{default:o(()=>[a("div",ot,[a("div",lt,[e(l,{size:32},{default:o(()=>[e(g(q))]),_:1})]),a("div",nt,[a("p",rt,p(f.value.totalUsers),1),t[2]||(t[2]=a("p",{class:"stat-label"},"注册用户",-1))])])]),_:1})]),_:1}),e(u,{xs:24,sm:12,md:6},{default:o(()=>[e(n,{class:"stat-card orange"},{default:o(()=>[a("div",it,[a("div",dt,[e(l,{size:32},{default:o(()=>[e(g(H))]),_:1})]),a("div",ct,[a("p",ut,p(f.value.totalBookings),1),t[3]||(t[3]=a("p",{class:"stat-label"},"预订总数",-1))])])]),_:1})]),_:1}),e(u,{xs:24,sm:12,md:6},{default:o(()=>[e(n,{class:"stat-card red"},{default:o(()=>[a("div",_t,[a("div",pt,[e(l,{size:32},{default:o(()=>[e(g(J))]),_:1})]),a("div",ft,[a("p",mt,"¥"+p(f.value.totalRevenue.toLocaleString()),1),t[4]||(t[4]=a("p",{class:"stat-label"},"总收入",-1))])])]),_:1})]),_:1})]),_:1}),e(S,{gutter:20,class:"charts-row"},{default:o(()=>[e(u,{xs:24,md:12},{default:o(()=>[e(n,null,{header:o(()=>[a("div",vt,[t[5]||(t[5]=a("span",null,"最近预订趋势",-1)),e(C,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=_=>h.value=_),onChange:M,size:"small",style:{width:"120px"}},{default:o(()=>[e(w,{label:"最近7天",value:7}),e(w,{label:"最近15天",value:15}),e(w,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:o(()=>[a("div",{ref_key:"trendChartRef",ref:b,class:"chart-container"},null,512)]),_:1})]),_:1}),e(u,{xs:24,md:12},{default:o(()=>[e(n,null,{header:o(()=>[...t[6]||(t[6]=[a("span",null,"场地使用率",-1)])]),default:o(()=>[a("div",{ref_key:"usageChartRef",ref:y,class:"chart-container"},null,512)]),_:1})]),_:1})]),_:1}),e(n,{class:"recent-bookings"},{header:o(()=>[...t[7]||(t[7]=[a("span",null,"最近预订",-1)])]),default:o(()=>[e(A,{data:x.value,stripe:""},{default:o(()=>[e(c,{prop:"id",label:"订单号",width:"120"}),e(c,{prop:"venueName",label:"场地名称"}),e(c,{prop:"userName",label:"用户"}),e(c,{prop:"date",label:"预订日期",width:"120"}),e(c,{prop:"timeSlot",label:"时间段",width:"120"}),e(c,{prop:"amount",label:"金额",width:"100"},{default:o(({row:_})=>[V(" ¥"+p(_.amount),1)]),_:1}),e(c,{prop:"status",label:"状态",width:"100"},{default:o(({row:_})=>[e(O,{type:U(_.status)},{default:o(()=>[V(p(L(_.status)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})])}}},xt=P(gt,[["__scopeId","data-v-29c60f8a"]]);export{xt as default};
