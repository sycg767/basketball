import{_ as K,r as d,k as L,a6 as O,$ as Y,t as Q,d as T,e as a,b as l,a as o,f as r,E as p,m as W,o as _,g as M,B as c,i as V,u as X,a1 as Z,c as q}from"./index-DU9PCbH8.js";import{a as ee}from"./venue-Br6zqmAS.js";import{b as te,d as ae}from"./booking-K964GJ6h.js";const le={class:"booking-create-container"},oe={class:"create-content"},ne={key:0,class:"venue-info"},se=["src"],re={class:"venue-details"},ie={class:"location"},ue={class:"price"},de={class:"price-value"},ce={key:0,class:"availability-tip"},me={class:"price-summary"},pe={class:"price-item"},_e={class:"price-item"},ve={class:"price-item total"},fe={class:"total-price"},ge={class:"action-buttons"},be={__name:"Create",setup(ke){const D=O(),g=W(),b=d(null),k=d(!1),i=d(null),v=d(!1),m=d(!1),w=d(!1),e=L({venueId:D.params.venueId,bookingDate:"",startTime:"",endTime:"",bookingType:1,contactName:"",contactPhone:"",peopleCount:1,remark:""}),R={bookingDate:[{required:!0,message:"请选择预订日期",trigger:"change"}],startTime:[{required:!0,message:"请选择开始时间",trigger:"change"}],endTime:[{required:!0,message:"请选择结束时间",trigger:"change"}],contactPhone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},C=Y(()=>{if(!e.startTime||!e.endTime)return 0;const n=new Date(`2000-01-01 ${e.startTime}`),f=(new Date(`2000-01-01 ${e.endTime}`)-n)/(1e3*60*60);return f>0?f:0}),$=Y(()=>{var n;return(n=i.value)!=null&&n.basePrice?C.value*i.value.basePrice:0}),A=n=>n<new Date(new Date().setHours(0,0,0,0)),y=async()=>{if(!e.bookingDate||!e.startTime||!e.endTime){v.value=!1;return}w.value=!0;try{const n=await te({venueId:e.venueId,bookingDate:e.bookingDate,startTime:e.startTime,endTime:e.endTime});m.value=n.data,v.value=!0}catch(n){p.error(n.message||"检查可用性失败"),m.value=!1,v.value=!1}finally{w.value=!1}},E=async()=>{try{const n=await ee(D.params.venueId);i.value=n.data}catch(n){p.error(n.message||"获取场地信息失败"),g.back()}},P=()=>{g.back()},z=async()=>{if(b.value)try{if(await b.value.validate(),!m.value){p.warning("该时段不可预订,请重新选择");return}k.value=!0;const n=await ae({venueId:parseInt(e.venueId),bookingDate:e.bookingDate,startTime:e.startTime,endTime:e.endTime,bookingType:e.bookingType,contactName:e.contactName,contactPhone:e.contactPhone,peopleCount:e.peopleCount,remark:e.remark});p.success("预订成功"),g.push(`/booking/detail/${n.data}`)}catch(n){p.error(n.message||"预订失败")}finally{k.value=!1}};return Q(()=>{E()}),(n,t)=>{const f=r("el-page-header"),F=r("el-icon"),N=r("el-card"),S=r("el-date-picker"),u=r("el-form-item"),x=r("el-time-select"),I=r("el-col"),j=r("el-row"),B=r("el-alert"),h=r("el-input"),H=r("el-input-number"),G=r("el-form"),U=r("el-button");return _(),T("div",le,[a(f,{onBack:P,title:"返回"},{content:o(()=>[...t[7]||(t[7]=[l("span",{class:"page-title"},"预订场地",-1)])]),_:1}),l("div",oe,[a(N,{class:"venue-card"},{header:o(()=>[...t[8]||(t[8]=[l("div",{class:"card-header"},[l("span",null,"场地信息")],-1)])]),default:o(()=>[i.value?(_(),T("div",ne,[l("img",{src:i.value.imageUrl||"/default-venue.jpg",alt:"场地图片",class:"venue-image"},null,8,se),l("div",re,[l("h2",null,c(i.value.venueName),1),l("p",ie,[a(F,null,{default:o(()=>[a(X(Z))]),_:1}),V(" "+c(i.value.location),1)]),l("p",ue,[t[9]||(t[9]=l("span",{class:"price-label"},"价格:",-1)),l("span",de,"¥"+c(i.value.basePrice)+"/小时",1)])])])):M("",!0)]),_:1}),a(N,{class:"form-card"},{header:o(()=>[...t[10]||(t[10]=[l("div",{class:"card-header"},[l("span",null,"预订信息")],-1)])]),default:o(()=>[a(G,{ref_key:"formRef",ref:b,model:e,rules:R,"label-width":"100px"},{default:o(()=>[a(u,{label:"预订日期",prop:"bookingDate",required:""},{default:o(()=>[a(S,{modelValue:e.bookingDate,"onUpdate:modelValue":t[0]||(t[0]=s=>e.bookingDate=s),type:"date",placeholder:"选择预订日期","disabled-date":A,format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},onChange:y},null,8,["modelValue"])]),_:1}),a(u,{label:"预订时段",required:""},{default:o(()=>[a(j,{gutter:16},{default:o(()=>[a(I,{span:12},{default:o(()=>[a(u,{prop:"startTime"},{default:o(()=>[a(x,{modelValue:e.startTime,"onUpdate:modelValue":t[1]||(t[1]=s=>e.startTime=s),placeholder:"开始时间",start:"06:00",end:"22:00",step:"01:00",onChange:y,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),a(I,{span:12},{default:o(()=>[a(u,{prop:"endTime"},{default:o(()=>[a(x,{modelValue:e.endTime,"onUpdate:modelValue":t[2]||(t[2]=s=>e.endTime=s),placeholder:"结束时间",start:"07:00",end:"23:00",step:"01:00","min-time":e.startTime,onChange:y,style:{width:"100%"}},null,8,["modelValue","min-time"])]),_:1})]),_:1})]),_:1}),v.value?(_(),T("div",ce,[m.value?(_(),q(B,{key:0,title:"该时段可预订",type:"success",closable:!1,"show-icon":""})):(_(),q(B,{key:1,title:"该时段已被预订,请选择其他时间",type:"error",closable:!1,"show-icon":""}))])):M("",!0)]),_:1}),a(u,{label:"联系人",prop:"contactName"},{default:o(()=>[a(h,{modelValue:e.contactName,"onUpdate:modelValue":t[3]||(t[3]=s=>e.contactName=s),placeholder:"请输入联系人姓名"},null,8,["modelValue"])]),_:1}),a(u,{label:"联系电话",prop:"contactPhone"},{default:o(()=>[a(h,{modelValue:e.contactPhone,"onUpdate:modelValue":t[4]||(t[4]=s=>e.contactPhone=s),placeholder:"请输入联系电话"},null,8,["modelValue"])]),_:1}),a(u,{label:"人数",prop:"peopleCount"},{default:o(()=>{var s;return[a(H,{modelValue:e.peopleCount,"onUpdate:modelValue":t[5]||(t[5]=J=>e.peopleCount=J),min:1,max:((s=i.value)==null?void 0:s.capacity)||100,placeholder:"请输入人数"},null,8,["modelValue","max"])]}),_:1}),a(u,{label:"备注",prop:"remark"},{default:o(()=>[a(h,{modelValue:e.remark,"onUpdate:modelValue":t[6]||(t[6]=s=>e.remark=s),type:"textarea",rows:4,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1}),a(u,{label:"预计费用"},{default:o(()=>{var s;return[l("div",me,[l("div",pe,[t[11]||(t[11]=l("span",null,"时长:",-1)),l("span",null,c(C.value)+" 小时",1)]),l("div",_e,[t[12]||(t[12]=l("span",null,"单价:",-1)),l("span",null,"¥"+c(((s=i.value)==null?void 0:s.basePrice)||0)+"/小时",1)]),l("div",ve,[t[13]||(t[13]=l("span",null,"总计:",-1)),l("span",fe,"¥"+c($.value.toFixed(2)),1)])])]}),_:1})]),_:1},8,["model"])]),_:1}),l("div",ge,[a(U,{onClick:P,size:"large"},{default:o(()=>[...t[14]||(t[14]=[V("取消",-1)])]),_:1}),a(U,{type:"primary",size:"large",onClick:z,loading:k.value,disabled:!m.value},{default:o(()=>[...t[15]||(t[15]=[V(" 确认预订 ",-1)])]),_:1},8,["loading","disabled"])])])])}}},Ve=K(be,[["__scopeId","data-v-8da4c344"]]);export{Ve as default};
