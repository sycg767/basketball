import{i as H}from"./index-D5fw03LZ.js";import{r as f,t as M,M as F,w as G,d as P,o as z,an as X,X as T,_ as E,E as L,f as g,a5 as W,e,a,b as m,v as R,c as O,g as B,a4 as $,i as N}from"./index-DqRIPXSt.js";const J={__name:"LineChart",props:{width:{type:String,default:"100%"},height:{type:String,default:"400px"},data:{type:Object,required:!0},title:{type:String,default:""},yAxisName:{type:String,default:""},smooth:{type:Boolean,default:!0},showArea:{type:Boolean,default:!1}},setup(d,{expose:b}){const t=d,p=f(null);let i=null;M(()=>{h(),window.addEventListener("resize",w)}),F(()=>{i&&(i.dispose(),i=null),window.removeEventListener("resize",w)}),G(()=>t.data,()=>{S()},{deep:!0});const h=()=>{if(!p.value)return;const v=()=>{p.value&&p.value.clientWidth>0?(i=H(p.value),S()):setTimeout(v,50)};setTimeout(v,0)},S=()=>{var c;if(!i||!t.data)return;const v={title:{text:t.title,left:"center",textStyle:{fontSize:16,fontWeight:500}},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{top:t.title?35:10,data:((c=t.data.series)==null?void 0:c.map(n=>n.name))||[]},grid:{left:10,right:10,bottom:10,top:t.title?70:50,containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t.data.xAxisData||[]},yAxis:{type:"value",name:t.yAxisName},series:(t.data.series||[]).map(n=>({name:n.name,type:"line",smooth:t.smooth,data:n.data,areaStyle:t.showArea?{}:void 0}))};i.setOption(v,!0)},w=()=>{i&&i.resize()};return b({resize:w}),(v,c)=>(z(),P("div",{ref_key:"chartRef",ref:p,style:X({width:d.width,height:d.height})},null,4))}};function ae(d){return T({url:"/api/admin/analytics/member/activity-trend",method:"get",params:d})}function j(d){return T({url:"/api/admin/analytics/member/active-users",method:"get",params:d})}function le(d){return T({url:"/api/admin/analytics/member/inactive-users",method:"get",params:d})}function q(d){return T({url:"/api/admin/analytics/member/churn-risk",method:"get",params:d})}function oe(d){return T({url:"/api/admin/analytics/course/popularity-ranking",method:"get",params:d})}function ne(d){return T({url:"/api/admin/analytics/course/hot-courses",method:"get",params:d})}function se(d){return T({url:"/api/admin/analytics/course/cold-courses",method:"get",params:d})}function re(d){return T({url:"/api/admin/analytics/venue/usage-ranking",method:"get",params:d})}function ie(d){return T({url:"/api/admin/analytics/venue/revenue-analysis",method:"get",params:d})}function de(d){return T({url:"/api/admin/analytics/venue/peak-period",method:"get",params:d})}const ce={class:"member-analysis-container"},ue={class:"stat-content"},pe={class:"stat-info"},ge={class:"stat-value"},me={class:"stat-content"},ve={class:"stat-info"},_e={class:"stat-value green"},fe={class:"stat-content"},he={class:"stat-info"},ye={class:"stat-value red"},De={class:"card-header"},be={class:"card-header"},xe={class:"pagination-container"},Se={__name:"MemberAnalysis",setup(d){const b=f(0),t=f(0),p=f(0),i=f(7),h=f("active"),S=f(!1),w=f([]),v=f(1),c=f(10),n=f(0),l=f({xAxisData:[],series:[]});M(()=>{r(),s(),y()});const r=async()=>{var x;try{const o=new Date,D=new Date;D.setDate(D.getDate()-i.value),console.log("👥 [会员活跃度趋势] 请求参数:",{startDate:D.toISOString().split("T")[0],endDate:o.toISOString().split("T")[0]});const u=await ae({startDate:D.toISOString().split("T")[0],endDate:o.toISOString().split("T")[0]});console.log("👥 [会员活跃度趋势] 响应数据:",u),console.log("👥 [会员活跃度趋势] 数据长度:",(x=u.data)==null?void 0:x.length),console.log("👥 [会员活跃度趋势] 数据内容:",u.data),u.code===200&&u.data&&u.data.length>0?(l.value={xAxisData:u.data.map(_=>_.date||_.analysisDate),series:[{name:"活跃用户数",data:u.data.map(_=>_.activeUserCount||_.totalLoginCount||_.loginCount||_.activeCount||0)}]},console.log("✅ [会员活跃度趋势] 图表数据已设置:",l.value)):console.warn("⚠️ [会员活跃度趋势] 无数据或数据为空")}catch(o){console.error("❌ [会员活跃度趋势] 获取失败:",o),L.error("获取活跃度趋势失败")}},s=async()=>{var x,o,D,u;S.value=!0;try{let _;const A={page:v.value,size:c.value};console.log("📋 [会员列表] 请求参数:",{listType:h.value,...A}),h.value==="active"?_=await j(A):h.value==="inactive"?_=await le(A):_=await q(A),console.log("📋 [会员列表] 响应数据:",_),console.log("📋 [会员列表] 数据长度:",((o=(x=_.data)==null?void 0:x.records)==null?void 0:o.length)||((D=_.data)==null?void 0:D.length)),_.code===200&&(w.value=_.data.records||_.data||[],n.value=_.data.total||((u=_.data)==null?void 0:u.length)||0,console.log("✅ [会员列表] 列表数据已设置:",{count:w.value.length,total:n.value}))}catch{L.error("获取会员列表失败")}finally{S.value=!1}},y=async()=>{var x,o,D,u,_,A;try{console.log("📊 [会员统计] 开始获取统计数据...");const[I,V]=await Promise.all([j({page:1,size:1}),q({page:1,size:1})]);console.log("📊 [会员统计] 活跃用户响应:",I),console.log("📊 [会员统计] 流失风险响应:",V),b.value=((x=I.data)==null?void 0:x.total)||((o=I.data)==null?void 0:o.length)||0,t.value=((D=I.data)==null?void 0:D.total)||((u=I.data)==null?void 0:u.length)||0,p.value=((_=V.data)==null?void 0:_.total)||((A=V.data)==null?void 0:A.length)||0,console.log("✅ [会员统计] 统计数据已设置:",{totalMembers:b.value,activeMembers:t.value,churnRiskMembers:p.value})}catch(I){console.error("❌ [会员统计] 获取失败:",I)}},k=x=>x>=80?"success":x>=60?"info":x>=40?"warning":"danger";return(x,o)=>{const D=g("el-card"),u=g("el-col"),_=g("el-row"),A=g("el-option"),I=g("el-select"),V=g("el-radio-button"),Q=g("el-radio-group"),U=g("el-table-column"),Y=g("el-tag"),Z=g("el-table"),ee=g("el-pagination"),te=W("loading");return z(),P("div",ce,[e(_,{gutter:20,class:"stats-row"},{default:a(()=>[e(u,{xs:24,sm:8},{default:a(()=>[e(D,{class:"stat-card"},{default:a(()=>[m("div",ue,[m("div",pe,[o[4]||(o[4]=m("p",{class:"stat-label"},"总会员数",-1)),m("p",ge,R(b.value),1)])])]),_:1})]),_:1}),e(u,{xs:24,sm:8},{default:a(()=>[e(D,{class:"stat-card"},{default:a(()=>[m("div",me,[m("div",ve,[o[5]||(o[5]=m("p",{class:"stat-label"},"活跃会员",-1)),m("p",_e,R(t.value),1)])])]),_:1})]),_:1}),e(u,{xs:24,sm:8},{default:a(()=>[e(D,{class:"stat-card"},{default:a(()=>[m("div",fe,[m("div",he,[o[6]||(o[6]=m("p",{class:"stat-label"},"流失风险",-1)),m("p",ye,R(p.value),1)])])]),_:1})]),_:1})]),_:1}),e(D,{class:"chart-card"},{header:a(()=>[m("div",De,[o[7]||(o[7]=m("span",null,"会员活跃度趋势",-1)),e(I,{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=C=>i.value=C),onChange:r,size:"small",style:{width:"120px"}},{default:a(()=>[e(A,{label:"最近7天",value:7}),e(A,{label:"最近15天",value:15}),e(A,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:a(()=>[l.value.xAxisData?(z(),O(J,{key:0,data:l.value,height:"350px","y-axis-name":"活跃度","show-area":!0},null,8,["data"])):B("",!0)]),_:1}),e(D,null,{header:a(()=>[m("div",be,[o[11]||(o[11]=m("span",null,"会员列表",-1)),e(Q,{modelValue:h.value,"onUpdate:modelValue":o[1]||(o[1]=C=>h.value=C),onChange:s,size:"small"},{default:a(()=>[e(V,{value:"active"},{default:a(()=>[...o[8]||(o[8]=[N("活跃用户",-1)])]),_:1}),e(V,{value:"inactive"},{default:a(()=>[...o[9]||(o[9]=[N("不活跃用户",-1)])]),_:1}),e(V,{value:"churn"},{default:a(()=>[...o[10]||(o[10]=[N("流失风险",-1)])]),_:1})]),_:1},8,["modelValue"])])]),default:a(()=>[$((z(),O(Z,{data:w.value,stripe:""},{default:a(()=>[e(U,{prop:"userId",label:"用户ID",width:"100"}),e(U,{prop:"username",label:"用户名"}),e(U,{prop:"realName",label:"真实姓名"}),e(U,{prop:"activityScore",label:"活跃度",width:"100"},{default:a(({row:C})=>[e(Y,{type:k(C.activityScore)},{default:a(()=>[N(R(C.activityScore),1)]),_:2},1032,["type"])]),_:1}),e(U,{prop:"lastActiveTime",label:"最后活跃",width:"180"})]),_:1},8,["data"])),[[te,S.value]]),m("div",xe,[e(ee,{"current-page":v.value,"onUpdate:currentPage":o[2]||(o[2]=C=>v.value=C),"page-size":c.value,"onUpdate:pageSize":o[3]||(o[3]=C=>c.value=C),total:n.value,layout:"total, prev, pager, next",onCurrentChange:s},null,8,["current-page","page-size","total"])])]),_:1})])}}},we=E(Se,[["__scopeId","data-v-4964a8cc"]]),K={__name:"BarChart",props:{width:{type:String,default:"100%"},height:{type:String,default:"400px"},data:{type:Object,required:!0},title:{type:String,default:""},yAxisName:{type:String,default:""},horizontal:{type:Boolean,default:!1},stack:{type:Boolean,default:!1}},setup(d,{expose:b}){const t=d,p=f(null);let i=null;M(()=>{h(),window.addEventListener("resize",w)}),F(()=>{i&&(i.dispose(),i=null),window.removeEventListener("resize",w)}),G(()=>t.data,()=>{S()},{deep:!0});const h=()=>{if(!p.value)return;const v=()=>{p.value&&p.value.clientWidth>0?(i=H(p.value),S()):setTimeout(v,50)};setTimeout(v,0)},S=()=>{var c;if(!i||!t.data)return;const v={title:{text:t.title,left:"center",textStyle:{fontSize:16,fontWeight:500}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{top:t.title?35:10,data:((c=t.data.series)==null?void 0:c.map(n=>n.name))||[]},grid:{left:t.horizontal?10:60,right:t.horizontal?10:50,bottom:t.horizontal?10:60,top:t.title?70:50,containLabel:!0},xAxis:{type:t.horizontal?"value":"category",data:t.horizontal?void 0:t.data.xAxisData||[],name:t.horizontal?t.yAxisName:""},yAxis:{type:t.horizontal?"category":"value",data:t.horizontal?t.data.xAxisData||[]:void 0,name:t.horizontal?"":t.yAxisName,axisLabel:t.horizontal?{interval:0,fontSize:13}:void 0,inverse:!!t.horizontal},series:(t.data.series||[]).map(n=>({name:n.name,type:"bar",data:n.data,stack:t.stack?"total":void 0,barWidth:t.horizontal?16:void 0,label:{show:t.horizontal,position:t.horizontal?"right":"top",fontSize:12},emphasis:{label:{show:!0,position:t.horizontal?"right":"top"}}}))};i.setOption(v,!0)},w=()=>{i&&i.resize()};return b({resize:w}),(v,c)=>(z(),P("div",{ref_key:"chartRef",ref:p,style:X({width:d.width,height:d.height})},null,4))}},ze={class:"course-analysis-container"},Ae={class:"card-header"},Ce={__name:"CourseAnalysis",setup(d){const b=f(7),t=f(!1),p=f([]),i=f([]),h=f({xAxisData:[],series:[]});M(()=>{S(),w()});const S=async()=>{var v;t.value=!0;try{const c=new Date,n=new Date;n.setDate(n.getDate()-b.value),console.log("📊 [课程热度] 请求参数:",{startDate:n.toISOString().split("T")[0],endDate:c.toISOString().split("T")[0],limit:10});const l=await oe({startDate:n.toISOString().split("T")[0],endDate:c.toISOString().split("T")[0],limit:10});console.log("📊 [课程热度] 响应数据:",l),console.log("📊 [课程热度] 数据长度:",(v=l.data)==null?void 0:v.length),console.log("📊 [课程热度] 数据内容:",l.data),l.code===200&&l.data&&l.data.length>0?(h.value={xAxisData:l.data.map(r=>r.courseName),series:[{name:"热度分数",data:l.data.map(r=>r.avgPopularityScore||r.popularityScore||r.score||0)}]},console.log("✅ [课程热度] 图表数据已设置:",h.value)):console.warn("⚠️ [课程热度] 无数据或数据为空")}catch(c){console.error("❌ [课程热度] 获取失败:",c),L.error("获取课程排行榜失败")}finally{t.value=!1}},w=async()=>{try{const v=new Date,c=new Date;c.setDate(c.getDate()-30);const n={startDate:c.toISOString().split("T")[0],endDate:v.toISOString().split("T")[0],limit:5},[l,r]=await Promise.all([ne(n),se(n)]);l.code===200&&(p.value=l.data||[]),r.code===200&&(i.value=r.data||[])}catch(v){console.error("获取热门/冷门课程失败:",v)}};return(v,c)=>{const n=g("el-option"),l=g("el-select"),r=g("el-card"),s=g("el-table-column"),y=g("el-tag"),k=g("el-table"),x=g("el-col"),o=g("el-row"),D=W("loading");return z(),P("div",ze,[e(r,null,{header:a(()=>[m("div",Ae,[c[1]||(c[1]=m("span",null,"课程热度排行榜",-1)),e(l,{modelValue:b.value,"onUpdate:modelValue":c[0]||(c[0]=u=>b.value=u),onChange:S,size:"small",style:{width:"120px"}},{default:a(()=>[e(n,{label:"最近7天",value:7}),e(n,{label:"最近15天",value:15}),e(n,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:a(()=>[h.value.xAxisData?(z(),O(K,{key:0,data:h.value,height:"400px","y-axis-name":"热度分数",horizontal:!0},null,8,["data"])):B("",!0)]),_:1}),e(o,{gutter:20,class:"course-lists"},{default:a(()=>[e(x,{xs:24,sm:12},{default:a(()=>[e(r,null,{header:a(()=>[...c[2]||(c[2]=[m("span",null,"热门课程",-1)])]),default:a(()=>[$((z(),O(k,{data:p.value,stripe:""},{default:a(()=>[e(s,{prop:"courseName",label:"课程名称"}),e(s,{prop:"popularityScore",label:"热度",width:"100"},{default:a(({row:u})=>[e(y,{type:"success"},{default:a(()=>[N(R(u.popularityScore),1)]),_:2},1024)]),_:1}),e(s,{prop:"enrollCount",label:"报名数",width:"100"})]),_:1},8,["data"])),[[D,t.value]])]),_:1})]),_:1}),e(x,{xs:24,sm:12},{default:a(()=>[e(r,null,{header:a(()=>[...c[3]||(c[3]=[m("span",null,"冷门课程",-1)])]),default:a(()=>[$((z(),O(k,{data:i.value,stripe:""},{default:a(()=>[e(s,{prop:"courseName",label:"课程名称"}),e(s,{prop:"popularityScore",label:"热度",width:"100"},{default:a(({row:u})=>[e(y,{type:"warning"},{default:a(()=>[N(R(u.popularityScore),1)]),_:2},1024)]),_:1}),e(s,{prop:"enrollCount",label:"报名数",width:"100"})]),_:1},8,["data"])),[[D,t.value]])]),_:1})]),_:1})]),_:1})])}}},Te=E(Ce,[["__scopeId","data-v-c2b2fb1d"]]),Ie={class:"venue-analysis-container"},ke={class:"card-header"},Oe={__name:"VenueAnalysis",setup(d){const b=f(7),t=f(!1),p=f([]),i=f({xAxisData:[],series:[]}),h=f({xAxisData:[],series:[]});M(()=>{S(),w(),v()});const S=async()=>{var n;t.value=!0;try{const l=new Date,r=new Date;r.setDate(r.getDate()-b.value),console.log("🏀 [场地使用率] 请求参数:",{startDate:r.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],limit:10});const s=await re({startDate:r.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0],limit:10});console.log("🏀 [场地使用率] 响应数据:",s),console.log("🏀 [场地使用率] 数据长度:",(n=s.data)==null?void 0:n.length),console.log("🏀 [场地使用率] 数据内容:",s.data),s.code===200&&s.data&&s.data.length>0?(i.value={xAxisData:s.data.map(y=>y.venueName),series:[{name:"使用率",data:s.data.map(y=>y.avgUsageRate||y.usageRate||y.rate||0)}]},console.log("✅ [场地使用率] 图表数据已设置:",i.value)):console.warn("⚠️ [场地使用率] 无数据或数据为空")}catch(l){console.error("❌ [场地使用率] 获取失败:",l),L.error("获取场地排行榜失败")}finally{t.value=!1}},w=async()=>{var n;try{const l=new Date,r=new Date;r.setDate(r.getDate()-30),console.log("💰 [场地收入] 请求参数:",{startDate:r.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0]});const s=await ie({startDate:r.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0]});console.log("💰 [场地收入] 响应数据:",s),console.log("💰 [场地收入] 数据长度:",(n=s.data)==null?void 0:n.length),console.log("💰 [场地收入] 数据内容:",s.data),s.code===200&&s.data&&s.data.length>0?(h.value={xAxisData:s.data.map(y=>y.venueName||y.analysisDate||y.date),series:[{name:"总收入",data:s.data.map(y=>y.totalRevenue||y.revenue||0)}]},console.log("✅ [场地收入] 图表数据已设置:",h.value)):console.warn("⚠️ [场地收入] 无数据或数据为空")}catch(l){console.error("获取收入分析失败:",l)}},v=async()=>{var n;try{const l=new Date,r=new Date;r.setDate(r.getDate()-7),console.log("⏰ [高峰时段] 请求参数:",{startDate:r.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0]});const s=await de({startDate:r.toISOString().split("T")[0],endDate:l.toISOString().split("T")[0]});console.log("⏰ [高峰时段] 响应数据:",s),console.log("⏰ [高峰时段] 数据长度:",(n=s.data)==null?void 0:n.length),console.log("⏰ [高峰时段] 数据内容:",s.data),s.code===200&&s.data?(p.value=s.data||[],console.log("✅ [高峰时段] 数据已设置:",p.value)):console.warn("⚠️ [高峰时段] 无数据或数据为空")}catch(l){console.error("❌ [高峰时段] 获取失败:",l)}},c=n=>n>=80?"#67C23A":n>=60?"#E6A23C":"#F56C6C";return(n,l)=>{const r=g("el-option"),s=g("el-select"),y=g("el-card"),k=g("el-table-column"),x=g("el-progress"),o=g("el-table"),D=W("loading");return z(),P("div",Ie,[e(y,null,{header:a(()=>[m("div",ke,[l[1]||(l[1]=m("span",null,"场地使用率排行",-1)),e(s,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=u=>b.value=u),onChange:S,size:"small",style:{width:"120px"}},{default:a(()=>[e(r,{label:"最近7天",value:7}),e(r,{label:"最近15天",value:15}),e(r,{label:"最近30天",value:30})]),_:1},8,["modelValue"])])]),default:a(()=>[i.value.xAxisData?(z(),O(K,{key:0,data:i.value,height:"400px","y-axis-name":"使用率(%)",horizontal:!0},null,8,["data"])):B("",!0)]),_:1}),e(y,{class:"revenue-card"},{header:a(()=>[...l[2]||(l[2]=[m("span",null,"场地收入分析",-1)])]),default:a(()=>[h.value.xAxisData?(z(),O(J,{key:0,data:h.value,height:"350px","y-axis-name":"收入(元)","show-area":!0},null,8,["data"])):B("",!0)]),_:1}),e(y,null,{header:a(()=>[...l[3]||(l[3]=[m("span",null,"高峰时段分布",-1)])]),default:a(()=>[$((z(),O(o,{data:p.value,stripe:""},{default:a(()=>[e(k,{prop:"periodName",label:"时段",width:"200"}),e(k,{prop:"bookingCount",label:"预订次数",width:"120"}),e(k,{prop:"percentage",label:"占比",width:"200"},{default:a(({row:u})=>[e(x,{percentage:u.percentage,color:c(u.percentage)},null,8,["percentage","color"])]),_:1})]),_:1},8,["data"])),[[D,t.value]])]),_:1})])}}},Ve=E(Oe,[["__scopeId","data-v-319cce7c"]]),Re={class:"data-analysis-container"},Ne={__name:"DataAnalysis",setup(d){const b=f("member");return(t,p)=>{const i=g("el-tab-pane"),h=g("el-tabs");return z(),P("div",Re,[p[1]||(p[1]=m("h2",{class:"page-title"},"数据分析",-1)),e(h,{modelValue:b.value,"onUpdate:modelValue":p[0]||(p[0]=S=>b.value=S),type:"card",class:"analysis-tabs"},{default:a(()=>[e(i,{label:"会员活跃度",name:"member"},{default:a(()=>[e(we)]),_:1}),e(i,{label:"课程热度",name:"course"},{default:a(()=>[e(Te)]),_:1}),e(i,{label:"场地使用",name:"venue"},{default:a(()=>[e(Ve)]),_:1})]),_:1},8,["modelValue"])])}}},Me=E(Ne,[["__scopeId","data-v-30a443b7"]]);export{Me as default};
