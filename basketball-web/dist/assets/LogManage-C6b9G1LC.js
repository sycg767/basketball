import{aF as _e,r as g,k as E,a0 as me,t as fe,d as te,e,c as v,g as b,a as l,f as p,E as j,a4 as ae,i as n,a5 as ge,v as u,b as s,u as O,al as oe,ao as se,o as m,_ as ve}from"./index-DqRIPXSt.js";import{r as R}from"./request-6I7FbxP_.js";const be={class:"log-container"},ye={class:"header-content"},Ve={class:"header-content"},we={class:"stat-content"},he={class:"stat-icon success"},ke={class:"stat-info"},Ce={class:"stat-value"},De={class:"stat-content"},Ie={class:"stat-icon danger"},Le={class:"stat-info"},ze={class:"stat-value"},xe={class:"stat-content"},Te={class:"stat-icon success"},Ue={class:"stat-info"},Se={class:"stat-value"},Me={class:"stat-content"},Oe={class:"stat-icon danger"},Re={class:"stat-info"},Ye={class:"stat-value"},Pe={key:0},Be={class:"log-content"},Ne={class:"log-content"},$e=_e({__name:"LogManage",setup(Ee){const _=g("login"),L=g(!1),Y=g(!1),F=g("日志详情"),o=E({userId:"",username:"",status:"",operation:"",dateRange:[]}),P=g([]),B=g([]),N=g(0),y=g(1),h=g(10),i=g(null),z=E({successfulLogins:0,failedLogins:0}),x=E({successfulOperations:0,failedOperations:0});me(()=>_.value==="login"?P.value:B.value);const C=async()=>{L.value=!0;try{const r={current:y.value,size:h.value,...o},t=_.value==="login"?"/api/login-log/page":"/api/operation-log/page",V=await R.get(t,{params:r});if(V.code===200){const D=V.data;_.value==="login"?P.value=D.records:B.value=D.records,N.value=D.total}}catch{j.error("获取日志列表失败")}L.value=!1},ne=async()=>{try{const r=await R.get("/api/login-log/statistics");r.code===200&&(z.successfulLogins=r.data.successfulLogins,z.failedLogins=r.data.failedLogins);const t=await R.get("/api/operation-log/statistics");t.code===200&&(x.successfulOperations=t.data.successfulOperations,x.failedOperations=t.data.failedOperations)}catch(r){console.error("获取日志统计失败:",r)}},de=()=>{y.value=1,C()},$=()=>{y.value=1,C()},q=()=>{o.userId="",o.username="",o.status="",o.operation="",o.dateRange=[],$()},A=async r=>{try{const t=_.value==="login"?"/api/login-log":"/api/operation-log",V=await R.get(`${t}/${r.id}`);V.code===200&&(i.value=V.data,F.value=_.value==="login"?"登录日志详情":"操作日志详情",Y.value=!0)}catch{j.error("获取日志详情失败")}},G=()=>{j.success("导出功能开发中...")},H=r=>({1:"账号密码",2:"手机验证码",3:"第三方登录"})[r]||"未知",ue=r=>r?new Date(r).toLocaleString():"",J=r=>{h.value=r,C()},K=r=>{y.value=r,C()};return fe(()=>{C(),ne()}),(r,t)=>{const V=p("el-tab-pane"),D=p("el-tabs"),w=p("el-button"),I=p("el-input"),f=p("el-form-item"),T=p("el-option"),Q=p("el-select"),W=p("el-date-picker"),X=p("el-form"),d=p("el-table-column"),U=p("el-tag"),Z=p("el-table"),ee=p("el-pagination"),k=p("el-card"),S=p("el-icon"),M=p("el-col"),ie=p("el-row"),c=p("el-descriptions-item"),re=p("el-descriptions"),pe=p("el-dialog"),le=ge("loading");return m(),te("div",be,[e(D,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),onTabClick:de},{default:l(()=>[e(V,{label:"登录日志",name:"login"}),e(V,{label:"操作日志",name:"operation"})]),_:1},8,["modelValue"]),_.value==="login"?(m(),v(k,{key:0,class:"content-card"},{header:l(()=>[s("div",ye,[t[16]||(t[16]=s("h3",null,"登录日志管理",-1)),e(w,{type:"primary",onClick:G},{default:l(()=>[...t[15]||(t[15]=[n("导出日志",-1)])]),_:1})])]),default:l(()=>[e(X,{model:o,inline:""},{default:l(()=>[e(f,{label:"用户ID"},{default:l(()=>[e(I,{modelValue:o.userId,"onUpdate:modelValue":t[1]||(t[1]=a=>o.userId=a),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"用户名"},{default:l(()=>[e(I,{modelValue:o.username,"onUpdate:modelValue":t[2]||(t[2]=a=>o.username=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"登录状态"},{default:l(()=>[e(Q,{modelValue:o.status,"onUpdate:modelValue":t[3]||(t[3]=a=>o.status=a),placeholder:"请选择状态",clearable:"",style:{width:"180px"}},{default:l(()=>[e(T,{label:"成功",value:1}),e(T,{label:"失败",value:0})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"登录时间"},{default:l(()=>[e(W,{modelValue:o.dateRange,"onUpdate:modelValue":t[4]||(t[4]=a=>o.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(w,{type:"primary",onClick:$},{default:l(()=>[...t[17]||(t[17]=[n("搜索",-1)])]),_:1}),e(w,{onClick:q},{default:l(()=>[...t[18]||(t[18]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ae((m(),v(Z,{data:P.value},{default:l(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"userId",label:"用户ID",width:"100"}),e(d,{prop:"username",label:"用户名",width:"120"}),e(d,{prop:"loginType",label:"登录类型",width:"120"},{default:l(({row:a})=>[e(U,{type:"info"},{default:l(()=>[n(u(H(a.loginType)),1)]),_:2},1024)]),_:1}),e(d,{prop:"ip",label:"IP地址",width:"120"}),e(d,{prop:"location",label:"登录地点",width:"150"}),e(d,{prop:"browser",label:"浏览器",width:"120"}),e(d,{prop:"os",label:"操作系统",width:"120"}),e(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[e(U,{type:a.status===1?"success":"danger"},{default:l(()=>[n(u(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"message",label:"提示信息",width:"150"}),e(d,{prop:"loginTime",label:"登录时间",width:"180"}),e(d,{label:"操作",width:"100",fixed:"right"},{default:l(({row:a})=>[e(w,{type:"primary",size:"small",onClick:ce=>A(a)},{default:l(()=>[...t[19]||(t[19]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,L.value]]),e(ee,{"current-page":y.value,"onUpdate:currentPage":t[5]||(t[5]=a=>y.value=a),"page-size":h.value,"onUpdate:pageSize":t[6]||(t[6]=a=>h.value=a),total:N.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:K},null,8,["current-page","page-size","total"])]),_:1})):b("",!0),_.value==="operation"?(m(),v(k,{key:1,class:"content-card"},{header:l(()=>[s("div",Ve,[t[21]||(t[21]=s("h3",null,"操作日志管理",-1)),e(w,{type:"primary",onClick:G},{default:l(()=>[...t[20]||(t[20]=[n("导出日志",-1)])]),_:1})])]),default:l(()=>[e(X,{model:o,inline:""},{default:l(()=>[e(f,{label:"用户ID"},{default:l(()=>[e(I,{modelValue:o.userId,"onUpdate:modelValue":t[7]||(t[7]=a=>o.userId=a),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"用户名"},{default:l(()=>[e(I,{modelValue:o.username,"onUpdate:modelValue":t[8]||(t[8]=a=>o.username=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"操作类型"},{default:l(()=>[e(I,{modelValue:o.operation,"onUpdate:modelValue":t[9]||(t[9]=a=>o.operation=a),placeholder:"请输入操作类型",clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"操作状态"},{default:l(()=>[e(Q,{modelValue:o.status,"onUpdate:modelValue":t[10]||(t[10]=a=>o.status=a),placeholder:"请选择状态",clearable:"",style:{width:"180px"}},{default:l(()=>[e(T,{label:"成功",value:1}),e(T,{label:"失败",value:0})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"操作时间"},{default:l(()=>[e(W,{modelValue:o.dateRange,"onUpdate:modelValue":t[11]||(t[11]=a=>o.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(f,null,{default:l(()=>[e(w,{type:"primary",onClick:$},{default:l(()=>[...t[22]||(t[22]=[n("搜索",-1)])]),_:1}),e(w,{onClick:q},{default:l(()=>[...t[23]||(t[23]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ae((m(),v(Z,{data:B.value},{default:l(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"userId",label:"用户ID",width:"100"}),e(d,{prop:"username",label:"用户名",width:"120"}),e(d,{prop:"operation",label:"操作类型",width:"150"}),e(d,{prop:"method",label:"请求方法",width:"120"}),e(d,{prop:"ip",label:"IP地址",width:"120"}),e(d,{prop:"location",label:"操作地点",width:"150"}),e(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[e(U,{type:a.status===1?"success":"danger"},{default:l(()=>[n(u(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"executeTime",label:"执行时间(ms)",width:"120"}),e(d,{prop:"createTime",label:"操作时间",width:"180"}),e(d,{label:"操作",width:"100",fixed:"right"},{default:l(({row:a})=>[e(w,{type:"primary",size:"small",onClick:ce=>A(a)},{default:l(()=>[...t[24]||(t[24]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,L.value]]),e(ee,{"current-page":y.value,"onUpdate:currentPage":t[12]||(t[12]=a=>y.value=a),"page-size":h.value,"onUpdate:pageSize":t[13]||(t[13]=a=>h.value=a),total:N.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:J,onCurrentChange:K},null,8,["current-page","page-size","total"])]),_:1})):b("",!0),e(ie,{gutter:20,class:"statistics-cards"},{default:l(()=>[e(M,{span:6},{default:l(()=>[e(k,{class:"stat-card"},{default:l(()=>[s("div",we,[s("div",he,[e(S,null,{default:l(()=>[e(O(oe))]),_:1})]),s("div",ke,[t[25]||(t[25]=s("div",{class:"stat-title"},"成功登录",-1)),s("div",Ce,u(z.successfulLogins),1)])])]),_:1})]),_:1}),e(M,{span:6},{default:l(()=>[e(k,{class:"stat-card"},{default:l(()=>[s("div",De,[s("div",Ie,[e(S,null,{default:l(()=>[e(O(se))]),_:1})]),s("div",Le,[t[26]||(t[26]=s("div",{class:"stat-title"},"失败登录",-1)),s("div",ze,u(z.failedLogins),1)])])]),_:1})]),_:1}),e(M,{span:6},{default:l(()=>[e(k,{class:"stat-card"},{default:l(()=>[s("div",xe,[s("div",Te,[e(S,null,{default:l(()=>[e(O(oe))]),_:1})]),s("div",Ue,[t[27]||(t[27]=s("div",{class:"stat-title"},"成功操作",-1)),s("div",Se,u(x.successfulOperations),1)])])]),_:1})]),_:1}),e(M,{span:6},{default:l(()=>[e(k,{class:"stat-card"},{default:l(()=>[s("div",Me,[s("div",Oe,[e(S,null,{default:l(()=>[e(O(se))]),_:1})]),s("div",Re,[t[28]||(t[28]=s("div",{class:"stat-title"},"失败操作",-1)),s("div",Ye,u(x.failedOperations),1)])])]),_:1})]),_:1})]),_:1}),e(pe,{modelValue:Y.value,"onUpdate:modelValue":t[14]||(t[14]=a=>Y.value=a),title:F.value,width:"800px"},{default:l(()=>[i.value?(m(),te("div",Pe,[e(re,{column:2,border:""},{default:l(()=>[e(c,{label:"ID"},{default:l(()=>[n(u(i.value.id),1)]),_:1}),e(c,{label:"用户ID"},{default:l(()=>[n(u(i.value.userId),1)]),_:1}),e(c,{label:"用户名"},{default:l(()=>[n(u(i.value.username),1)]),_:1}),e(c,{label:"IP地址"},{default:l(()=>[n(u(i.value.ip),1)]),_:1}),e(c,{label:"操作地点"},{default:l(()=>[n(u(i.value.location),1)]),_:1}),e(c,{label:"浏览器"},{default:l(()=>[n(u(i.value.browser),1)]),_:1}),e(c,{label:"操作系统"},{default:l(()=>[n(u(i.value.os),1)]),_:1}),e(c,{label:"状态"},{default:l(()=>[e(U,{type:i.value.status===1?"success":"danger"},{default:l(()=>[n(u(i.value.status===1?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),e(c,{label:"创建时间"},{default:l(()=>[n(u(ue(i.value.createTime)),1)]),_:1}),_.value==="operation"?(m(),v(c,{key:0,label:"操作类型"},{default:l(()=>[n(u(i.value.operation),1)]),_:1})):b("",!0),_.value==="operation"?(m(),v(c,{key:1,label:"请求方法"},{default:l(()=>[n(u(i.value.method),1)]),_:1})):b("",!0),_.value==="operation"?(m(),v(c,{key:2,label:"执行时间"},{default:l(()=>[n(u(i.value.executeTime)+"ms",1)]),_:1})):b("",!0),_.value==="login"?(m(),v(c,{key:3,label:"登录类型"},{default:l(()=>[n(u(H(i.value.loginType)),1)]),_:1})):b("",!0),e(c,{label:"提示信息"},{default:l(()=>[n(u(i.value.message),1)]),_:1}),i.value.params?(m(),v(c,{key:4,label:"参数",span:2},{default:l(()=>[s("pre",Be,u(i.value.params),1)]),_:1})):b("",!0),i.value.result?(m(),v(c,{key:5,label:"返回结果",span:2},{default:l(()=>[s("pre",Ne,u(i.value.result),1)]),_:1})):b("",!0)]),_:1})])):b("",!0)]),_:1},8,["modelValue","title"])])}}}),qe=ve($e,[["__scopeId","data-v-401fc3ee"]]);export{qe as default};
