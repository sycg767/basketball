import{X as p,_ as g,r as m,w as q,M as x,d as N,o as k,am as B}from"./index-BU1z93KZ.js";function T(s){return p({url:"/api/payment/create",method:"post",data:s})}function $(s){return p({url:`/api/payment/query/${s}`,method:"get"})}function b(s){return p({url:`/api/mock/payment/scan-success/${s}`,method:"post"})}const F={class:"payment-status-poller"},w={__name:"PaymentStatusPoller",props:{paymentNo:{type:String,required:!0},queryFn:{type:Function,required:!0},interval:{type:Number,default:2e3},maxAttempts:{type:Number,default:30},autoStart:{type:Boolean,default:!1}},emits:["success","failed","timeout","error"],setup(s,{expose:v,emit:y}){const a=s,l=y,t=m(!1),n=m("pending"),u=m(0);let c=null;q(()=>a.paymentNo,e=>{e&&a.autoStart&&i()});const i=()=>{t.value||(t.value=!0,u.value=0,n.value="pending",d())},d=async()=>{if(!t.value||u.value>=a.maxAttempts){u.value>=a.maxAttempts&&S();return}u.value++;try{const e=await a.queryFn(a.paymentNo);if(e.code===200){const o=e.data.status;if(o===2){_(e.data);return}else if(o===3||o===4||o===5){h(e.data);return}}f()}catch(e){console.error("查询支付状态失败:",e),l("error",e),f()}},f=()=>{t.value&&(c=setTimeout(()=>{d()},a.interval))},_=e=>{n.value="success",t.value=!1,r(),l("success",e)},h=e=>{n.value="failed",t.value=!1,r(),l("failed",e)},S=()=>{n.value="timeout",t.value=!1,r(),l("timeout")},r=()=>{t.value=!1,c&&(clearTimeout(c),c=null)},P=()=>{r(),n.value="pending",u.value=0};return x(()=>{r()}),a.autoStart&&a.paymentNo&&i(),v({start:i,stop:r,reset:P,polling:t,status:n,attempts:u}),(e,o)=>(k(),N("div",F,[B(e.$slots,"default",{status:n.value,polling:t.value},void 0,!0)]))}},E=g(w,[["__scopeId","data-v-ed066845"]]);export{E as P,T as c,b as m,$ as q};
