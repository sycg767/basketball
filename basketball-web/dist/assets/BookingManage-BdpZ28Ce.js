import{_ as K,r as y,k as D,t as O,d as Q,b as T,e,a as t,f as u,E as h,a4 as W,o as S,i as o,u as N,a5 as X,N as Y,a3 as Z,c as L,B as r,g as ee,U as ae,ay as te,M as le}from"./index-zUzrFZpX.js";import{h as oe,i as ne,j as se}from"./admin-CAaDuMXk.js";const re={class:"booking-manage-container"},ue={style:{color:"#f56c6c","font-weight":"bold"}},de={__name:"BookingManage",setup(ie){const w=y(!1),b=y(!1),d=D({orderNo:"",username:"",status:""}),m=D({page:1,pageSize:10,total:0}),V=y([]),s=y({}),f=async()=>{w.value=!0;try{const p={page:m.page,pageSize:m.pageSize,orderNo:d.orderNo||void 0,username:d.username||void 0,status:d.status!==""?d.status:void 0},a=await oe(p);V.value=a.data.records.map(n=>({id:n.id,orderNo:n.bookingNo,venueName:n.venueName,venueLocation:n.venueLocation||"-",username:n.username,phone:n.phone,bookingDate:n.bookingDate,timeSlot:n.timeSlot,duration:n.duration,price:n.price,amount:n.actualPrice||n.totalPrice,payMethod:n.payMethodName,status:n.status,createTime:n.createTime,remark:n.remark||""})),m.total=a.data.total}catch(p){h.error(p.message||"获取预订列表失败")}finally{w.value=!1}},x=p=>({0:"warning",1:"primary",2:"info",3:"success",4:"danger",5:"info"})[p]||"info",C=p=>({0:"待支付",1:"已支付",2:"已取消",3:"已完成",4:"已退款",5:"超时取消"})[p]||"未知",M=()=>{m.page=1,f()},U=()=>{d.orderNo="",d.username="",d.status="",M()},P=async p=>{try{const a=await ne(p.id);s.value={id:a.data.id,orderNo:a.data.bookingNo,venueName:a.data.venueName,venueLocation:a.data.venueLocation||"-",username:a.data.username,phone:a.data.phone,bookingDate:a.data.bookingDate,timeSlot:a.data.timeSlot,duration:a.data.duration,price:a.data.price,amount:a.data.actualPrice||a.data.totalPrice,payMethod:a.data.payMethodName,status:a.data.status,createTime:a.data.createTime,remark:a.data.remark||""},b.value=!0}catch(a){h.error(a.message||"获取预订详情失败")}},E=async p=>{try{await le.confirm(`确定要取消订单"${p.orderNo}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await se(p.id),h.success("取消成功"),f()}catch(a){a!=="cancel"&&h.error(a.message||"取消失败")}},$=()=>{f()},F=()=>{f()};return O(()=>{f()}),(p,a)=>{const n=u("el-input"),v=u("el-form-item"),_=u("el-option"),j=u("el-select"),k=u("el-icon"),g=u("el-button"),I=u("el-form"),B=u("el-card"),c=u("el-table-column"),z=u("el-tag"),R=u("el-table"),q=u("el-pagination"),i=u("el-descriptions-item"),A=u("el-descriptions"),G=u("el-dialog"),H=W("loading");return S(),Q("div",re,[a[12]||(a[12]=T("h2",{class:"page-title"},"预订管理",-1)),e(B,{class:"search-card"},{default:t(()=>[e(I,{inline:!0,model:d},{default:t(()=>[e(v,{label:"订单号"},{default:t(()=>[e(n,{modelValue:d.orderNo,"onUpdate:modelValue":a[0]||(a[0]=l=>d.orderNo=l),placeholder:"请输入订单号",clearable:""},null,8,["modelValue"])]),_:1}),e(v,{label:"用户名"},{default:t(()=>[e(n,{modelValue:d.username,"onUpdate:modelValue":a[1]||(a[1]=l=>d.username=l),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(v,{label:"预订状态"},{default:t(()=>[e(j,{modelValue:d.status,"onUpdate:modelValue":a[2]||(a[2]=l=>d.status=l),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(_,{label:"全部",value:""}),e(_,{label:"待支付",value:0}),e(_,{label:"已支付",value:1}),e(_,{label:"已取消",value:2}),e(_,{label:"已完成",value:3}),e(_,{label:"已退款",value:4}),e(_,{label:"超时取消",value:5})]),_:1},8,["modelValue"])]),_:1}),e(v,null,{default:t(()=>[e(g,{type:"primary",onClick:M},{default:t(()=>[e(k,null,{default:t(()=>[e(N(X))]),_:1}),a[7]||(a[7]=o(" 搜索 ",-1))]),_:1}),e(g,{onClick:U},{default:t(()=>[e(k,null,{default:t(()=>[e(N(Y))]),_:1}),a[8]||(a[8]=o(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(B,{class:"table-card"},{default:t(()=>[Z((S(),L(R,{data:V.value,stripe:""},{default:t(()=>[e(c,{prop:"orderNo",label:"订单号",width:"140"}),e(c,{prop:"venueName",label:"场地名称",width:"150"}),e(c,{prop:"username",label:"预订用户",width:"120"}),e(c,{prop:"phone",label:"联系电话",width:"130"}),e(c,{prop:"bookingDate",label:"预订日期",width:"120"}),e(c,{prop:"timeSlot",label:"时间段",width:"150"}),e(c,{prop:"duration",label:"时长(小时)",width:"100"}),e(c,{prop:"amount",label:"金额",width:"100"},{default:t(({row:l})=>[o(" ¥"+r(l.amount.toFixed(2)),1)]),_:1}),e(c,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[e(z,{type:x(l.status)},{default:t(()=>[o(r(C(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"createTime",label:"下单时间",width:"180"}),e(c,{label:"操作",width:"150",fixed:"right"},{default:t(({row:l})=>[e(g,{type:"primary",link:"",onClick:J=>P(l)},{default:t(()=>[e(k,null,{default:t(()=>[e(N(ae))]),_:1}),a[9]||(a[9]=o(" 详情 ",-1))]),_:1},8,["onClick"]),l.status===0?(S(),L(g,{key:0,type:"danger",link:"",onClick:J=>E(l)},{default:t(()=>[e(k,null,{default:t(()=>[e(N(te))]),_:1}),a[10]||(a[10]=o(" 取消 ",-1))]),_:1},8,["onClick"])):ee("",!0)]),_:1})]),_:1},8,["data"])),[[H,w.value]]),e(q,{"current-page":m.page,"onUpdate:currentPage":a[3]||(a[3]=l=>m.page=l),"page-size":m.pageSize,"onUpdate:pageSize":a[4]||(a[4]=l=>m.pageSize=l),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:F,class:"pagination"},null,8,["current-page","page-size","total"])]),_:1}),e(G,{modelValue:b.value,"onUpdate:modelValue":a[6]||(a[6]=l=>b.value=l),title:"预订详情",width:"600px"},{footer:t(()=>[e(g,{onClick:a[5]||(a[5]=l=>b.value=!1)},{default:t(()=>[...a[11]||(a[11]=[o("关闭",-1)])]),_:1})]),default:t(()=>[e(A,{column:2,border:""},{default:t(()=>[e(i,{label:"订单号"},{default:t(()=>[o(r(s.value.orderNo),1)]),_:1}),e(i,{label:"订单状态"},{default:t(()=>[e(z,{type:x(s.value.status)},{default:t(()=>[o(r(C(s.value.status)),1)]),_:1},8,["type"])]),_:1}),e(i,{label:"场地名称"},{default:t(()=>[o(r(s.value.venueName),1)]),_:1}),e(i,{label:"场地位置"},{default:t(()=>[o(r(s.value.venueLocation),1)]),_:1}),e(i,{label:"预订用户"},{default:t(()=>[o(r(s.value.username),1)]),_:1}),e(i,{label:"联系电话"},{default:t(()=>[o(r(s.value.phone),1)]),_:1}),e(i,{label:"预订日期"},{default:t(()=>[o(r(s.value.bookingDate),1)]),_:1}),e(i,{label:"时间段"},{default:t(()=>[o(r(s.value.timeSlot),1)]),_:1}),e(i,{label:"时长"},{default:t(()=>[o(r(s.value.duration)+" 小时 ",1)]),_:1}),e(i,{label:"单价"},{default:t(()=>[o(" ¥"+r(s.value.price)+"/小时 ",1)]),_:1}),e(i,{label:"总金额"},{default:t(()=>{var l;return[T("span",ue," ¥"+r((l=s.value.amount)==null?void 0:l.toFixed(2)),1)]}),_:1}),e(i,{label:"支付方式"},{default:t(()=>[o(r(s.value.payMethod),1)]),_:1}),e(i,{label:"下单时间",span:2},{default:t(()=>[o(r(s.value.createTime),1)]),_:1}),e(i,{label:"备注",span:2},{default:t(()=>[o(r(s.value.remark||"无"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},me=K(de,[["__scopeId","data-v-4020bb0a"]]);export{me as default};
