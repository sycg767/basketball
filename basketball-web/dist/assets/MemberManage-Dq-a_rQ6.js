import{z as _e,A as Ce,B as Ve,C as Te,D as ke,E as he,F as we,G as xe}from"./admin-U0NDfv3O.js";import{_ as Ue,r as d,k as Y,t as ze,d as v,e,a as t,f as s,E as p,a4 as Le,o as c,i,a3 as Z,b as ee,c as T,B as y,g as x,M as O}from"./index-DU9PCbH8.js";const Se={class:"member-manage-container"},Ne={key:0},De={key:1},Be={key:2},Pe={class:"pagination-container"},Me={key:0},Ee={key:1},Fe={key:2},$e={class:"pagination-container"},Oe={__name:"MemberManage",setup(je){const j=d("cardType"),S=d(!1),N=d(!1),q=d([]),D=d(1),B=d(10),I=d(0),R=d([]),U=d(1),P=d(10),A=d(0),f=Y({keyword:"",status:""}),b=d(!1),M=d(""),E=d(null),F=d(!1),_=d(""),n=Y({id:null,cardName:"",cardCode:"",cardType:null,duration:null,times:null,price:null,originalPrice:null,discount:null,memberLevel:null,description:"",sortOrder:0,status:1}),ae={cardName:[{required:!0,message:"请输入卡名称",trigger:"blur"}],cardCode:[{required:!0,message:"请输入卡编号",trigger:"blur"}],cardType:[{required:!0,message:"请选择卡类型",trigger:"change"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}],memberLevel:[{required:!0,message:"请选择会员等级",trigger:"change"}]},k=async()=>{try{S.value=!0;const{data:o}=await _e({page:D.value,pageSize:B.value});q.value=o.records||[],I.value=o.total||0}catch{p.error("获取会员卡类型列表失败")}finally{S.value=!1}},le=()=>{M.value="添加会员卡类型",G(),b.value=!0},te=o=>{M.value="编辑会员卡类型",Object.assign(n,o),o.benefitsList&&o.benefitsList.length&&(_.value=o.benefitsList.join(`
`)),b.value=!0},oe=o=>{O.confirm(`确定要删除会员卡类型"${o.cardName}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await Te(o.id),p.success("删除成功"),k()}catch(l){p.error(l.message||"删除失败")}}).catch(()=>{})},ne=async o=>{try{await Ve(o.id,o.status),p.success("状态更新成功")}catch{p.error("状态更新失败"),o.status=o.status===1?0:1}},re=async()=>{await E.value.validate();try{F.value=!0;const o={...n};_.value&&(o.benefits=_.value.split(`
`).filter(l=>l.trim())),o.id?(await we(o.id,o),p.success("更新成功")):(await xe(o),p.success("添加成功")),b.value=!1,k()}catch(o){p.error(o.message||"提交失败")}finally{F.value=!1}},z=async()=>{try{N.value=!0;const o={keyword:f.keyword,status:f.status,page:U.value,pageSize:P.value},{data:l}=await Ce(o);R.value=l.records||[],A.value=l.total||0}catch{p.error("获取会员卡列表失败")}finally{N.value=!1}},h=()=>{U.value=1,z()},de=()=>{f.keyword="",f.status="",h()},se=o=>{O.confirm("确定要激活该会员卡吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ke(o.id),p.success("激活成功"),z()}catch{p.error("激活失败")}}).catch(()=>{})},ue=o=>{O.confirm("确定要冻结该会员卡吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await he(o.id),p.success("冻结成功"),z()}catch{p.error("冻结失败")}}).catch(()=>{})},G=()=>{var o;Object.assign(n,{id:null,cardName:"",cardCode:"",cardType:null,duration:null,times:null,price:null,originalPrice:null,discount:null,memberLevel:null,description:"",sortOrder:0,status:1}),_.value="",(o=E.value)==null||o.clearValidate()},ie=()=>{G()},pe=o=>({1:"时间卡",2:"次卡",3:"储值卡"})[o]||"未知",ce=o=>({1:"primary",2:"success",3:"warning"})[o]||"info",me=o=>({1:"普通会员",2:"银卡会员",3:"金卡会员",4:"VIP会员"})[o]||"未知",ye=o=>({0:"未激活",1:"有效",2:"已过期",3:"已冻结",4:"已注销"})[o]||"未知",fe=o=>({0:"info",1:"success",2:"danger",3:"warning",4:"info"})[o]||"info";return ze(()=>{k(),z()}),(o,l)=>{const g=s("el-button"),L=s("el-card"),r=s("el-table-column"),H=s("el-tag"),ge=s("el-switch"),J=s("el-table"),K=s("el-pagination"),Q=s("el-tab-pane"),w=s("el-input"),u=s("el-form-item"),m=s("el-option"),$=s("el-select"),W=s("el-form"),ve=s("el-tabs"),C=s("el-input-number"),be=s("el-dialog"),X=Le("loading");return c(),v("div",Se,[e(ve,{modelValue:j.value,"onUpdate:modelValue":l[6]||(l[6]=a=>j.value=a),type:"card"},{default:t(()=>[e(Q,{label:"会员卡类型",name:"cardType"},{default:t(()=>[e(L,{class:"filter-card"},{default:t(()=>[e(g,{type:"primary",icon:"Plus",onClick:le},{default:t(()=>[...l[21]||(l[21]=[i("添加会员卡类型",-1)])]),_:1})]),_:1}),e(L,{class:"table-card"},{default:t(()=>[Z((c(),T(J,{data:q.value,stripe:"",border:""},{default:t(()=>[e(r,{prop:"id",label:"ID",width:"80"}),e(r,{prop:"cardName",label:"卡名称","min-width":"120"}),e(r,{prop:"cardCode",label:"卡编号",width:"140"}),e(r,{label:"卡类型",width:"100"},{default:t(({row:a})=>[e(H,{type:ce(a.cardType)},{default:t(()=>[i(y(pe(a.cardType)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"price",label:"价格",width:"100"},{default:t(({row:a})=>[i("¥"+y(a.price),1)]),_:1}),e(r,{label:"时长/次数",width:"100"},{default:t(({row:a})=>[a.cardType===1?(c(),v("span",Ne,y(a.duration)+"天",1)):a.cardType===2?(c(),v("span",De,y(a.times)+"次",1)):(c(),v("span",Be,"-"))]),_:1}),e(r,{prop:"memberLevel",label:"会员等级",width:"100"},{default:t(({row:a})=>[i(y(me(a.memberLevel)),1)]),_:1}),e(r,{label:"状态",width:"100"},{default:t(({row:a})=>[e(ge,{modelValue:a.status,"onUpdate:modelValue":V=>a.status=V,"active-value":1,"inactive-value":0,onChange:V=>ne(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(r,{label:"操作",width:"180",fixed:"right"},{default:t(({row:a})=>[e(g,{type:"primary",link:"",icon:"Edit",onClick:V=>te(a)},{default:t(()=>[...l[22]||(l[22]=[i(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(g,{type:"danger",link:"",icon:"Delete",onClick:V=>oe(a)},{default:t(()=>[...l[23]||(l[23]=[i(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,S.value]]),ee("div",Pe,[e(K,{"current-page":D.value,"onUpdate:currentPage":l[0]||(l[0]=a=>D.value=a),"page-size":B.value,"onUpdate:pageSize":l[1]||(l[1]=a=>B.value=a),total:I.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:k,onCurrentChange:k},null,8,["current-page","page-size","total"])])]),_:1})]),_:1}),e(Q,{label:"会员卡管理",name:"memberCard"},{default:t(()=>[e(L,{class:"filter-card"},{default:t(()=>[e(W,{inline:!0,model:f},{default:t(()=>[e(u,{label:"关键词"},{default:t(()=>[e(w,{modelValue:f.keyword,"onUpdate:modelValue":l[2]||(l[2]=a=>f.keyword=a),placeholder:"卡号/用户名/手机号",clearable:"",onClear:h},null,8,["modelValue"])]),_:1}),e(u,{label:"状态"},{default:t(()=>[e($,{modelValue:f.status,"onUpdate:modelValue":l[3]||(l[3]=a=>f.status=a),placeholder:"请选择",clearable:""},{default:t(()=>[e(m,{label:"全部",value:""}),e(m,{label:"未激活",value:0}),e(m,{label:"有效",value:1}),e(m,{label:"已过期",value:2}),e(m,{label:"已冻结",value:3})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(g,{type:"primary",icon:"Search",onClick:h},{default:t(()=>[...l[24]||(l[24]=[i("搜索",-1)])]),_:1}),e(g,{icon:"Refresh",onClick:de},{default:t(()=>[...l[25]||(l[25]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(L,{class:"table-card"},{default:t(()=>[Z((c(),T(J,{data:R.value,stripe:"",border:""},{default:t(()=>[e(r,{prop:"id",label:"ID",width:"80"}),e(r,{prop:"cardNo",label:"卡号",width:"180"}),e(r,{prop:"cardName",label:"卡类型",width:"120"}),e(r,{prop:"realName",label:"持卡人",width:"100"},{default:t(({row:a})=>[i(y(a.realName||a.username),1)]),_:1}),e(r,{prop:"phone",label:"手机号",width:"120"}),e(r,{label:"卡信息","min-width":"150"},{default:t(({row:a})=>[a.cardType===1?(c(),v("div",Me," 有效期: "+y(a.startDate)+" ~ "+y(a.expireDate),1)):a.cardType===2?(c(),v("div",Ee," 剩余次数: "+y(a.remainingTimes)+"次 ",1)):a.cardType===3?(c(),v("div",Fe," 余额: ¥"+y(a.balance),1)):x("",!0)]),_:1}),e(r,{label:"状态",width:"100"},{default:t(({row:a})=>[e(H,{type:fe(a.status)},{default:t(()=>[i(y(ye(a.status)),1)]),_:2},1032,["type"])]),_:1}),e(r,{prop:"createTime",label:"创建时间",width:"180"}),e(r,{label:"操作",width:"160",fixed:"right"},{default:t(({row:a})=>[a.status===0?(c(),T(g,{key:0,type:"success",link:"",onClick:V=>se(a)},{default:t(()=>[...l[26]||(l[26]=[i(" 激活 ",-1)])]),_:1},8,["onClick"])):x("",!0),a.status===1?(c(),T(g,{key:1,type:"warning",link:"",onClick:V=>ue(a)},{default:t(()=>[...l[27]||(l[27]=[i(" 冻结 ",-1)])]),_:1},8,["onClick"])):x("",!0)]),_:1})]),_:1},8,["data"])),[[X,N.value]]),ee("div",$e,[e(K,{"current-page":U.value,"onUpdate:currentPage":l[4]||(l[4]=a=>U.value=a),"page-size":P.value,"onUpdate:pageSize":l[5]||(l[5]=a=>P.value=a),total:A.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:h,onCurrentChange:h},null,8,["current-page","page-size","total"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(be,{modelValue:b.value,"onUpdate:modelValue":l[20]||(l[20]=a=>b.value=a),title:M.value,width:"700px",onClose:ie},{footer:t(()=>[e(g,{onClick:l[19]||(l[19]=a=>b.value=!1)},{default:t(()=>[...l[28]||(l[28]=[i("取消",-1)])]),_:1}),e(g,{type:"primary",onClick:re,loading:F.value},{default:t(()=>[...l[29]||(l[29]=[i(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(W,{ref_key:"cardTypeFormRef",ref:E,model:n,rules:ae,"label-width":"120px"},{default:t(()=>[e(u,{label:"卡名称",prop:"cardName"},{default:t(()=>[e(w,{modelValue:n.cardName,"onUpdate:modelValue":l[7]||(l[7]=a=>n.cardName=a),placeholder:"请输入卡名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"卡编号",prop:"cardCode"},{default:t(()=>[e(w,{modelValue:n.cardCode,"onUpdate:modelValue":l[8]||(l[8]=a=>n.cardCode=a),placeholder:"请输入卡编号"},null,8,["modelValue"])]),_:1}),e(u,{label:"卡类型",prop:"cardType"},{default:t(()=>[e($,{modelValue:n.cardType,"onUpdate:modelValue":l[9]||(l[9]=a=>n.cardType=a),placeholder:"请选择",style:{width:"100%"}},{default:t(()=>[e(m,{label:"时间卡",value:1}),e(m,{label:"次卡",value:2}),e(m,{label:"储值卡",value:3})]),_:1},8,["modelValue"])]),_:1}),n.cardType===1?(c(),T(u,{key:0,label:"有效期(天)",prop:"duration"},{default:t(()=>[e(C,{modelValue:n.duration,"onUpdate:modelValue":l[10]||(l[10]=a=>n.duration=a),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})):x("",!0),n.cardType===2?(c(),T(u,{key:1,label:"次数",prop:"times"},{default:t(()=>[e(C,{modelValue:n.times,"onUpdate:modelValue":l[11]||(l[11]=a=>n.times=a),min:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})):x("",!0),e(u,{label:"价格",prop:"price"},{default:t(()=>[e(C,{modelValue:n.price,"onUpdate:modelValue":l[12]||(l[12]=a=>n.price=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(u,{label:"原价"},{default:t(()=>[e(C,{modelValue:n.originalPrice,"onUpdate:modelValue":l[13]||(l[13]=a=>n.originalPrice=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(u,{label:"折扣"},{default:t(()=>[e(C,{modelValue:n.discount,"onUpdate:modelValue":l[14]||(l[14]=a=>n.discount=a),min:0,max:1,precision:2,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(u,{label:"会员等级",prop:"memberLevel"},{default:t(()=>[e($,{modelValue:n.memberLevel,"onUpdate:modelValue":l[15]||(l[15]=a=>n.memberLevel=a),placeholder:"请选择",style:{width:"100%"}},{default:t(()=>[e(m,{label:"普通会员",value:1}),e(m,{label:"银卡会员",value:2}),e(m,{label:"金卡会员",value:3}),e(m,{label:"VIP会员",value:4})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"权益列表"},{default:t(()=>[e(w,{modelValue:_.value,"onUpdate:modelValue":l[16]||(l[16]=a=>_.value=a),type:"textarea",rows:4,placeholder:"每行一个权益"},null,8,["modelValue"])]),_:1}),e(u,{label:"描述"},{default:t(()=>[e(w,{modelValue:n.description,"onUpdate:modelValue":l[17]||(l[17]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(u,{label:"排序"},{default:t(()=>[e(C,{modelValue:n.sortOrder,"onUpdate:modelValue":l[18]||(l[18]=a=>n.sortOrder=a),min:0,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Re=Ue(Oe,[["__scopeId","data-v-c56c0793"]]);export{Re as default};
