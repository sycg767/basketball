import{_ as Se,j as Ue,r as d,k as Y,t as $e,a6 as Ie,E as v,d as Z,e as a,a as o,f as u,m as Ee,a4 as je,o as c,b as t,c as y,g as w,B as p,z as F,u as z,a8 as ee,i as m,a3 as ne,N as qe,F as Re,x as Le,aj as Ae,ad as We,M as ie}from"./index-DU9PCbH8.js";import{g as ue,p as Oe}from"./booking-K964GJ6h.js";import{a as Ge}from"./member-D45oi1Qc.js";const He={class:"payment-method-container"},Je={class:"order-info"},Ke={class:"info-item"},Qe={class:"value"},Xe={class:"info-item"},Ye={class:"value"},Ze={class:"info-item"},et={class:"value amount"},tt={class:"payment-methods"},at={class:"method-content"},st={class:"method-icon balance"},ot={class:"method-info"},lt={class:"payment-actions"},nt={class:"records-header"},it={class:"amount-text"},ut={class:"manage-header"},dt={class:"payment-methods-list"},rt={class:"method-card balance-card"},ct={class:"method-header"},pt={class:"method-icon-wrapper"},mt={class:"method-info"},vt={class:"method-actions"},yt={class:"method-header"},ft={class:"method-info"},_t={class:"method-actions"},gt={class:"bills-header"},bt={class:"filter-group"},ht={class:"bill-summary"},kt={class:"summary-item"},wt={class:"summary-value expense"},xt={class:"summary-item"},Ct={class:"summary-value income"},Nt={class:"summary-item"},zt={class:"summary-value"},Tt={class:"balance-text"},Vt={__name:"PaymentMethod",setup(Dt){const R=Ie(),T=Ee(),de=Ue(),P=d("records"),te=d(!1),h=d(!1),_=d("wechat"),V=d("0.00"),i=Y({orderNo:"",businessNo:"",businessName:"",businessType:"",amount:"0.00"}),S=d(!1),L=d([]),A=d(1),W=d(10),O=d(0),k=d([]),D=d(!1),r=Y({type:"",account:"",isDefault:!1}),U=d(!1),x=d([]),G=d(1),H=d(10),J=d(0),ae=d([]),C=Y({totalExpense:0,totalIncome:0,totalCount:0});$e(()=>{const{orderNo:l,amount:e}=R.query;l&&e?(te.value=!0,P.value="method",re(),ve()):(P.value="records",$()),he()});const re=()=>{const{orderNo:l,businessNo:e,businessName:n,businessType:f,amount:N}=R.query;!l||!N||(i.orderNo=l,i.businessNo=e||l,i.businessName=n||"篮球馆服务",i.businessType=f||"booking",i.amount=N)},$=async()=>{S.value=!0;try{const l=await ue({page:A.value,pageSize:W.value,status:1});l.code===200&&(L.value=l.data.records||[],O.value=l.data.total||0)}catch(l){console.error("获取支付记录失败:",l),v.error("获取支付记录失败")}finally{S.value=!1}},I=async()=>{U.value=!0;try{const l=await ue({page:G.value,pageSize:H.value});if(l.code===200){const e=l.data.records||[];x.value=e.map(n=>({createTime:n.payTime||n.createTime,description:`${n.venueName} - ${n.bookingDate} ${n.timeSlot}`,amount:n.actualPrice||0,type:"expense",balance:0})),J.value=l.data.total||0,C.totalExpense=x.value.reduce((n,f)=>f.type==="expense"?n+f.amount:n,0),C.totalIncome=x.value.reduce((n,f)=>f.type==="income"?n+f.amount:n,0),C.totalCount=x.value.length}}catch(l){console.error("获取账单失败:",l),v.error("获取账单失败")}finally{U.value=!1}},ce=l=>{T.push(`/booking/detail/${l}`)},pe=l=>({0:"warning",1:"success",2:"info",3:"success",4:"danger",5:"info"})[l]||"info",me=l=>({0:"待支付",1:"已支付",2:"已取消",3:"已完成",4:"已退款",5:"超时取消"})[l]||"未知",ve=async()=>{var l;try{const e=await Ge();e.code===200&&(V.value=(e.data||0).toFixed(2))}catch(e){console.error("获取用户余额失败:",e);const n=((l=de.userInfo)==null?void 0:l.balance)||0;V.value=n.toFixed(2)}},ye=()=>{if(!_.value){v.warning("请选择支付方式");return}switch(h.value=!0,_.value){case"wechat":fe();break;case"alipay":_e();break;case"balance":ge();break;default:v.error("不支持的支付方式"),h.value=!1}},fe=()=>{T.push({path:"/payment/wechat",query:{businessNo:i.businessNo,businessType:i.businessType,businessName:i.businessName,amount:i.amount}})},_e=()=>{T.push({path:"/payment/alipay",query:{businessNo:i.businessNo,businessType:i.businessType,businessName:i.businessName,amount:i.amount}})},ge=async()=>{try{const l=parseFloat(V.value),e=parseFloat(i.amount);if(l<e){v.error("余额不足，请充值后再试"),h.value=!1;return}if(await ie.confirm(`确认使用余额支付 ¥${i.amount} 吗？`,"确认支付",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),i.businessType==="booking"){const n=be(i.businessNo),f=await Oe(n,{paymentMethod:2,paymentType:""});f.code===200?(v.success("支付成功！"),setTimeout(()=>{T.push({path:"/payment/result",query:{status:"success",orderNo:i.orderNo,amount:i.amount,paymentMethod:"余额支付"}})},500)):(v.error(f.message||"支付失败"),h.value=!1)}else v.info("该业务类型暂不支持余额支付"),h.value=!1}catch(l){if(l==="cancel"){h.value=!1;return}console.error("余额支付失败:",l),v.error(l.message||"支付失败，请稍后重试"),h.value=!1}},be=l=>R.query.bookingId||l.replace(/\D/g,""),he=()=>{k.value=[{id:1,type:"wechat",name:"微信支付",account:"微信账号: wx***123",isDefault:!0},{id:2,type:"alipay",name:"支付宝支付",account:"支付宝账号: 138****5678",isDefault:!1}]},ke=()=>{if(!r.type||!r.account){v.warning("请填写完整信息");return}const l={wechat:"微信支付",alipay:"支付宝支付",bankcard:"银行卡"},e={id:Date.now(),type:r.type,name:l[r.type],account:r.account,isDefault:r.isDefault};r.isDefault&&k.value.forEach(n=>n.isDefault=!1),k.value.push(e),v.success("添加成功"),D.value=!1,r.type="",r.account="",r.isDefault=!1},we=l=>{k.value.forEach(e=>{e.isDefault=e.id===l}),v.success("已设为默认支付方式")},xe=async l=>{try{await ie.confirm("确定要解绑此支付方式吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=k.value.findIndex(n=>n.id===l);e>-1&&(k.value.splice(e,1),v.success("解绑成功"))}catch{}},Ce=()=>{v.info("充值功能开发中")},Ne=()=>{T.back()};return(l,e)=>{const n=u("el-page-header"),f=u("el-divider"),N=u("el-radio"),B=u("el-icon"),ze=u("el-radio-group"),g=u("el-button"),E=u("el-card"),j=u("el-tab-pane"),b=u("el-table-column"),q=u("el-tag"),se=u("el-table"),oe=u("el-pagination"),K=u("el-empty"),Te=u("el-date-picker"),Ve=u("el-tabs"),Q=u("el-option"),De=u("el-select"),X=u("el-form-item"),Be=u("el-input"),Me=u("el-switch"),Fe=u("el-form"),Pe=u("el-dialog"),le=je("loading");return c(),Z("div",He,[a(n,{onBack:Ne,title:"返回"},{content:o(()=>[...e[16]||(e[16]=[t("span",{class:"page-title"},"支付管理",-1)])]),_:1}),a(Ve,{modelValue:P.value,"onUpdate:modelValue":e[10]||(e[10]=s=>P.value=s),class:"payment-tabs"},{default:o(()=>[te.value?(c(),y(j,{key:0,label:"支付方式",name:"method"},{default:o(()=>[a(E,{class:"payment-card"},{default:o(()=>[t("div",Je,[e[20]||(e[20]=t("h2",{class:"section-title"},"订单信息",-1)),t("div",Ke,[e[17]||(e[17]=t("span",{class:"label"},"订单编号:",-1)),t("span",Qe,p(i.orderNo||"-"),1)]),t("div",Xe,[e[18]||(e[18]=t("span",{class:"label"},"商品名称:",-1)),t("span",Ye,p(i.businessName||"-"),1)]),t("div",Ze,[e[19]||(e[19]=t("span",{class:"label"},"订单金额:",-1)),t("span",et,"¥"+p(i.amount||"0.00"),1)])]),a(f),t("div",tt,[e[24]||(e[24]=t("h2",{class:"section-title"},"选择支付方式",-1)),a(ze,{modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=s=>_.value=s),class:"method-group"},{default:o(()=>[t("div",{class:F(["method-item",{active:_.value==="wechat"}]),onClick:e[0]||(e[0]=s=>_.value="wechat")},[a(N,{value:"wechat",size:"large"},{default:o(()=>[...e[21]||(e[21]=[t("div",{class:"method-content"},[t("div",{class:"method-icon wechat"},[t("svg",{class:"icon","aria-hidden":"true"},[t("use",{"xlink:href":"#icon-wechat"})])]),t("div",{class:"method-info"},[t("h4",null,"微信支付"),t("p",null,"推荐使用微信扫码支付")])],-1)])]),_:1})],2),t("div",{class:F(["method-item",{active:_.value==="alipay"}]),onClick:e[1]||(e[1]=s=>_.value="alipay")},[a(N,{value:"alipay",size:"large"},{default:o(()=>[...e[22]||(e[22]=[t("div",{class:"method-content"},[t("div",{class:"method-icon alipay"},[t("svg",{class:"icon","aria-hidden":"true"},[t("use",{"xlink:href":"#icon-alipay"})])]),t("div",{class:"method-info"},[t("h4",null,"支付宝支付"),t("p",null,"支持支付宝扫码或跳转支付")])],-1)])]),_:1})],2),t("div",{class:F(["method-item",{active:_.value==="balance"}]),onClick:e[2]||(e[2]=s=>_.value="balance")},[a(N,{value:"balance",size:"large"},{default:o(()=>[t("div",at,[t("div",st,[a(B,{size:32},{default:o(()=>[a(z(ee))]),_:1})]),t("div",ot,[e[23]||(e[23]=t("h4",null,"余额支付",-1)),t("p",null,"当前余额: ¥"+p(V.value),1)])])]),_:1})],2)]),_:1},8,["modelValue"])]),t("div",lt,[a(g,{size:"large",onClick:l.handleCancel},{default:o(()=>[...e[25]||(e[25]=[m("取消",-1)])]),_:1},8,["onClick"]),a(g,{type:"primary",size:"large",loading:h.value,disabled:!_.value,onClick:ye},{default:o(()=>[m(" 确认支付 ¥"+p(i.amount||"0.00"),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})):w("",!0),a(j,{label:"支付记录",name:"records"},{default:o(()=>[a(E,{class:"records-card"},{default:o(()=>[t("div",nt,[e[27]||(e[27]=t("h2",{class:"section-title"},"支付记录",-1)),a(g,{type:"primary",icon:z(qe),onClick:$},{default:o(()=>[...e[26]||(e[26]=[m("刷新",-1)])]),_:1},8,["icon"])]),ne((c(),y(se,{data:L.value,style:{width:"100%"},stripe:""},{default:o(()=>[a(b,{prop:"bookingNo",label:"订单号",width:"180"}),a(b,{prop:"venueName",label:"场地名称",width:"150"}),a(b,{prop:"actualPrice",label:"支付金额",width:"120"},{default:o(({row:s})=>{var M;return[t("span",it,"¥"+p((M=s.actualPrice)==null?void 0:M.toFixed(2)),1)]}),_:1}),a(b,{prop:"payMethodName",label:"支付方式",width:"120"}),a(b,{prop:"payTime",label:"支付时间",width:"180"}),a(b,{prop:"status",label:"状态",width:"100"},{default:o(({row:s})=>[a(q,{type:pe(s.status)},{default:o(()=>[m(p(me(s.status)),1)]),_:2},1032,["type"])]),_:1}),a(b,{label:"操作",width:"150"},{default:o(({row:s})=>[a(g,{link:"",type:"primary",onClick:M=>ce(s.id)},{default:o(()=>[...e[28]||(e[28]=[m("查看详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,S.value]]),O.value>0?(c(),y(oe,{key:0,"current-page":A.value,"onUpdate:currentPage":e[4]||(e[4]=s=>A.value=s),"page-size":W.value,"onUpdate:pageSize":e[5]||(e[5]=s=>W.value=s),total:O.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:$,onSizeChange:$,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total"])):w("",!0),!S.value&&L.value.length===0?(c(),y(K,{key:1,description:"暂无支付记录"})):w("",!0)]),_:1})]),_:1}),a(j,{label:"支付方式管理",name:"manage"},{default:o(()=>[a(E,{class:"manage-card"},{default:o(()=>[t("div",ut,[e[30]||(e[30]=t("h2",{class:"section-title"},"我的支付方式",-1)),a(g,{type:"primary",onClick:e[6]||(e[6]=s=>D.value=!0)},{default:o(()=>[...e[29]||(e[29]=[m("添加支付方式",-1)])]),_:1})]),t("div",dt,[t("div",rt,[t("div",ct,[t("div",pt,[a(B,{size:32,color:"#F56C6C"},{default:o(()=>[a(z(ee))]),_:1})]),t("div",mt,[e[31]||(e[31]=t("h4",null,"余额支付",-1)),t("p",null,"当前余额: ¥"+p(V.value),1)]),a(q,{type:"success"},{default:o(()=>[...e[32]||(e[32]=[m("已启用",-1)])]),_:1})]),t("div",vt,[a(g,{link:"",type:"primary",onClick:Ce},{default:o(()=>[...e[33]||(e[33]=[m("充值",-1)])]),_:1})])]),(c(!0),Z(Re,null,Le(k.value,s=>(c(),Z("div",{class:"method-card",key:s.id},[t("div",yt,[t("div",{class:F(["method-icon-wrapper",s.type])},[s.type==="wechat"?(c(),y(B,{key:0,size:32,color:"#07C160"},{default:o(()=>[a(z(Ae))]),_:1})):s.type==="alipay"?(c(),y(B,{key:1,size:32,color:"#1677FF"},{default:o(()=>[a(z(ee))]),_:1})):(c(),y(B,{key:2,size:32,color:"#409EFF"},{default:o(()=>[a(z(We))]),_:1}))],2),t("div",ft,[t("h4",null,p(s.name),1),t("p",null,p(s.account),1)]),s.isDefault?(c(),y(q,{key:0,type:"success"},{default:o(()=>[...e[34]||(e[34]=[m("默认",-1)])]),_:1})):(c(),y(q,{key:1,type:"info"},{default:o(()=>[...e[35]||(e[35]=[m("备用",-1)])]),_:1}))]),t("div",_t,[s.isDefault?w("",!0):(c(),y(g,{key:0,link:"",type:"primary",onClick:M=>we(s.id)},{default:o(()=>[...e[36]||(e[36]=[m(" 设为默认 ",-1)])]),_:1},8,["onClick"])),a(g,{link:"",type:"danger",onClick:M=>xe(s.id)},{default:o(()=>[...e[37]||(e[37]=[m("解绑",-1)])]),_:1},8,["onClick"])])]))),128)),k.value.length===0?(c(),y(K,{key:0,description:"暂无绑定的支付方式"})):w("",!0)])]),_:1})]),_:1}),a(j,{label:"账单管理",name:"bills"},{default:o(()=>[a(E,{class:"bills-card"},{default:o(()=>[t("div",gt,[e[39]||(e[39]=t("h2",{class:"section-title"},"账单管理",-1)),t("div",bt,[a(Te,{modelValue:ae.value,"onUpdate:modelValue":e[7]||(e[7]=s=>ae.value=s),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:I},null,8,["modelValue"]),a(g,{type:"primary",onClick:I},{default:o(()=>[...e[38]||(e[38]=[m("查询",-1)])]),_:1})])]),t("div",ht,[t("div",kt,[e[40]||(e[40]=t("div",{class:"summary-label"},"总支出",-1)),t("div",wt,"¥"+p(C.totalExpense.toFixed(2)),1)]),t("div",xt,[e[41]||(e[41]=t("div",{class:"summary-label"},"总收入",-1)),t("div",Ct,"¥"+p(C.totalIncome.toFixed(2)),1)]),t("div",Nt,[e[42]||(e[42]=t("div",{class:"summary-label"},"交易笔数",-1)),t("div",zt,p(C.totalCount),1)])]),ne((c(),y(se,{data:x.value,style:{width:"100%","margin-top":"20px"},stripe:""},{default:o(()=>[a(b,{prop:"createTime",label:"交易时间",width:"180"}),a(b,{prop:"description",label:"交易说明","min-width":"200"}),a(b,{prop:"amount",label:"金额",width:"150"},{default:o(({row:s})=>[t("span",{class:F(["amount-text",s.type==="expense"?"expense":"income"])},p(s.type==="expense"?"-":"+")+"¥"+p(s.amount.toFixed(2)),3)]),_:1}),a(b,{prop:"balance",label:"余额",width:"150"},{default:o(({row:s})=>[t("span",Tt,"¥"+p(s.balance.toFixed(2)),1)]),_:1})]),_:1},8,["data"])),[[le,U.value]]),J.value>0?(c(),y(oe,{key:0,"current-page":G.value,"onUpdate:currentPage":e[8]||(e[8]=s=>G.value=s),"page-size":H.value,"onUpdate:pageSize":e[9]||(e[9]=s=>H.value=s),total:J.value,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:I,onSizeChange:I,style:{"margin-top":"20px","justify-content":"center"}},null,8,["current-page","page-size","total"])):w("",!0),!U.value&&x.value.length===0?(c(),y(K,{key:1,description:"暂无账单记录"})):w("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Pe,{modelValue:D.value,"onUpdate:modelValue":e[15]||(e[15]=s=>D.value=s),title:"添加支付方式",width:"500px"},{footer:o(()=>[a(g,{onClick:e[14]||(e[14]=s=>D.value=!1)},{default:o(()=>[...e[43]||(e[43]=[m("取消",-1)])]),_:1}),a(g,{type:"primary",onClick:ke},{default:o(()=>[...e[44]||(e[44]=[m("确定",-1)])]),_:1})]),default:o(()=>[a(Fe,{model:r,"label-width":"100px"},{default:o(()=>[a(X,{label:"支付方式"},{default:o(()=>[a(De,{modelValue:r.type,"onUpdate:modelValue":e[11]||(e[11]=s=>r.type=s),placeholder:"请选择支付方式"},{default:o(()=>[a(Q,{label:"微信支付",value:"wechat"}),a(Q,{label:"支付宝支付",value:"alipay"}),a(Q,{label:"银行卡",value:"bankcard"})]),_:1},8,["modelValue"])]),_:1}),a(X,{label:"账号信息"},{default:o(()=>[a(Be,{modelValue:r.account,"onUpdate:modelValue":e[12]||(e[12]=s=>r.account=s),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),a(X,{label:"设为默认"},{default:o(()=>[a(Me,{modelValue:r.isDefault,"onUpdate:modelValue":e[13]||(e[13]=s=>r.isDefault=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Pt=Se(Vt,[["__scopeId","data-v-fea69f9c"]]);export{Pt as default};
