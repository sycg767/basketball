import{r as O}from"./request-KjaGbLG7.js";import{aA as ce,r as f,k as N,$ as _e,t as me,d as ae,e,c as v,g as b,a as l,f as i,E,a3 as oe,i as n,a4 as ge,B as u,b as s,o as m,_ as fe}from"./index-DU9PCbH8.js";const ve={class:"log-container"},be={class:"header-content"},ye={class:"header-content"},Ve={class:"stat-content"},we={class:"stat-icon success"},Ce={class:"stat-info"},he={class:"stat-value"},ke={class:"stat-content"},De={class:"stat-icon danger"},Ie={class:"stat-info"},Le={class:"stat-value"},ze={class:"stat-content"},Te={class:"stat-icon success"},Ue={class:"stat-info"},xe={class:"stat-value"},Se={class:"stat-content"},Me={class:"stat-icon danger"},Oe={class:"stat-info"},Re={class:"stat-value"},Ye={key:0},Pe={class:"log-content"},Be={class:"log-content"},$e=ce({__name:"LogManage",setup(Ne){const _=f("login"),L=f(!1),R=f(!1),j=f("日志详情"),o=N({userId:"",username:"",status:"",operation:"",dateRange:[]}),Y=f([]),P=f([]),B=f(0),y=f(1),C=f(10),r=f(null),z=N({successfulLogins:0,failedLogins:0}),T=N({successfulOperations:0,failedOperations:0});_e(()=>_.value==="login"?Y.value:P.value);const k=async()=>{L.value=!0;try{const p={current:y.value,size:C.value,...o},t=_.value==="login"?"/api/login-log/page":"/api/operation-log/page",V=await O.get(t,{params:p});if(V.code===200){const D=V.data;_.value==="login"?Y.value=D.records:P.value=D.records,B.value=D.total}}catch{E.error("获取日志列表失败")}L.value=!1},se=async()=>{try{const p=await O.get("/api/login-log/statistics");p.code===200&&(z.successfulLogins=p.data.successfulLogins,z.failedLogins=p.data.failedLogins);const t=await O.get("/api/operation-log/statistics");t.code===200&&(T.successfulOperations=t.data.successfulOperations,T.failedOperations=t.data.failedOperations)}catch(p){console.error("获取日志统计失败:",p)}},ne=()=>{y.value=1,k()},$=()=>{y.value=1,k()},q=()=>{o.userId="",o.username="",o.status="",o.operation="",o.dateRange=[],$()},A=async p=>{try{const t=_.value==="login"?"/api/login-log":"/api/operation-log",V=await O.get(`${t}/${p.id}`);V.code===200&&(r.value=V.data,j.value=_.value==="login"?"登录日志详情":"操作日志详情",R.value=!0)}catch{E.error("获取日志详情失败")}},F=()=>{E.success("导出功能开发中...")},G=p=>({1:"账号密码",2:"手机验证码",3:"第三方登录"})[p]||"未知",de=p=>p?new Date(p).toLocaleString():"",H=p=>{C.value=p,k()},J=p=>{y.value=p,k()};return me(()=>{k(),se()}),(p,t)=>{const V=i("el-tab-pane"),D=i("el-tabs"),w=i("el-button"),I=i("el-input"),g=i("el-form-item"),U=i("el-option"),K=i("el-select"),Q=i("el-date-picker"),W=i("el-form"),d=i("el-table-column"),x=i("el-tag"),X=i("el-table"),Z=i("el-pagination"),h=i("el-card"),ee=i("CircleCheck"),S=i("el-icon"),M=i("el-col"),le=i("CircleClose"),ue=i("el-row"),c=i("el-descriptions-item"),ie=i("el-descriptions"),re=i("el-dialog"),te=ge("loading");return m(),ae("div",ve,[e(D,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a),onTabClick:ne},{default:l(()=>[e(V,{label:"登录日志",name:"login"}),e(V,{label:"操作日志",name:"operation"})]),_:1},8,["modelValue"]),_.value==="login"?(m(),v(h,{key:0,class:"content-card"},{header:l(()=>[s("div",be,[t[16]||(t[16]=s("h3",null,"登录日志管理",-1)),e(w,{type:"primary",onClick:F},{default:l(()=>[...t[15]||(t[15]=[n("导出日志",-1)])]),_:1})])]),default:l(()=>[e(W,{model:o,inline:""},{default:l(()=>[e(g,{label:"用户ID"},{default:l(()=>[e(I,{modelValue:o.userId,"onUpdate:modelValue":t[1]||(t[1]=a=>o.userId=a),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),e(g,{label:"用户名"},{default:l(()=>[e(I,{modelValue:o.username,"onUpdate:modelValue":t[2]||(t[2]=a=>o.username=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(g,{label:"登录状态"},{default:l(()=>[e(K,{modelValue:o.status,"onUpdate:modelValue":t[3]||(t[3]=a=>o.status=a),placeholder:"请选择状态",clearable:""},{default:l(()=>[e(U,{label:"成功",value:1}),e(U,{label:"失败",value:0})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"登录时间"},{default:l(()=>[e(Q,{modelValue:o.dateRange,"onUpdate:modelValue":t[4]||(t[4]=a=>o.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(w,{type:"primary",onClick:$},{default:l(()=>[...t[17]||(t[17]=[n("搜索",-1)])]),_:1}),e(w,{onClick:q},{default:l(()=>[...t[18]||(t[18]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),oe((m(),v(X,{data:Y.value},{default:l(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"userId",label:"用户ID",width:"100"}),e(d,{prop:"username",label:"用户名",width:"120"}),e(d,{prop:"loginType",label:"登录类型",width:"120"},{default:l(({row:a})=>[e(x,{type:"info"},{default:l(()=>[n(u(G(a.loginType)),1)]),_:2},1024)]),_:1}),e(d,{prop:"ip",label:"IP地址",width:"120"}),e(d,{prop:"location",label:"登录地点",width:"150"}),e(d,{prop:"browser",label:"浏览器",width:"120"}),e(d,{prop:"os",label:"操作系统",width:"120"}),e(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[e(x,{type:a.status===1?"success":"danger"},{default:l(()=>[n(u(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"message",label:"提示信息",width:"150"}),e(d,{prop:"loginTime",label:"登录时间",width:"180"}),e(d,{label:"操作",width:"100",fixed:"right"},{default:l(({row:a})=>[e(w,{type:"primary",size:"small",onClick:pe=>A(a)},{default:l(()=>[...t[19]||(t[19]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,L.value]]),e(Z,{"current-page":y.value,"onUpdate:currentPage":t[5]||(t[5]=a=>y.value=a),"page-size":C.value,"onUpdate:pageSize":t[6]||(t[6]=a=>C.value=a),total:B.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])]),_:1})):b("",!0),_.value==="operation"?(m(),v(h,{key:1,class:"content-card"},{header:l(()=>[s("div",ye,[t[21]||(t[21]=s("h3",null,"操作日志管理",-1)),e(w,{type:"primary",onClick:F},{default:l(()=>[...t[20]||(t[20]=[n("导出日志",-1)])]),_:1})])]),default:l(()=>[e(W,{model:o,inline:""},{default:l(()=>[e(g,{label:"用户ID"},{default:l(()=>[e(I,{modelValue:o.userId,"onUpdate:modelValue":t[7]||(t[7]=a=>o.userId=a),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])]),_:1}),e(g,{label:"用户名"},{default:l(()=>[e(I,{modelValue:o.username,"onUpdate:modelValue":t[8]||(t[8]=a=>o.username=a),placeholder:"请输入用户名",clearable:""},null,8,["modelValue"])]),_:1}),e(g,{label:"操作类型"},{default:l(()=>[e(I,{modelValue:o.operation,"onUpdate:modelValue":t[9]||(t[9]=a=>o.operation=a),placeholder:"请输入操作类型",clearable:""},null,8,["modelValue"])]),_:1}),e(g,{label:"操作状态"},{default:l(()=>[e(K,{modelValue:o.status,"onUpdate:modelValue":t[10]||(t[10]=a=>o.status=a),placeholder:"请选择状态",clearable:""},{default:l(()=>[e(U,{label:"成功",value:1}),e(U,{label:"失败",value:0})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"操作时间"},{default:l(()=>[e(Q,{modelValue:o.dateRange,"onUpdate:modelValue":t[11]||(t[11]=a=>o.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(g,null,{default:l(()=>[e(w,{type:"primary",onClick:$},{default:l(()=>[...t[22]||(t[22]=[n("搜索",-1)])]),_:1}),e(w,{onClick:q},{default:l(()=>[...t[23]||(t[23]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),oe((m(),v(X,{data:P.value},{default:l(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"userId",label:"用户ID",width:"100"}),e(d,{prop:"username",label:"用户名",width:"120"}),e(d,{prop:"operation",label:"操作类型",width:"150"}),e(d,{prop:"method",label:"请求方法",width:"120"}),e(d,{prop:"ip",label:"IP地址",width:"120"}),e(d,{prop:"location",label:"操作地点",width:"150"}),e(d,{prop:"status",label:"状态",width:"100"},{default:l(({row:a})=>[e(x,{type:a.status===1?"success":"danger"},{default:l(()=>[n(u(a.status===1?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"executeTime",label:"执行时间(ms)",width:"120"}),e(d,{prop:"createTime",label:"操作时间",width:"180"}),e(d,{label:"操作",width:"100",fixed:"right"},{default:l(({row:a})=>[e(w,{type:"primary",size:"small",onClick:pe=>A(a)},{default:l(()=>[...t[24]||(t[24]=[n("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[te,L.value]]),e(Z,{"current-page":y.value,"onUpdate:currentPage":t[12]||(t[12]=a=>y.value=a),"page-size":C.value,"onUpdate:pageSize":t[13]||(t[13]=a=>C.value=a),total:B.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:J},null,8,["current-page","page-size","total"])]),_:1})):b("",!0),e(ue,{gutter:20,class:"statistics-cards"},{default:l(()=>[e(M,{span:6},{default:l(()=>[e(h,{class:"stat-card"},{default:l(()=>[s("div",Ve,[s("div",we,[e(S,null,{default:l(()=>[e(ee)]),_:1})]),s("div",Ce,[t[25]||(t[25]=s("div",{class:"stat-title"},"成功登录",-1)),s("div",he,u(z.successfulLogins),1)])])]),_:1})]),_:1}),e(M,{span:6},{default:l(()=>[e(h,{class:"stat-card"},{default:l(()=>[s("div",ke,[s("div",De,[e(S,null,{default:l(()=>[e(le)]),_:1})]),s("div",Ie,[t[26]||(t[26]=s("div",{class:"stat-title"},"失败登录",-1)),s("div",Le,u(z.failedLogins),1)])])]),_:1})]),_:1}),e(M,{span:6},{default:l(()=>[e(h,{class:"stat-card"},{default:l(()=>[s("div",ze,[s("div",Te,[e(S,null,{default:l(()=>[e(ee)]),_:1})]),s("div",Ue,[t[27]||(t[27]=s("div",{class:"stat-title"},"成功操作",-1)),s("div",xe,u(T.successfulOperations),1)])])]),_:1})]),_:1}),e(M,{span:6},{default:l(()=>[e(h,{class:"stat-card"},{default:l(()=>[s("div",Se,[s("div",Me,[e(S,null,{default:l(()=>[e(le)]),_:1})]),s("div",Oe,[t[28]||(t[28]=s("div",{class:"stat-title"},"失败操作",-1)),s("div",Re,u(T.failedOperations),1)])])]),_:1})]),_:1})]),_:1}),e(re,{modelValue:R.value,"onUpdate:modelValue":t[14]||(t[14]=a=>R.value=a),title:j.value,width:"800px"},{default:l(()=>[r.value?(m(),ae("div",Ye,[e(ie,{column:2,border:""},{default:l(()=>[e(c,{label:"ID"},{default:l(()=>[n(u(r.value.id),1)]),_:1}),e(c,{label:"用户ID"},{default:l(()=>[n(u(r.value.userId),1)]),_:1}),e(c,{label:"用户名"},{default:l(()=>[n(u(r.value.username),1)]),_:1}),e(c,{label:"IP地址"},{default:l(()=>[n(u(r.value.ip),1)]),_:1}),e(c,{label:"操作地点"},{default:l(()=>[n(u(r.value.location),1)]),_:1}),e(c,{label:"浏览器"},{default:l(()=>[n(u(r.value.browser),1)]),_:1}),e(c,{label:"操作系统"},{default:l(()=>[n(u(r.value.os),1)]),_:1}),e(c,{label:"状态"},{default:l(()=>[e(x,{type:r.value.status===1?"success":"danger"},{default:l(()=>[n(u(r.value.status===1?"成功":"失败"),1)]),_:1},8,["type"])]),_:1}),e(c,{label:"创建时间"},{default:l(()=>[n(u(de(r.value.createTime)),1)]),_:1}),_.value==="operation"?(m(),v(c,{key:0,label:"操作类型"},{default:l(()=>[n(u(r.value.operation),1)]),_:1})):b("",!0),_.value==="operation"?(m(),v(c,{key:1,label:"请求方法"},{default:l(()=>[n(u(r.value.method),1)]),_:1})):b("",!0),_.value==="operation"?(m(),v(c,{key:2,label:"执行时间"},{default:l(()=>[n(u(r.value.executeTime)+"ms",1)]),_:1})):b("",!0),_.value==="login"?(m(),v(c,{key:3,label:"登录类型"},{default:l(()=>[n(u(G(r.value.loginType)),1)]),_:1})):b("",!0),e(c,{label:"提示信息"},{default:l(()=>[n(u(r.value.message),1)]),_:1}),r.value.params?(m(),v(c,{key:4,label:"参数",span:2},{default:l(()=>[s("pre",Pe,u(r.value.params),1)]),_:1})):b("",!0),r.value.result?(m(),v(c,{key:5,label:"返回结果",span:2},{default:l(()=>[s("pre",Be,u(r.value.result),1)]),_:1})):b("",!0)]),_:1})])):b("",!0)]),_:1},8,["modelValue","title"])])}}}),qe=fe($e,[["__scopeId","data-v-abf4ab2c"]]);export{qe as default};
